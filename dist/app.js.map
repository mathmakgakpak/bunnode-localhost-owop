{"version":3,"sources":["webpack:///webpack/bootstrap 90b4abf307eb57a0c2ac","webpack:///./src/js/global.js","webpack:///./src/js/conf.js","webpack:///./src/js/util/misc.js","webpack:///./src/js/main.js","webpack:///./src/js/util/color.js","webpack:///./src/js/canvas_renderer.js","webpack:///./src/js/local_player.js","webpack:///./src/js/Fx.js","webpack:///./src/js/networking.js","webpack:///./src/js/util/Bucket.js","webpack:///./src/js/tools.js","webpack:///./src/js/windowsys.js","webpack:///./src/js/World.js","webpack:///./src/js/tool_renderer.js","webpack:///./src/js/util/Lerp.js","webpack:///./src/js/util/normalizeWheel.js","webpack:///./src/js/util/anchorme.js","webpack:///./node_modules/events/events.js","webpack:///./src/img/toolset.png","webpack:///./src/img/unloaded.png","webpack:///./src/js/Player.js","webpack:///./src/js/protocol/all.js","webpack:///./src/js/protocol/old.js","webpack:///./src/js/protocol/Protocol.js","webpack:///./src/js/captcha.js","webpack:///./src/audio/launch.mp3","webpack:///./src/audio/place.mp3","webpack:///./src/audio/click.mp3","webpack:///./src/js/polyfill/canvas-toBlob.js"],"names":["PublicAPI","window","OWOP","WorldOfPixels","eventSys","protocol","evtId","RANK","NONE","USER","MODERATOR","ADMIN","EVENTS","loaded","init","tick","misc","toolsRendered","toolsInitialized","logoMakeRoom","worldInitialized","windowAdded","captchaToken","renderer","addChunk","rmChunk","updateChunk","camera","moved","zoom","net","connecting","connected","disconnected","playerCount","chat","devChat","world","leave","join","joining","setId","playersMoved","playersLeft","tilesUpdated","teleported","chunk","load","unload","set","lock","sec","rank","PUBLIC_EVENTS","events","userOptions","JSON","parse","localStorage","getItem","e","console","error","options","serverAddress","default","title","proto","url","maxRetries","fallbackFps","maxChatBuffer","tickSpeed","minGridZoom","movementSpeed","defaultWorld","enableSounds","defaultZoom","zoomStrength","zoomLimitMin","zoomLimitMax","unloadDistance","toolSetUrl","unloadedPatternUrl","backgroundUrl","chunkBugWorkaround","debug","on","server","getTime","setCookie","getCookie","cookiesEnabled","storageEnabled","propertyDefaults","absMod","htmlToElement","escapeHTML","mkHTML","loadScript","eventOnce","setTooltip","waitFrames","decompress","line","util","time","Date","now","update","name","value","document","cookie","split","i","length","idx","indexOf","off","substring","navigator","cookieEnabled","obj","defaults","prop","hasOwnProperty","n1","n2","html","innerHTML","content","firstChild","text","replace","tag","opts","elm","createElement","callback","getElementsByTagName","appendChild","type","src","onload","element","func","ev","f","removeEventListener","addEventListener","message","elementSpacing","intr","tip","tooltip","epos","getBoundingClientRect","y","top","height","className","body","tpos","x","left","width","right","style","transform","Math","round","mleave","clearTimeout","remove","menter","setTimeout","n","cb","requestAnimationFrame","u8arr","originalLength","u8decompressedarr","Uint8Array","numOfRepeats","offset","uptr","cptr","currentRepeatLoc","repeatedNum","repeatedColorR","repeatedColorG","repeatedColorB","x1","y1","x2","y2","size","plot","dx","abs","sx","dy","sy","err","e2","showDevChat","showPlayerList","statusMsg","keysDown","mouse","lastX","lastY","worldX","worldY","mouseDownWorldX","mouseDownWorldY","tileX","floor","tileY","buttons","validTile","insideViewport","touches","cancelMouseDown","elements","viewport","xyDisplay","chatInput","_world","lastXYDisplay","chatRecvModifier","msg","chatSendModifier","exceptionTimeout","worldPasswords","urlWorldName","tickInterval","lastMessage","lastCleanup","getNewWorldApi","guiShown","showEUCookieNag","usingFirefox","userAgent","sounds","play","sound","currentTime","launch","Audio","place","click","playerList","playerListTable","playerListWindow","closeable","tableHeader","wdow","container","id","move","innerWidth","defProp","Object","defineProperty","get","bind","receiveMessage","log","realText","isAdmin","startsWith","nick","nickname","slice","isNaN","charAt","idIndex","ntext","substr","incCount","span","times","recvTimes","animation","offsetHeight","attributes","scrollChatToBottom","chatMessages","childs","children","receiveDevMessage","devChatMessages","scrollTop","scrollHeight","dontScrollIfNotTop","shouldScroll","clientHeight","clearChat","tickNum","speed","max","min","offX","offY","updateMouse","emit","tool","call","event","eventName","mouseX","mouseY","cancelled","validMousePos","updateXYDisplay","openChat","closeChat","blur","bool","display","addWindow","delWindow","updatePlayerCount","count","playerCountDisplay","loadUl","showWorldUI","palette","disabled","showLoadScr","showOptions","loadOptions","loadScr","isConnected","showSpinner","statusShown","status","spinner","inGameDisconnected","retryingConnect","serverGetter","worldName","currentServer","tryConnect","tryN","once","connect","removeListener","saveWorldPasswords","stringify","checkFunctionality","mozRequestAnimationFrame","webkitRequestAnimationFrame","msRequestAnimationFrame","Number","isInteger","Infinity","trunc","toBlob","HTMLCanvasElement","prototype","msToBlob","require","chatinput","oncontextmenu","chatHistory","historyIndex","stopPropagation","keyCode","which","shiftKey","preventDefault","unshift","adminlogin","modlogin","pass","ctrlKey","sendMessage","activeElement","tagName","isEventDefined","undo","parseClr","tmp","clr","nrgb","colr","parseInt","input","prompt","j","rgb","selectedColor","showGrid","gridShown","focus","pageX","pageY","realBtn","button","cancelledButtons","remainingButtons","mousewheel","nevt","pixelY","delta","spinY","pIndex","paletteIndex","wheelEventName","passive","touchEventNoUpdate","evtName","changedTouches","decodeURIComponent","location","pathname","availableServers","serverList","push","index","next","pop","sv","reconnectBtn","onclick","setInterval","autoNick","desiredRank","onWrong","onCorrect","newrank","unloadFarClusters","errmsg","stack","getElementById","logo","paletteColors","paletteCreate","paletteInput","animCanvas","windows","send","clear","local","recvModifier","fn","sendModifier","colorUtils","to888","R","G","B","to565","u16_565","u24_888","u32_888","u16_565_to_888","color","arrFrom565","toHTML","toString","drawText","centerCameraTo","moveCameraBy","moveCameraTo","isVisible","cameraValues","z","center","getCenterPixel","rendererValues","updateRequired","animContext","gridPattern","unloadedPattern","worldBackground","updatedClusters","clusters","visibleClusters","currentFontSize","rendertype","ALL","FX","WORLD","patterns","unloaded","render","requestRender","setGridVisibility","updateCamera","onCameraMove","BufView","u32data","w","h","realw","data","changes","offx","offy","realwidth","u32buf","ChunkCluster","removed","toUpdate","shown","canvas","chunkSize","clusterChunkAmount","ctx","getContext","createImageData","Uint32Array","buffer","chunks","currentColor","c","needsRedraw","arr","view","s","current","fillStyle","fillRect","putImageData","visiblecl","splice","tmpChunkBuf","fillFromBuf","str","centered","strokeStyle","lineWidth","globalAlpha","measureText","strokeText","fillText","cx","cy","czoom","cw","ch","innerHeight","camx","camy","camw","camh","ctrx","ctry","dist","needsRender","uClusters","visible","clusterCanvasSize","cwidth","cheight","background","allChunksLoaded","clearRect","scale","cluster","gx","gy","clipx","clipy","clipw","cliph","drawImage","newscale","oldscale","translate","globalCompositeOperation","players","fontsize","font","p","player","renderPlayer","targetPlayer","cnvs","toolwidth","cursor","toolheight","idstr","textw","strokeRect","endX","endY","enabled","renderGrid","tmpcanvas","setLineDash","fadeMult","beginPath","moveTo","lineTo","stroke","createPattern","setGridZoom","updateVisible","onResize","imageSmoothingEnabled","webkitImageSmoothingEnabled","mozImageSmoothingEnabled","msImageSmoothingEnabled","oImageSmoothingEnabled","alignCamera","alignedX","alignedY","requestMissingChunks","mx","my","loadChunk","clusterX","clusterY","key","delChunk","alpha","mkPatternFromUrl","patImg","Image","pat","frameLoop","shouldUpdate","getDefaultTool","updateClientFx","toolSelected","undoHistory","clientFx","isLocalPlayer","htmlRgb","setVisibleFunc","networkRankVerification","somethingChanged","cachedHtmlRgb","updatePalette","selClr","addPaletteColor","selectTool","toolId","tools","changedColor","updatePaletteIndex","colorClick","colorDelete","backgroundColor","onmouseup","sel","del","toolName","rankRequired","validClick","setRenderer","fxRenderer","newRank","ws","onchange","exec","PLAYERFX","RECT_SELECT_ALIGNED","pixelSize","htmlColor","fx","extra","fxx","fxy","WORLDFX","RECT_FADE_ALIGNED","startTime","delete","activeFx","Fx","renderFunc","class","made","tiles","t","chunkX","chunkY","wX","wY","state","connection","WebSocket","binaryType","Bucket","rate","lastCheck","allowance","infinite","updateToolWindow","updateToolbar","showToolsWindow","addTool","toolsWindow","windowShown","isSelected","backgroundImage","slotset","cursorblob","win","toolButtonClick","mask","backgroundPosition","setposition","toLowerCase","Tool","rankNeeded","onInit","img","shadowblob","shadowed","imgpos","hotspot","mouseup","mousedown","mousemove","touchstart","touchmove","touchend","touchcancel","select","deselect","keydown","keyup","scroll","apply","defaultTouchHandler","handlers","start","end","cancel","handler","addToolObject","allTools","setEvent","usedButtons","pixel","getPixel","setPixel","startX","startY","rawEvent","spinX","pxAmount","pipette","erase","fillChunk","getChunkAt","empty","firstLoop","setChunk","Array","fill","lzoom","nzoom","maxTouches","setFxRenderer","oldlinew","rect","sin","oldfont","txt","clicking","txtx","txty","dlarea","onblob","d","pix","isInside","finish","cvs","URL","createObjectURL","b","centerOnce","props","reverse","r","shownSize","classList","add","image","addObj","tickAmount","queue","fillingColor","defaultFx","eq","a","check","painted","thisClr","bottom","wand","pc","shield","locked","protectChunk","paste","paint","tmpBuffer","dat","getImageData","u32dat","totalChunksW","ceil","totalChunksH","getModifiedPixel","imgY","imgX","currentPixel","oldPixel","g","getModifiedChunk","modified","Error","tw","newChunk","accept","files","reader","FileReader","target","result","readAsDataURL","cssText","UtilInput","UtilDialog","OWOPDropDown","GUIWindow","centerWindow","windowSys","dialog","dropDown","inputType","inputField","placeholder","onkeyup","okButton","getWindow","close","resize","canClose","messageBox","immobile","frame","hlpdiv","hidebtn","hlpcontainer","initfunc","wm","windowsys","opt","titlespan","offsetWidth","creationtime","currentaction","mdownfunc","clientX","clientY","mupfunc","mmovefunc","object","delObj","removeChild","onclose","realWindow","realh","lastPlace","Chunk","netdata","lockedNeighbors","dir","UP","RIGHT","DOWN","LEFT","World","protectedChunks","pathUpdaterTimeout","pathFx","retval","path","l","setTransform","placeTime","loadCFunc","chunkLoaded","unloadCFunc","chunkUnloaded","setCFunc","chunkPasted","lockCFunc","newState","chunkLocked","disconnectedFunc","updateTileFunc","updatePlayerFunc","destroyPlayerFunc","leaveWFunc","unloadAllChunks","keys","mainPath","Path2D","vpoints","hpoints","addPoint","fy","tx","ty","points","fkey","tkey","newTo","newFrom","k","ln","polys","pointobjs","prev","closePath","checkSide","to","from","sidec","makeLockedChunksPath","requestChunk","chunksUpdated","rendered","u","ids","disconnect","noUndo","updatePixel","bulkUndo","changeTime","px","shouldContinue","unchanged","findNeighborLockedChunks","cursors","brush","copy","cut","kick","ban","write","reduce","nw","nh","idat","xoff","yoff","shadow","shadowColor","shadowBlur","shadowOffsetX","shadowOffsetY","popOut","shadowcolor","backgroundcolor","oncomplete","slotcanvas","original","blob","Lerp","ms","amt","v","val","normalizeWheel","PIXEL_STEP","LINE_HEIGHT","PAGE_HEIGHT","sX","sY","pX","pY","detail","wheelDelta","wheelDeltaY","wheelDeltaX","axis","HORIZONTAL_AXIS","deltaY","deltaX","deltaMode","pixelX","exports","module","anchorme","ips","emails","urls","truncate","defaultProtocol","list","defaultOptions","isPort","tlds","htmlAttrs","match","o","test","forEach","fixSeparators","separate","deSeparate","map","encodeURI","reason","raw","encoded","exclude","validate","ip","email","__esModule","Player","_x","_y","fxType","setVisible","playerListEntry","childNodes","resolveProtocols","definedProtos","captchaState","CA_WAITING","CA_VERIFYING","CA_VERIFIED","CA_OK","CA_INVALID","OldProtocol","netUpdateSpeed","maxWorldNameLength","worldBorder","chatBucket","placeBucket","maxMessageLength","worldVerification","chatVerification","String","fromCharCode","tokenVerification","opCode","client","worldUpdate","chunkLoad","teleport","setRank","captcha","setPQuota","chunkProtected","stoi","string","ints","fstring","charCode","charCodeAt","OldProtocolImpl","lastSentX","lastSentY","playercount","chunksLoading","waitingForChunks","params","interval","joinFunc","sendUpdates","rankChanged","maxLength","leaveFunc","clearInterval","dv","DataView","oc","getUint8","getUint32","shouldrender","updated","updates","pid","pmx","getInt32","pmy","pr","pg","pb","ptool","getUint16","bpx","bpy","br","bg","bb","bbgr","decreased","dpid","u8data","byteLength","token","joinWorld","per","nstr","array","ArrayBuffer","setUint8","setUint16","wb","setInt32","distx","disty","sqrt","canSpend","worldx","worldy","lastx","lasty","selrgb","buf","Protocol","subClass","messageHandler","openHandler","closeHandler","readyState","OPEN","loadAndRequestCaptcha","SITEKEY","loadCaptcha","grecaptcha","requestVerification","theme","sitekey","__webpack_public_path__"],"mappings":"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CA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA,eAAe,SAAS;AACxB;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;;AAEA;AACA;AACA;;AAEA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,GAAG;AACH,oBAAoB,SAAS;AAC7B;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA,KAAK;AACL;AACA;;AAEA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;;;;;;AC7SA,2D;;;;;;ACAA,4D;;;;;;;ACAA;;;;;;;;;AACA;;AACA;;AACA;;AACA;;AACA;;;;IAEa4P,M,WAAAA,M;AACT,oBAAY31B,CAAZ,EAAeN,CAAf,EAAkB2O,GAAlB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","file":"app.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 3);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 90b4abf307eb57a0c2ac","'use strict';\r\n\r\nimport { EventEmitter } from 'events';\r\n\r\nexport const PublicAPI = window.OWOP = window.WorldOfPixels = {};\r\nexport const eventSys = new EventEmitter();\n\n\n// WEBPACK FOOTER //\n// ./src/js/global.js","\"use strict\";\r\nimport { eventSys, PublicAPI } from './global.js';\r\nimport { propertyDefaults, storageEnabled } from './util/misc.js';\r\nimport toolSet from '../img/toolset.png';\r\nimport unloadedPat from '../img/unloaded.png';\r\n\r\n/* Important constants */\r\n\r\nexport let protocol = null;\r\n\r\n/* The raw event ID numbers should NOT be used, instead import the EVENTS object in your file. */\r\nlet evtId = 6666666; /* no */\r\n\r\nexport const RANK = {\r\n\tNONE: 0,\r\n\tUSER: 1,\r\n\tMODERATOR: 2,\r\n\tADMIN: 3\r\n};\r\n\r\nPublicAPI.RANK = RANK;\r\n\r\nexport const EVENTS = {\r\n\tloaded: ++evtId,\r\n\tinit: ++evtId,\r\n\ttick: ++evtId,\r\n\tmisc: {\r\n\t\ttoolsRendered: ++evtId,\r\n\t\ttoolsInitialized: ++evtId,\r\n\t\tlogoMakeRoom: ++evtId,\r\n\t\tworldInitialized: ++evtId,\r\n\t\twindowAdded: ++evtId,\r\n\t\tcaptchaToken: ++evtId\r\n\t},\r\n\trenderer: {\r\n\t\taddChunk: ++evtId,\r\n\t\trmChunk: ++evtId,\r\n\t\tupdateChunk: ++evtId\r\n\t},\r\n\tcamera: {\r\n\t\tmoved: ++evtId,\r\n\t\tzoom: ++evtId /* (zoom value), note that this event should not be used to SET zoom level. */\r\n\t},\r\n\tnet: {\r\n\t\tconnecting: ++evtId,\r\n\t\tconnected: ++evtId,\r\n\t\tdisconnected: ++evtId,\r\n\t\tplayerCount: ++evtId,\r\n\t\tchat: ++evtId,\r\n\t\tdevChat: ++evtId,\r\n\t\tworld: {\r\n\t\t\tleave: ++evtId,\r\n\t\t\tjoin: ++evtId, /* (worldName string) */\r\n\t\t\tjoining: ++evtId, /* (worldName string) */\r\n\t\t\tsetId: ++evtId,\r\n\t\t\tplayersMoved: ++evtId, /* (Object with all the updated player values) */\r\n\t\t\tplayersLeft: ++evtId,\r\n\t\t\ttilesUpdated: ++evtId,\r\n\t\t\tteleported: ++evtId\r\n\t\t},\r\n\t\tchunk: {\r\n\t\t\tload: ++evtId, /* (Chunk class) */\r\n\t\t\tunload: ++evtId, /* (x, y) */\r\n\t\t\tset: ++evtId, /* (x, y, data), backwards compat */\r\n\t\t\tlock: ++evtId\r\n\t\t},\r\n\t\tsec: {\r\n\t\t\trank: ++evtId\r\n\t\t}\r\n\t}\r\n};\r\n\r\nexport const PUBLIC_EVENTS = {\r\n\tloaded: EVENTS.loaded,\r\n\tinit: EVENTS.init,\r\n\ttick: EVENTS.tick,\r\n\ttoolsInitialized: EVENTS.misc.toolsInitialized\r\n};\r\n\r\nPublicAPI.events = PUBLIC_EVENTS;\r\n\r\nlet userOptions = {};\r\nif (storageEnabled()) {\r\n\ttry {\r\n\t\tuserOptions = JSON.parse(localStorage.getItem('owopOptions') || '{}');\r\n\t} catch (e) {\r\n\t\tconsole.error('Error while parsing user options!', e);\r\n\t}\r\n}\r\n\r\nexport const options = propertyDefaults(userOptions, {\r\n\tserverAddress: [{\r\n\t\tdefault: true,\r\n\t\ttitle: 'Official server',\r\n\t\tproto: 'old',\r\n\t\turl: 'ws://wire.ddns.net:7000'\r\n\t},{\r\n\t\tdefault: false,\r\n\t\ttitle: 'Localhost',\r\n\t\tproto: 'old',\r\n\t\turl: 'ws://localhost:7000',\r\n\t\tmaxRetries: 1\r\n\t}], // The server address that websockets connect to\r\n\tfallbackFps: 30, // Fps used if requestAnimationFrame is not supported\r\n\tmaxChatBuffer: 256, // How many chat messages to retain in the chatbox\r\n\ttickSpeed: 30, // How many times per second to run a tick\r\n\tminGridZoom: 1, /* Minimum zoom level where the grid shows up */\r\n\tmovementSpeed: 1, /* Pixels per tick */\r\n\tdefaultWorld: 'main',\r\n\tenableSounds: true,\r\n\tdefaultZoom: 16,\r\n\tzoomStrength: 1,\r\n\tzoomLimitMin: 1,\r\n\tzoomLimitMax: 32,\r\n\tunloadDistance: 10,\r\n\ttoolSetUrl: toolSet,\r\n\tunloadedPatternUrl: unloadedPat,\r\n\tbackgroundUrl: null,\r\n\t/* Bug only affects Windows users with an Intel graphics card,\r\n\t * since we can't easily know the client's GPU,\r\n\t * activate for all windows users ¯\\_(ツ)_/¯\r\n\t */\r\n\tchunkBugWorkaround: false // navigator.userAgent.indexOf('Windows NT') !== -1\r\n\t/* Did it get fixed? we'll know soon! */\r\n});\r\n\r\nif (options.chunkBugWorkaround) {\r\n\tconsole.debug('Chunk bug workaround enabled!');\r\n}\r\n\r\nPublicAPI.options = options;\r\n\r\neventSys.on(EVENTS.net.connecting, server => {\r\n\tprotocol = server.proto;\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/conf.js","'use strict';\r\nimport { colorUtils as color } from './color.js';\r\nimport { PublicAPI } from './../global.js';\r\n\r\nPublicAPI.util = {\r\n\tgetTime,\r\n\tcookiesEnabled,\r\n\tstorageEnabled,\r\n\tabsMod,\r\n\tescapeHTML,\r\n\tmkHTML,\r\n\tsetTooltip,\r\n\twaitFrames,\r\n\tline\r\n};\r\n\r\nlet time = Date.now();\r\nexport function getTime(update) {\r\n\treturn update ? (time = Date.now()) : time;\r\n}\r\n\r\nexport function setCookie(name, value) {\r\n\tdocument.cookie = `${name}=${value}; expires=Fri, 31 Dec 9999 23:59:59 GMT`;\r\n}\r\n\r\nexport function getCookie(name) {\r\n    var cookie = document.cookie.split(';');\r\n\tfor (var i = 0; i < cookie.length; i++) {\r\n\t\tvar idx = cookie[i].indexOf(name + '=');\r\n\t\tif (idx === 0 || (idx === 1 && cookie[i][0] === ' ')) {\r\n\t\t\tvar off = idx + name.length + 1;\r\n\t\t\treturn cookie[i].substring(off, cookie[i].length);\r\n        }\r\n    }\r\n\treturn null;\r\n}\r\n\r\nexport function cookiesEnabled() {\r\n\treturn navigator.cookieEnabled;\r\n}\r\n\r\nexport function storageEnabled() {\r\n\ttry {\r\n\t\treturn !!window.localStorage;\r\n\t} catch (e) {\r\n\t\treturn false;\r\n\t}\r\n}\r\n\r\nexport function propertyDefaults(obj, defaults) {\r\n\tif (obj) {\r\n\t\tfor (var prop in obj) {\r\n\t\t\tif (obj.hasOwnProperty(prop)) {\r\n\t\t\t\tdefaults[prop] = obj[prop];\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\treturn defaults;\r\n}\r\n\r\n// This fixes modulo to work on negative numbers (-1 % 16 = 15)\r\nexport function absMod(n1, n2) {\r\n\treturn ((n1 % n2) + n2) % n2;\r\n}\r\n\r\nexport function htmlToElement(html) {\r\n\treturn mkHTML(\"template\", {\r\n\t\tinnerHTML: html\r\n\t}).content.firstChild;\r\n}\r\n\r\nexport function escapeHTML(text) {\r\n\treturn text.replace(/&/g, '&amp;')\r\n\t\t.replace(/</g, '&lt;')\r\n\t\t.replace(/>/g, '&gt;')\r\n\t\t.replace(/\\\"/g, '&quot;')\r\n\t\t.replace(/\\'/g, '&#39;')\r\n\t\t.replace(/\\//g, '&#x2F;');\r\n}\r\n\r\n/* Makes an HTML element with the values specified in opts */\r\nexport function mkHTML(tag, opts) {\r\n\tvar elm = document.createElement(tag);\r\n\tfor (var i in opts) {\r\n\t\telm[i] = opts[i];\r\n\t}\r\n\treturn elm;\r\n}\r\n\r\nexport function loadScript(name, callback) {\r\n\tdocument.getElementsByTagName('head')[0].appendChild(mkHTML(\"script\", {\r\n\t\ttype: \"text/javascript\",\r\n\t\tsrc: name,\r\n\t\tonload: callback\r\n\t}));\r\n}\r\n\r\nexport function eventOnce(element, events, func) {\r\n\tvar ev = events.split(' ');\r\n\tvar f = e => {\r\n\t\tfor (var i = 0; i < ev.length; i++) {\r\n\t\t\telement.removeEventListener(ev[i], f);\r\n\t\t}\r\n\t\treturn func();\r\n\t};\r\n\r\n\tfor (var i = 0; i < ev.length; i++) {\r\n\t\telement.addEventListener(ev[i], f);\r\n\t}\r\n}\r\n\r\nexport function setTooltip(element, message) {\r\n\tconst elementSpacing = 10;\r\n\tvar intr = 0;\r\n\tvar tip = null;\r\n\tfunction tooltip() {\r\n\t\tvar epos = element.getBoundingClientRect();\r\n\t\tvar y = epos.top + epos.height / 2;\r\n\t\ttip = mkHTML('span', {\r\n\t\t\tinnerHTML: message,\r\n\t\t\tclassName: 'framed tooltip whitetext'\r\n\t\t});\r\n\t\tdocument.body.appendChild(tip);\r\n\t\tvar tpos = tip.getBoundingClientRect();\r\n\t\ty -= tpos.height / 2;\r\n\t\tvar x = epos.left - tpos.width - elementSpacing;\r\n\t\tif (x < elementSpacing) {\r\n\t\t\tx = epos.right + elementSpacing;\r\n\t\t}\r\n\t\ttip.style.transform = `translate(${Math.round(x)}px,${Math.round(y)}px)`;\r\n\t\tintr = 0;\r\n\t}\r\n\tconst mleave = e => {\r\n\t\tclearTimeout(intr);\r\n\t\tintr = 0;\r\n\t\telement.removeEventListener('mouseleave', mleave);\r\n\t\telement.removeEventListener('click', mleave);\r\n\t\telement.removeEventListener('DOMNodeRemoved', mleave);\r\n\t\tif (tip !== null) {\r\n\t\t\ttip.remove();\r\n\t\t\ttip = null;\r\n\t\t}\r\n\t};\r\n\tconst menter = e => {\r\n\t\tif (tip === null && intr === 0) {\r\n\t\t\tintr = setTimeout(tooltip, 500);\r\n\t\t\telement.addEventListener('click', mleave);\r\n\t\t\telement.addEventListener('mouseleave', mleave);\r\n\t\t\telement.addEventListener('DOMNodeRemoved', mleave);\r\n\t\t}\r\n\t};\r\n\t/*var observer = new MutationObserver(e => { // Why does this not fire at all?\r\n\t\tconsole.log(e, tip, intr);\r\n\t\tif (e[0].removedNodes && (tip !== null || intr !== 0)) {\r\n\t\t\tmleave();\r\n\t\t}\r\n\t});\r\n\tobserver.observe(element, { childList: true, subtree: true });*/\r\n\telement.addEventListener('mouseenter', menter);\r\n}\r\n\r\n/* Waits n frames */\r\nexport function waitFrames(n, cb) {\r\n\twindow.requestAnimationFrame(() => {\r\n\t\treturn n > 0 ? waitFrames(--n, cb) : cb();\r\n\t})\r\n}\r\n\r\nexport function decompress(u8arr) {\r\n\tvar originalLength = u8arr[1] << 8 | u8arr[0];\r\n\tvar u8decompressedarr = new Uint8Array(originalLength);\r\n\tvar numOfRepeats = u8arr[3] << 8 | u8arr[2];\r\n\tvar offset = numOfRepeats * 2 + 4;\r\n\tvar uptr = 0;\r\n\tvar cptr = offset;\r\n\tfor (var i = 0; i < numOfRepeats; i++) {\r\n\t\tvar currentRepeatLoc = (u8arr[4 + i * 2 + 1] << 8 | u8arr[4 + i * 2]) + offset;\r\n\t\twhile (cptr < currentRepeatLoc) {\r\n\t\t\tu8decompressedarr[uptr++] = u8arr[cptr++];\r\n\t\t}\r\n\t\tvar repeatedNum = u8arr[cptr + 1] << 8 | u8arr[cptr];\r\n\t\tvar repeatedColorR = u8arr[cptr + 2];\r\n\t\tvar repeatedColorG = u8arr[cptr + 3];\r\n\t\tvar repeatedColorB = u8arr[cptr + 4];\r\n\t\tcptr += 5;\r\n\t\twhile (repeatedNum--) {\r\n\t\t\tu8decompressedarr[uptr] = repeatedColorR;\r\n\t\t\tu8decompressedarr[uptr + 1] = repeatedColorG;\r\n\t\t\tu8decompressedarr[uptr + 2] = repeatedColorB;\r\n\t\t\tuptr += 3;\r\n\t\t}\r\n\t}\r\n\twhile (cptr < u8arr.length) {\r\n\t\tu8decompressedarr[uptr++] = u8arr[cptr++];\r\n\t}\r\n\treturn u8decompressedarr;\r\n}\r\n\r\n/*function decompressu16(input) {\r\n\tvar originalLength = (((input[1] & 0xFF) << 8 | (input[0] & 0xFF)) + 1) * 2;\r\n\tvar output = new Uint8Array(originalLength);\r\n\tvar numOfRepeats = (input[3] & 0xFF) << 8 | (input[2] & 0xFF);\r\n\tvar offset = numOfRepeats * 2 + 4;\r\n\tvar uptr = 0;\r\n\tvar cptr = offset;\r\n\tfor (var i = 0; i < numOfRepeats; i++) {\r\n\t\tvar currentRepeatLoc = 2 * ((((input[4 + i * 2 + 1] & 0xFF) << 8) | (input[4 + i * 2] & 0xFF)))\r\n\t\t\t\t+ offset;\r\n\t\twhile (cptr < currentRepeatLoc) {\r\n\t\t\toutput[uptr++] = input[cptr++];\r\n\t\t}\r\n\t\tvar repeatedNum = ((input[cptr + 1] & 0xFF) << 8 | (input[cptr] & 0xFF)) + 1;\r\n\t\tvar repeatedColorRGB = (input[cptr + 3] & 0xFF) << 8 | (input[cptr + 2] & 0xFF);\r\n\t\tcptr += 4;\r\n\t\twhile (repeatedNum-- != 0) {\r\n\t\t\toutput[uptr] = (repeatedColorRGB & 0xFF);\r\n\t\t\toutput[uptr + 1] = ((repeatedColorRGB & 0xFF00) >> 8);\r\n\t\t\tuptr += 2;\r\n\t\t}\r\n\t}\r\n\twhile (cptr < input.length) {\r\n\t\toutput[uptr++] = input[cptr++];\r\n\t}\r\n\treturn output;\r\n}*/\r\n\r\nexport function line(x1, y1, x2, y2, size, plot) {\r\n\tvar dx =  Math.abs(x2 - x1), sx = x1 < x2 ? 1 : -1;\r\n\tvar dy = -Math.abs(y2 - y1), sy = y1 < y2 ? 1 : -1;\r\n\tvar err = dx + dy,\r\n\t\te2;\r\n\r\n\twhile(true) {\r\n\t\tplot(x1, y1);\r\n\t\tif (x1 == x2 && y1 == y2) break;\r\n\t\te2 = 2 * err;\r\n\t\tif (e2 >= dy) { err += dy; x1 += sx; }\r\n\t\tif (e2 <= dx) { err += dx; y1 += sy; }\r\n\t}\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/util/misc.js","/*\r\n * TODO List: https://trello.com/b/v6F6isSv/worldofpixels\r\n * NOTE: Let's stick with the correct way of storing colors,\r\n * first byte should be red value: 0xAABBGGRR, or [r, g, b]\r\n */\r\n'use strict';\r\nimport { normalizeWheel } from './util/normalizeWheel.js';\r\nimport anchorme from './util/anchorme.js';\r\n\r\nimport { CHUNK_SIZE, EVENTS as e, RANK } from './conf.js';\r\nimport { Bucket } from './util/Bucket.js';\r\nimport { escapeHTML, getTime, getCookie, cookiesEnabled, storageEnabled, loadScript, eventOnce } from './util/misc.js';\r\n\r\nimport { eventSys, PublicAPI } from './global.js';\r\nimport { options } from './conf.js';\r\nimport { World } from './World.js';\r\nimport { camera, renderer, moveCameraBy } from './canvas_renderer.js';\r\nimport { net } from './networking.js';\r\nimport { updateClientFx, player } from './local_player.js';\r\nimport { resolveProtocols, definedProtos } from './protocol/all.js';\r\nimport { windowSys, GUIWindow, OWOPDropDown } from './windowsys.js';\r\n\r\nimport launchSoundUrl from '../audio/launch.mp3';\r\nimport placeSoundUrl from '../audio/place.mp3';\r\nimport clickSoundUrl from '../audio/click.mp3';\r\n\r\nexport { showDevChat, showPlayerList, statusMsg };\r\n\r\nexport const keysDown = {};\r\n\r\nexport const mouse = {\r\n\tx: 0, /* pageX */\r\n\ty: 0, /* pageY */\r\n\tlastX: 0,\r\n\tlastY: 0,\r\n\tget worldX() { return camera.x * 16 + this.x / (camera.zoom / 16); },\r\n\tget worldY() { return camera.y * 16 + this.y / (camera.zoom / 16); },\r\n\tmouseDownWorldX: 0,\r\n\tmouseDownWorldY: 0,\r\n\tget tileX() { return Math.floor(this.worldX / 16); },\r\n\tget tileY() { return Math.floor(this.worldY / 16); },\r\n\tbuttons: 0,\r\n\tvalidTile: false,\r\n\tinsideViewport: false,\r\n\ttouches: [],\r\n\tcancelMouseDown: function () { this.buttons = 0; }\r\n};\r\n\r\nexport const elements = {\r\n\tviewport: null,\r\n\txyDisplay: null,\r\n\tchatInput: null,\r\n\tchat: null,\r\n\tdevChat: null\r\n};\r\n\r\nexport const misc = {\r\n\t_world: null,\r\n\tlastXYDisplay: [-1, -1],\r\n\tchatRecvModifier: msg => msg,\r\n\tchatSendModifier: msg => msg,\r\n\texceptionTimeout: null,\r\n\tworldPasswords: {},\r\n\ttick: 0,\r\n\turlWorldName: null,\r\n\tconnecting: false,\r\n\ttickInterval: null,\r\n\tlastMessage: null,\r\n\tlastCleanup: 0,\r\n\tset world(value) {\r\n\t\t/* The reason this is done is because the old functions may reference the old world object */\r\n\t\tPublicAPI.world = getNewWorldApi();\r\n\t\treturn this._world = value;\r\n\t},\r\n\tget world() { return this._world; },\r\n\tguiShown: false,\r\n\tcookiesEnabled: cookiesEnabled(),\r\n\tstorageEnabled: storageEnabled(),\r\n\tshowEUCookieNag: cookiesEnabled() && getCookie(\"nagAccepted\") !== \"true\",\r\n\tusingFirefox: navigator.userAgent.indexOf(\"Firefox\") !== -1\r\n};\r\n\r\nexport const sounds = {\r\n\tplay: function (sound) {\r\n\t\tsound.currentTime = 0;\r\n\t\tif (options.enableSounds) {\r\n\t\t\tsound.play();\r\n\t\t}\r\n\t}\r\n};\r\nsounds.launch = new Audio();\r\nsounds.launch.src = launchSoundUrl;\r\nsounds.place = new Audio();\r\nsounds.place.src = placeSoundUrl;\r\nsounds.click = new Audio();\r\nsounds.click.src = clickSoundUrl;\r\n\r\nexport var playerList = {};\r\nexport var playerListTable = document.createElement(\"table\");\r\nexport var playerListWindow = new GUIWindow('Players', {closeable: true}, wdow => {\r\n\tvar tableHeader = document.createElement(\"tr\");\r\n\ttableHeader.innerHTML = \"<th>Id</th><th>X</th><th>Y</th>\";\r\n\tplayerListTable.appendChild(tableHeader);\r\n\twdow.container.appendChild(playerListTable);\r\n\twdow.container.id = \"player-list\";\r\n}).move(window.innerWidth - 240, 32);\r\n\r\nfunction getNewWorldApi() {\r\n\tvar obj = {};\r\n\tvar defProp = function (prop) {\r\n\t\tObject.defineProperty(obj, prop, {\r\n\t\t\tget: function () { return misc.world && this['_' + prop] || (this['_' + prop] = misc.world[prop].bind(misc.world)); }\r\n\t\t});\r\n\t};\r\n\tdefProp('getPixel');\r\n\tdefProp('setPixel');\r\n\tdefProp('undo');\r\n\tdefProp('unloadFarChunks');\r\n\treturn obj;\r\n}\r\n\r\nfunction receiveMessage(text) {\r\n\tconsole.log(text);\r\n\ttext = misc.chatRecvModifier(text);\r\n\tif (!text) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tvar message = document.createElement(\"li\");\r\n\tvar realText = text;\r\n\tvar isAdmin = false;\r\n\tif (text.startsWith(\"[D]\")) {\r\n\t\tmessage.className = \"discord\";\r\n\t\tvar nick = document.createElement(\"span\");\r\n\t\tnick.className = \"nick\";\r\n\t\tvar nickname = text.split(\": \")[0] + \": \";\r\n\t\tnick.innerHTML = escapeHTML(nickname);\r\n\t\tmessage.appendChild(nick);\r\n\t\ttext = text.slice(nickname.length);\r\n\t} else if (text.startsWith(\"[Server]\") || text.startsWith(\"Server:\") || text.startsWith(\"Nickname set to\") || text.startsWith(\"User: \")) {\r\n\t\tmessage.className = \"server\";\r\n\t} else if (text.startsWith(\"->\")) {\r\n\t\tmessage.className = \"tell\";\r\n\t} else if (text.startsWith(\"(M)\")) {\r\n\t\tmessage.className = \"moderator\";\r\n\t} else if (isNaN(text.split(\": \")[0]) && text.split(\": \")[0].charAt(0) != \"[\") {\r\n\t\tmessage.className = \"admin\";\r\n\t\tisAdmin = true;\r\n\t} else {\r\n\t\tvar nick = document.createElement(\"span\");\r\n\t\tnick.className = \"nick\";\r\n\t\tvar nickname = text.split(\": \")[0] + \": \";\r\n\t\tnick.innerHTML = escapeHTML(nickname);\r\n\t\tmessage.appendChild(nick);\r\n\t\ttext = text.slice(nickname.length);\r\n\t}\r\n\tvar idIndex = text.indexOf(': '); /* This shouldn't be like this, change on proto switch */\r\n\tif (idIndex !== -1) {\r\n\t\tvar ntext = text.substr(0, idIndex);\r\n\t\trealText = ntext.replace(/\\d+/g, '') + text.slice(idIndex + 2);\r\n\t}\r\n\r\n\tif (misc.lastMessage && misc.lastMessage.text === realText) {\r\n\t\tmisc.lastMessage.incCount();\r\n\t} else {\r\n\t\tvar span = document.createElement(\"span\");\r\n\t\tmisc.lastMessage = {\r\n\t\t\tget text() { return realText; },\r\n\t\t\tincCount: () => {\r\n\t\t\t\tvar times = span.recvTimes || 1;\r\n\t\t\t\tspan.innerHTML = `${text} [x${++times}]`;\r\n\t\t\t\tspan.recvTimes = times;\r\n\t\t\t\tmessage.style.animation = 'none'; /* Reset fading anim */\r\n\t\t\t\tmessage.offsetHeight; /* Reflow */\r\n\t\t\t\tmessage.style.animation = null;\r\n\t\t\t}\r\n\t\t};\r\n\t\tif (!isAdmin) {\r\n\t\t\ttext = escapeHTML(text).replace(/\\&\\#x2F;/g, \"/\");\r\n\t\t}\r\n\t\tspan.innerHTML = anchorme(text, {\r\n\t\t\tattributes: [\r\n\t\t\t\t{\r\n\t\t\t\t\tname: \"target\",\r\n\t\t\t\t\tvalue: \"blank\"\r\n\t\t\t\t}\r\n\t\t\t]\r\n\t\t});\r\n\t\tmessage.appendChild(span);\r\n\t\tscrollChatToBottom(() => {\r\n\t\t\telements.chatMessages.appendChild(message);\r\n\t\t\tvar childs = elements.chatMessages.children;\r\n\t\t\tif (childs.length > options.maxChatBuffer) {\r\n\t\t\t\tchilds[0].remove();\r\n\t\t\t}\r\n\t\t}, true);\r\n\t}\r\n}\r\n\r\nfunction receiveDevMessage(text) {\r\n\tvar message = document.createElement(\"li\");\r\n\tvar span = document.createElement(\"span\");\r\n\tspan.innerHTML = text;\r\n\tmessage.appendChild(span);\r\n\telements.devChatMessages.appendChild(message);\r\n\telements.devChatMessages.scrollTop = elements.devChatMessages.scrollHeight;\r\n}\r\n\r\nfunction scrollChatToBottom(callback, dontScrollIfNotTop = false) {\r\n\tvar shouldScroll = !dontScrollIfNotTop || elements.chatMessages.scrollHeight - elements.chatMessages.scrollTop === elements.chatMessages.clientHeight;\r\n\tif (callback)\r\n\t\tcallback(); // add all elements here\r\n\tif (shouldScroll)\r\n\t\telements.chatMessages.scrollTop = elements.chatMessages.scrollHeight;\r\n}\r\n\r\nfunction clearChat() {\r\n\telements.chatMessages.innerHTML = \"\";\r\n\telements.devChatMessages.innerHTML = \"\";\r\n}\r\n\r\nfunction tick() {\r\n\tvar tickNum = ++misc.tick;\r\n\tvar speed = Math.max(Math.min(options.movementSpeed, 64), 0);\r\n\tvar offX = 0;\r\n\tvar offY = 0;\r\n\tif (keysDown[38]) { // Up\r\n\t\toffY -= speed;\r\n\t}\r\n\tif (keysDown[37]) { // Left\r\n\t\toffX -= speed;\r\n\t}\r\n\tif (keysDown[40]) { // Down\r\n\t\toffY += speed;\r\n\t}\r\n\tif (keysDown[39]) { // Right\r\n\t\toffX += speed;\r\n\t}\r\n\tif (offX !== 0 || offY !== 0) {\r\n\t\tmoveCameraBy(offX, offY);\r\n\t\tupdateMouse(null, 'mousemove', mouse.x, mouse.y);\r\n\t}\r\n\r\n\teventSys.emit(e.tick, tickNum);\r\n\tif (player.tool !== null && misc.world !== null) {\r\n\t\tplayer.tool.call('tick', mouse);\r\n\t}\r\n}\r\n\r\nfunction updateMouse(event, eventName, mouseX, mouseY) {\r\n\tmouse.x = mouseX;\r\n\tmouse.y = mouseY;\r\n\tvar cancelled = 0;\r\n\tif (misc.world !== null) {\r\n\t\tmouse.validTile = misc.world.validMousePos(mouse.tileX, mouse.tileY);\r\n\t\tif (player.tool !== null) {\r\n\t\t\tcancelled = player.tool.call(eventName, [mouse, event]);\r\n\t\t}\r\n\t\tif (updateXYDisplay(mouse.tileX, mouse.tileY)) {\r\n\t\t\tupdateClientFx();\r\n\t\t}\r\n\t}\r\n\treturn cancelled;\r\n}\r\n\r\nfunction openChat() {\r\n\telements.chat.className = \"active selectable\";\r\n\telements.devChat.className = \"active selectable\";\r\n\telements.chatMessages.className = \"active\";\r\n\tscrollChatToBottom();\r\n}\r\n\r\nfunction closeChat() {\r\n\telements.chat.className = \"\";\r\n\telements.devChat.className = \"\";\r\n\telements.chatMessages.className = \"\";\r\n\telements.chatInput.blur();\r\n\tscrollChatToBottom();\r\n}\r\n\r\nfunction showDevChat(bool) {\r\n\telements.devChat.style.display = bool ? \"\" : \"none\";\r\n}\r\n\r\nfunction showPlayerList(bool) {\r\n\tif (bool) {\r\n\t\twindowSys.addWindow(playerListWindow);\r\n\t} else {\r\n\t\twindowSys.delWindow(playerListWindow);\r\n\t}\r\n}\r\n\r\nfunction updateXYDisplay(x, y) {\r\n\tif (misc.lastXYDisplay[0] !== x || misc.lastXYDisplay[1] !== y) {\r\n\t\tmisc.lastXYDisplay = [x, y];\r\n\t\telements.xyDisplay.innerHTML = \"X: \" + x + \", Y: \" + y;\r\n\t\treturn true;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\nfunction updatePlayerCount(count) {\r\n\telements.playerCountDisplay.innerHTML = count + ' cursor' + (count !== 1 ? 's online' : ' online');\r\n}\r\n/*\r\nfunction openServerSelector() {\r\n\twindowsys.addWindow(new GUIWindow(0, 0, 250, 60, \"Select a server\", {\r\n\t\t\tcentered: true\r\n\t\t}, wdow => {\r\n\r\n\t\twdow.addObj(mkHTML(\"button\", {\r\n\t\t\tinnerHTML: \"Original server\",\r\n\t\t\tstyle: \"width: 100%; height: 50%\",\r\n\t\t\tonclick: () => {\r\n\t\t\t\tw.options.serverAddress = \"ws://ourworldofpixels.com:443\";\r\n\t\t\t\tw.net.connect();\r\n\t\t\t\twin.wm.delWindow(win);\r\n\t\t\t\tw.options.oldserver = true;\r\n\t\t\t}\r\n\t\t}));\r\n\t\twdow.addObj(mkHTML(\"button\", {\r\n\t\t\tinnerHTML: \"Beta server\",\r\n\t\t\tstyle: \"width: 100%; height: 50%\",\r\n\t\t\tonclick: () => {\r\n\t\t\t\tw.options.serverAddress = \"ws://vanillaplay.ddns.net:25565\";\r\n\t\t\t\tw.net.connect();\r\n\t\t\t\twin.wm.delWindow(win);\r\n\t\t\t}\r\n\t\t}));\r\n\t\twdow.addObj(mkHTML(\"button\", {\r\n\t\t\tinnerHTML: \"Localhost\",\r\n\t\t\tstyle: \"width: 100%; height: 50%\",\r\n\t\t\tonclick: () => {\r\n\t\t\t\tw.options.serverAddress = \"ws://localhost:7000\";\r\n\t\t\t\tw.net.connect();\r\n\t\t\t\twin.wm.delWindow(win);\r\n\t\t\t}\r\n\t\t}));\r\n\t\twdow.addObj(mkHTML(\"button\", {\r\n\t\t\tinnerHTML: \"Custom server\",\r\n\t\t\tstyle: \"width: 100%; height: 50%\",\r\n\t\t\tonclick: function() {\r\n\t\t\t\tvar i = win.wm.addWindow(\r\n\t\t\t\t\tnew UtilInput(\"Enter server address\", \"Type here...\", \"text\", function(addr) {\r\n\t\t\t\t\t\tw.options.serverAddress = addr;\r\n\t\t\t\t\t\tw.net.connect();\r\n\t\t\t\t\t\twin.close();\r\n\t\t\t\t\t}.bind({w: w, win: win}))\r\n\t\t\t\t);\r\n\t\t\t\twin.onclose = function() {\r\n\t\t\t\t\ti.getWindow().close();\r\n\t\t\t\t}\r\n\t\t\t}.bind({w: this, win: wdow})\r\n\t\t}));\r\n\t}));\r\n}\r\n*/\r\nfunction logoMakeRoom(bool) {\r\n\telements.loadUl.style.transform = bool ? \"translateY(-75%) scale(0.5)\" : \"\";\r\n}\r\n\r\nfunction showWorldUI(bool) {\r\n\tmisc.guiShown = bool;\r\n\telements.xyDisplay.style.transform = bool ? \"initial\" : \"\";\r\n\telements.playerCountDisplay.style.transform = bool ? \"initial\" : \"\";\r\n\telements.palette.style.transform = bool ? \"translateY(-50%)\" : \"\";\r\n\telements.chat.style.transform = bool ? \"initial\" : \"\";\r\n\telements.chatInput.disabled = !bool;\r\n\telements.chatInput.style.display = \"initial\";\r\n}\r\n\r\nfunction showLoadScr(bool, showOptions) {\r\n\telements.loadOptions.className = showOptions ? \"framed\" : \"hide\";\r\n\tif (!bool) {\r\n\t\telements.loadScr.style.transform = \"translateY(-110%)\"; /* +10% for shadow */\r\n\t\teventOnce(elements.loadScr, \"transitionend webkitTransitionEnd oTransitionEnd msTransitionEnd\",\r\n\t\t() => {\r\n\t\t\tif (net.isConnected()) {\r\n\t\t\t\telements.loadScr.className = \"hide\";\r\n\t\t\t}\r\n\t\t});\r\n\t} else {\r\n\t\telements.loadScr.className = \"\";\r\n\t\telements.loadScr.style.transform = \"\";\r\n\t}\r\n}\r\n\r\nfunction statusMsg(showSpinner, message) {\r\n\tconst statusShown = elements.status.isConnected;\r\n\tif (message === null) {\r\n\t\telements.status.style.display = \"none\";\r\n\t\treturn;\r\n\t} else {\r\n\t\telements.status.style.display = \"\";\r\n\t}\r\n\telements.statusMsg.innerHTML = message;\r\n\telements.spinner.style.display = showSpinner ? \"\" : \"none\";\r\n}\r\n\r\nfunction inGameDisconnected() {\r\n\tshowWorldUI(false);\r\n\tshowLoadScr(true, true);\r\n\tstatusMsg(false, \"Lost connection with the server.\");\r\n\tmisc.world = null;\r\n\telements.chat.style.transform = \"initial\";\r\n\telements.chatInput.style.display = \"\";\r\n}\r\n\r\nfunction retryingConnect(serverGetter, worldName) {\r\n\tif (misc.connecting && !net.isConnected()) { /* We're already connected/trying to connect */\r\n\t\treturn;\r\n\t}\r\n\tmisc.connecting = true;\r\n\tvar currentServer = serverGetter(false);\r\n\tconst tryConnect = (tryN) => {\r\n\t\tif (tryN >= (currentServer.maxRetries || 3)) {\r\n\t\t\tcurrentServer = serverGetter(true);\r\n\t\t\ttryN = 0;\r\n\t\t}\r\n\t\teventSys.once(e.net.connecting, () => {\r\n\t\t\tconsole.debug(`Trying '${currentServer.title}' (${currentServer.url})...`)\r\n\t\t\tstatusMsg(true, `Connecting to '${currentServer.title}'...`);\r\n\t\t\tshowLoadScr(true, false);\r\n\t\t});\r\n\t\tnet.connect(currentServer, worldName);\r\n\t\tconst disconnected = () => {\r\n\t\t\t++tryN;\r\n\t\t\tstatusMsg(true, `Couldn't connect to server, retrying... (${tryN})`);\r\n\t\t\tsetTimeout(tryConnect, Math.min(tryN * 2000, 10000), tryN);\r\n\t\t\teventSys.removeListener(e.net.connected, connected);\r\n\t\t};\r\n\t\tconst connected = () => {\r\n\t\t\tstatusMsg(false, \"Connected!\");\r\n\t\t\teventSys.removeListener(e.net.disconnected, disconnected);\r\n\t\t\teventSys.once(e.net.disconnected, inGameDisconnected);\r\n\t\t\tmisc.connecting = false;\r\n\t\t};\r\n\r\n\t\teventSys.once(e.net.connected, connected);\r\n\t\teventSys.once(e.net.disconnected, disconnected);\r\n\t};\r\n\ttryConnect(0);\r\n}\r\n\r\nfunction saveWorldPasswords() {\r\n\tif (misc.storageEnabled) {\r\n\t\tlocalStorage.worldPasswords = JSON.stringify(misc.worldPasswords);\r\n\t}\r\n}\r\n\r\nfunction checkFunctionality(callback) {\r\n\t/* Multi Browser Support */\r\n\twindow.requestAnimationFrame =\r\n\t\twindow.requestAnimationFrame ||\r\n\t\twindow.mozRequestAnimationFrame ||\r\n\t\twindow.webkitRequestAnimationFrame ||\r\n\t\twindow.msRequestAnimationFrame ||\r\n\t\tfunction (f) {\r\n\t\t\tsetTimeout(f, 1000 / options.fallbackFps);\r\n\t\t};\r\n\r\n\tNumber.isInteger = Number.isInteger || (n => Math.floor(n) === n && Math.abs(n) !== Infinity);\r\n\tMath.trunc = Math.trunc || (n => n | 0);\r\n\r\n\tvar toBlob = HTMLCanvasElement.prototype.toBlob = HTMLCanvasElement.prototype.toBlob || HTMLCanvasElement.prototype.msToBlob;\r\n\r\n\tif (!toBlob) { /* Load toBlob polyfill */\r\n\t\tloadScript(require('./polyfill/canvas-toBlob.js'), callback);\r\n\t} else {\r\n\t\tcallback();\r\n\t}\r\n}\r\n\r\nfunction init() {\r\n\tvar viewport = elements.viewport;\r\n\tvar chatinput = elements.chatInput;\r\n\r\n\tif (misc.storageEnabled && localStorage.worldPasswords) {\r\n\t\ttry {\r\n\t\t\tmisc.worldPasswords = JSON.parse(localStorage.worldPasswords);\r\n\t\t} catch (e) { }\r\n\t}\r\n\t\r\n\tmisc.lastCleanup = 0;\r\n\r\n\tviewport.oncontextmenu = () => false;\r\n\r\n\tviewport.addEventListener(\"mouseenter\", () => {\r\n\t\tmouse.insideViewport = true;\r\n\t\tupdateClientFx();\r\n\t});\r\n\tviewport.addEventListener(\"mouseleave\", () => {\r\n\t\tmouse.insideViewport = false;\r\n\t\tupdateClientFx();\r\n\t});\r\n\r\n\tvar chatHistory = [];\r\n\tvar historyIndex = 0;\r\n\tchatinput.addEventListener(\"keydown\", event => {\r\n\t\tevent.stopPropagation();\r\n\t\tif (historyIndex === 0) {\r\n\t\t\tchatHistory[0] = chatinput.value;\r\n\t\t}\r\n\t\tvar keyCode = event.which || event.keyCode;\r\n\t\tswitch (keyCode) {\r\n\t\t\tcase 27:\r\n\t\t\t\tcloseChat();\r\n\t\t\t\tbreak;\r\n\t\t\tcase 13:\r\n\t\t\t\tif (!event.shiftKey) {\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tvar text = chatinput.value;\r\n\t\t\t\t\thistoryIndex = 0;\r\n\t\t\t\t\tchatHistory.unshift(text);\r\n\t\t\t\t\tif (misc.storageEnabled) {\r\n\t\t\t\t\t\tif (text.startsWith(\"/adminlogin \")) {\r\n\t\t\t\t\t\t\tlocalStorage.adminlogin = text.slice(12);\r\n\t\t\t\t\t\t} else if (text.startsWith(\"/modlogin \")) {\r\n\t\t\t\t\t\t\tlocalStorage.modlogin = text.slice(10);\r\n\t\t\t\t\t\t} else if (text.startsWith(\"/nick\")) {\r\n\t\t\t\t\t\t\tvar nick = text.slice(6);\r\n\t\t\t\t\t\t\tif (nick.length) {\r\n\t\t\t\t\t\t\t\tlocalStorage.nick = nick;\r\n\t\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t\tdelete localStorage.nick;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (text.startsWith(\"/pass \") && misc.world) {\r\n\t\t\t\t\t\t\tvar pass = text.slice(6);\r\n\t\t\t\t\t\t\tmisc.worldPasswords[net.protocol.worldName] = pass;\r\n\t\t\t\t\t\t\tsaveWorldPasswords();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!event.ctrlKey) {\r\n\t\t\t\t\t\ttext = misc.chatSendModifier(text);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tnet.protocol.sendMessage(text);\r\n\t\t\t\t\tchatinput.value = '';\r\n\t\t\t\t\tchatinput.style.height = \"16px\";\r\n\t\t\t\t\tevent.stopPropagation();\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 38: // Arrow up\r\n\t\t\t\tif (event.shiftKey && historyIndex < chatHistory.length - 1) {\r\n\t\t\t\t\thistoryIndex++;\r\n\t\t\t\t\tchatinput.value = chatHistory[historyIndex];\r\n\t\t\t\t\tchatinput.style.height = 0;\r\n\t\t\t\t\tchatinput.style.height = Math.min(chatinput.scrollHeight - 8, 16 * 4) + \"px\";\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\tcase 40: // Arrow Down\r\n\t\t\t\tif (event.shiftKey && historyIndex > 0) {\r\n\t\t\t\t\thistoryIndex--;\r\n\t\t\t\t\tchatinput.value = chatHistory[historyIndex];\r\n\t\t\t\t\tchatinput.style.height = 0;\r\n\t\t\t\t\tchatinput.style.height = Math.min(chatinput.scrollHeight - 8, 16 * 4) + \"px\";\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t});\r\n\tchatinput.addEventListener(\"keyup\", event => {\r\n\t\tevent.stopPropagation();\r\n\t\tvar keyCode = event.which || event.keyCode;\r\n\t\tif (keyCode == 13 && !event.shiftKey) {\r\n\t\t\tcloseChat();\r\n\t\t}\r\n\t})\r\n\tchatinput.addEventListener(\"input\", event => {\r\n\t\tchatinput.style.height = 0;\r\n\t\tchatinput.style.height = Math.min(chatinput.scrollHeight - 8, 16 * 4) + \"px\";\r\n\t});\r\n\tchatinput.addEventListener(\"focus\", event => {\r\n\t\tif (!mouse.buttons) {\r\n\t\t\topenChat();\r\n\t\t} else {\r\n\t\t\tchatinput.blur();\r\n\t\t}\r\n\t});\r\n\r\n\twindow.addEventListener(\"keydown\", event => {\r\n\t\tvar keyCode = event.which || event.keyCode;\r\n\t\tif (document.activeElement.tagName !== \"INPUT\" && misc.world !== null) {\r\n\t\t\tkeysDown[keyCode] = true;\r\n\t\t\tvar tool = player.tool;\r\n\t\t\tif (tool !== null && misc.world !== null && tool.isEventDefined('keydown')) {\r\n\t\t\t\tif (tool.call('keydown', [keysDown, event])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tswitch (keyCode) {\r\n\t\t\t\tcase 80: /* P */\r\n\t\t\t\t\tplayer.tool = \"pipette\";\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 79: /* O */\r\n\t\t\t\t\tplayer.tool = \"cursor\";\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 77: /* M */\r\n\t\t\t\tcase 16: /* Shift */\r\n\t\t\t\t\tplayer.tool = \"move\";\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 90: /* Ctrl + Z */\r\n\t\t\t\t\tif (!event.ctrlKey || !misc.world) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tmisc.world.undo(event.shiftKey);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 70: /* F */\r\n\t\t\t\t\tvar parseClr = clr => {\r\n\t\t\t\t\t\tvar tmp = clr.split(',');\r\n\t\t\t\t\t\tvar nrgb = null;\r\n\t\t\t\t\t\tif (tmp.length == 3) {\r\n\t\t\t\t\t\t\tnrgb = tmp;\r\n\t\t\t\t\t\t\tfor (var i = 0; i < tmp.length; i++) {\r\n\t\t\t\t\t\t\t\ttmp[i] = +tmp[i];\r\n\t\t\t\t\t\t\t\tif (!(tmp[i] >= 0 && tmp[i] < 256)) {\r\n\t\t\t\t\t\t\t\t\treturn null;\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t} else if (clr[0] == '#' && clr.length == 7) {\r\n\t\t\t\t\t\t\tvar colr = parseInt(clr.replace('#', '0x'));\r\n\t\t\t\t\t\t\t/* The parsed HTML color doesn't have red as the first byte, so invert it. */\r\n\t\t\t\t\t\t\tnrgb = [colr >> 16 & 0xFF, colr >> 8 & 0xFF, colr & 0xFF];\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\treturn nrgb;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tvar input = prompt(\"Custom color\\nType three values separated by a comma: r,g,b\\n(...or the hex string: #RRGGBB)\\nYou can add multiple colors at a time separating them with a space.\");\r\n\t\t\t\t\tif (!input) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tinput = input.split(' ');\r\n\t\t\t\t\tfor (var j = 0; j < input.length; j++) {\r\n\t\t\t\t\t\tvar rgb = parseClr(input[j]);\r\n\t\t\t\t\t\tif (rgb) {\r\n\t\t\t\t\t\t\tplayer.selectedColor = rgb;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 71: /* G */\r\n\t\t\t\t\trenderer.showGrid(!renderer.gridShown);\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 112: /* F1 */\r\n\t\t\t\t\tshowWorldUI(!misc.guiShown);\r\n\t\t\t\t\tevent.preventDefault();\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 107:\r\n\t\t\t\tcase 187:\r\n\t\t\t\t\t++camera.zoom;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 109:\r\n\t\t\t\tcase 189:\r\n\t\t\t\t\t--camera.zoom;\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tdefault:\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}\r\n\t});\r\n\twindow.addEventListener(\"keyup\", event => {\r\n\t\tvar keyCode = event.which || event.keyCode;\r\n\t\tdelete keysDown[keyCode];\r\n\t\tif (document.activeElement.tagName !== \"INPUT\") {\r\n\t\t\tvar tool = player.tool;\r\n\t\t\tif (tool !== null && misc.world !== null && tool.isEventDefined('keyup')) {\r\n\t\t\t\tif (tool.call('keyup', [keysDown, event])) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (keyCode == 13) {\r\n\t\t\t\telements.chatInput.focus();\r\n\t\t\t} else if (keyCode == 16) {\r\n\t\t\t\tplayer.tool = \"cursor\";\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\tviewport.addEventListener(\"mousedown\", event => {\r\n\t\tcloseChat();\r\n\t\tmouse.lastX = mouse.x;\r\n\t\tmouse.lastY = mouse.y;\r\n\t\tmouse.x = event.pageX;\r\n\t\tmouse.y = event.pageY;\r\n\t\tmouse.mouseDownWorldX = mouse.worldX;\r\n\t\tmouse.mouseDownWorldY = mouse.worldY;\r\n\t\tif ('buttons' in event) {\r\n\t\t\tmouse.buttons = event.buttons;\r\n\t\t} else {\r\n\t\t\tvar realBtn = event.button;\r\n\t\t\tif (realBtn === 2) {\r\n\t\t\t\trealBtn = 1;\r\n\t\t\t} else if (realBtn === 1) {\r\n\t\t\t\trealBtn = 2;\r\n\t\t\t}\r\n\t\t\tmouse.buttons |= 1 << realBtn;\r\n\t\t}\r\n\r\n\t\tvar tool = player.tool;\r\n\t\tif (tool !== null && misc.world !== null) {\r\n\t\t\tplayer.tool.call('mousedown', [mouse, event]);\r\n\t\t}\r\n\t});\r\n\r\n\twindow.addEventListener(\"mouseup\", event => {\r\n\t\t/* Old versions of firefox have the buttons property as the\r\n\t\t * buttons released, instead of the currently pressed buttons.\r\n\t\t **/\r\n\t\tif ('buttons' in event && !misc.usingFirefox) {\r\n\t\t\tmouse.buttons = event.buttons;\r\n\t\t} else {\r\n\t\t\tvar realBtn = event.button;\r\n\t\t\tif (realBtn === 2) {\r\n\t\t\t\trealBtn = 1;\r\n\t\t\t} else if (realBtn === 1) {\r\n\t\t\t\trealBtn = 2;\r\n\t\t\t}\r\n\t\t\tmouse.buttons &= ~(1 << realBtn);\r\n\t\t}\r\n\t\tvar tool = player.tool;\r\n\t\tif (tool !== null && misc.world !== null) {\r\n\t\t\tplayer.tool.call('mouseup', [mouse, event]);\r\n\t\t}\r\n\t});\r\n\r\n\twindow.addEventListener(\"mousemove\", event => {\r\n\t\tvar cancelledButtons = updateMouse(event, 'mousemove', event.pageX, event.pageY);\r\n\t\tvar remainingButtons = mouse.buttons & ~cancelledButtons;\r\n\t\tif (remainingButtons & 0b100) { /* If middle click was not used for anything */\r\n\t\t\tmoveCameraBy((mouse.mouseDownWorldX - mouse.worldX) / 16, (mouse.mouseDownWorldY - mouse.worldY) / 16);\r\n\t\t}\r\n\t});\r\n\r\n\tconst mousewheel = event => {\r\n\t\tconst nevt = normalizeWheel(event);\r\n\t\tif (player.tool !== null && misc.world !== null && player.tool.isEventDefined('scroll')) {\r\n\t\t\tif (player.tool.call('scroll', [mouse, nevt, event])) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (event.ctrlKey) {\r\n\t\t\tcamera.zoom += Math.max(-1, Math.min(1, -nevt.pixelY));\r\n\t\t\t//-nevt.spinY * camera.zoom / options.zoomLimitMax; // <- needs to be nicer\r\n\t\t} else {\r\n\t\t\tvar delta = Math.max(-1, Math.min(1, nevt.spinY));\r\n\t\t\tvar pIndex = player.paletteIndex;\r\n\t\t\tif (delta > 0) {\r\n\t\t\t\tpIndex++;\r\n\t\t\t} else if (delta < 0) {\r\n\t\t\t\tpIndex--;\r\n\t\t\t}\r\n\t\t\tplayer.paletteIndex = pIndex;\r\n\t\t}\r\n\t};\r\n\r\n\tvar wheelEventName = ('onwheel' in document) ? 'wheel' : ('onmousewheel' in document) ? 'mousewheel' : 'DOMMouseScroll';\r\n\r\n\tviewport.addEventListener(wheelEventName, mousewheel, { passive: true });\r\n\tviewport.addEventListener(wheelEventName, e => {\r\n\t\te.preventDefault();\r\n\t\treturn false;\r\n\t}, { passive: false });\r\n\r\n\t// Touch support\r\n\tconst touchEventNoUpdate = evtName => event => {\r\n\t\tvar tool = player.tool;\r\n\t\tmouse.buttons = 0;\r\n\t\tif (tool !== null && misc.world !== null) {\r\n\t\t\tplayer.tool.call(evtName, [mouse, event]);\r\n\t\t}\r\n\t};\r\n\tviewport.addEventListener(\"touchstart\", event => {\r\n\t\tvar moved = event.changedTouches[0];\r\n\t\tmouse.buttons = 1;\r\n\t\tif (moved) {\r\n\t\t\tupdateMouse(event, 'touchstart', moved.pageX, moved.pageY);\r\n\t\t\tmouse.mouseDownWorldX = mouse.worldX;\r\n\t\t\tmouse.mouseDownWorldY = mouse.worldY;\r\n\t\t}\r\n\t}, { passive: true });\r\n\tviewport.addEventListener(\"touchmove\", event => {\r\n\t\tvar moved = event.changedTouches[0];\r\n\t\tif (moved) {\r\n\t\t\tupdateMouse(event, 'touchmove', moved.pageX, moved.pageY);\r\n\t\t}\r\n\t}, { passive: true });\r\n\tviewport.addEventListener(\"touchend\", touchEventNoUpdate('touchend'), { passive: true });\r\n\tviewport.addEventListener(\"touchcancel\", touchEventNoUpdate('touchcancel'), { passive: true });\r\n\r\n\t// Some cool custom css\r\n\tconsole.log(\"%c\" +\r\n\t\t\" _ _ _         _   _    _____ ___    _____ _         _     \\n\" +\r\n\t\t\"| | | |___ ___| |_| |  |     |  _|  |  _  |_|_ _ ___| |___ \\n\" +\r\n\t\t\"| | | | . |  _| | . |  |  |  |  _|  |   __| |_'_| -_| |_ -|\\n\" +\r\n\t\t\"|_____|___|_| |_|___|  |_____|_|    |__|  |_|_,_|___|_|___|\",\r\n\t\t\"font-size: 15px; font-weight: bold;\"\r\n\t);\r\n\tconsole.log(\"%cWelcome to the developer console!\", \"font-size: 20px; font-weight: bold; color: #F0F;\");\r\n\r\n\t//windowSys.addWindow(new OWOPDropDown());\r\n\tresolveProtocols();\r\n\r\n\t/* Calls other initialization functions */\r\n\teventSys.emit(e.init);\r\n\r\n\tupdateXYDisplay(0, 0);\r\n\r\n\tvar worldName = decodeURIComponent(window.location.pathname);\r\n\tif (worldName[0] === '/') {\r\n\t\tworldName = worldName.slice(1);\r\n\t}\r\n\r\n\tmisc.urlWorldName = worldName;\r\n\r\n\r\n\tconst serverGetter = (serverList => {\r\n\t\tvar defaults = [];\r\n\t\tvar availableServers = [];\r\n\t\tfor (var i = 0; i < serverList.length; i++) {\r\n\t\t\tif (serverList[i].default) {\r\n\t\t\t\tdefaults.push(serverList[i]);\r\n\t\t\t} else {\r\n\t\t\t\tavailableServers.push(serverList[i]);\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar index = 0;\r\n\t\treturn (next) => {\r\n\t\t\tif (next) {\r\n\t\t\t\tdefaults.pop();\r\n\t\t\t\t++index;\r\n\t\t\t}\r\n\t\t\tif (defaults.length) {\r\n\t\t\t\tvar sv = defaults[0];\r\n\t\t\t\tavailableServers.push(sv);\r\n\t\t\t\treturn sv;\r\n\t\t\t}\r\n\t\t\treturn availableServers[index % availableServers.length];\r\n\t\t};\r\n\t})(options.serverAddress);\r\n\r\n\tretryingConnect(serverGetter, misc.urlWorldName);\r\n\r\n\telements.reconnectBtn.onclick = () => retryingConnect(serverGetter, misc.urlWorldName);\r\n\r\n\tmisc.tickInterval = setInterval(tick, 1000 / options.tickSpeed);\r\n}\r\n\r\neventSys.once(e.loaded, () => statusMsg(true, \"Initializing...\"));\r\neventSys.once(e.misc.logoMakeRoom, () => {\r\n\tstatusMsg(false, null);\r\n\tlogoMakeRoom();\r\n});\r\n\r\neventSys.once(e.loaded, init);\r\neventSys.on(e.net.playerCount, updatePlayerCount);\r\n\r\neventSys.on(e.net.chat, receiveMessage);\r\neventSys.on(e.net.devChat, receiveDevMessage);\r\n\r\neventSys.on(e.net.world.setId, id => {\r\n\tif (!misc.storageEnabled) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tfunction autoNick() {\r\n\t\tif (localStorage.nick) {\r\n\t\t\tnet.protocol.sendMessage(\"/nick \" + localStorage.nick);\r\n\t\t}\r\n\t}\r\n\r\n\t// Automatic login\r\n\tlet desiredRank = localStorage.adminlogin ? RANK.ADMIN : localStorage.modlogin ? RANK.MODERATOR : net.protocol.worldName in misc.worldPasswords ? RANK.USER : RANK.NONE;\r\n\tif (desiredRank > RANK.NONE) {\r\n\t\tlet onWrong = function () {\r\n\t\t\tconsole.log(\"WRONG\");\r\n\t\t\teventSys.removeListener(e.net.sec.rank, onCorrect);\r\n\t\t\tif (desiredRank == RANK.ADMIN) {\r\n\t\t\t\tdelete localStorage.adminlogin;\r\n\t\t\t} else if (desiredRank == RANK.MODERATOR) {\r\n\t\t\t\tdelete localStorage.modlogin;\r\n\t\t\t} else if (desiredRank == RANK.USER) {\r\n\t\t\t\tdelete misc.worldPasswords[net.protocol.worldName];\r\n\t\t\t\tsaveWorldPasswords();\r\n\t\t\t}\r\n\t\t\tretryingConnect(() => net.currentServer, net.protocol.worldName)\r\n\t\t};\r\n\t\tlet onCorrect = function (newrank) {\r\n\t\t\tif (newrank == desiredRank) {\r\n\t\t\t\tsetTimeout(() => {\r\n\t\t\t\t\t/* Ugly fix for wrong password on worlds without one */\r\n\t\t\t\t\teventSys.removeListener(e.net.disconnected, onWrong);\r\n\t\t\t\t}, 1000);\r\n\t\t\t\teventSys.removeListener(e.net.sec.rank, onCorrect);\r\n\t\t\t\tautoNick();\r\n\t\t\t}\r\n\t\t};\r\n\t\teventSys.once(e.net.disconnected, onWrong);\r\n\t\teventSys.on(e.net.sec.rank, onCorrect);\r\n\t\tvar msg;\r\n\t\tif (desiredRank == RANK.ADMIN) {\r\n\t\t\tmsg = \"/adminlogin \" + localStorage.adminlogin;\r\n\t\t} else if (desiredRank == RANK.MODERATOR) {\r\n\t\t\tmsg = \"/modlogin \" + localStorage.modlogin;\r\n\t\t} else if (desiredRank == RANK.USER) {\r\n\t\t\tmsg = \"/pass \" + misc.worldPasswords[net.protocol.worldName];\r\n\t\t}\r\n\t\tnet.protocol.sendMessage(msg);\r\n\t} else {\r\n\t\tautoNick();\r\n\t}\r\n});\r\n\r\neventSys.on(e.misc.windowAdded, window => {\r\n\tif (misc.world === null) {\r\n\t\tstatusMsg(false, null);\r\n\t\tlogoMakeRoom(true);\r\n\t}\r\n});\r\n\r\neventSys.on(e.net.world.joining, name => {\r\n\tlogoMakeRoom(false);\r\n\tconsole.log(`Joining world: ${name}`);\r\n});\r\n\r\neventSys.on(e.net.world.join, world => {\r\n\tshowLoadScr(false, false);\r\n\tshowWorldUI(true);\r\n\tsounds.play(sounds.launch);\r\n\tmisc.world = new World(world);\r\n\teventSys.emit(e.misc.worldInitialized);\r\n});\r\n\r\neventSys.on(e.net.connected, () => {\r\n\tclearChat();\r\n});\r\n\r\neventSys.on(e.camera.moved, camera => {\r\n\tvar time = getTime();\r\n\tif (misc.world !== null && time - misc.lastCleanup > 1000) {\r\n\t\tmisc.lastCleanup = time;\r\n\t\trenderer.unloadFarClusters();\r\n\t}\r\n\tif (updateXYDisplay(mouse.tileX, mouse.tileY)) {\r\n\t\tupdateClientFx();\r\n\t}\r\n});\r\n\r\neventSys.on(e.camera.zoom, camera => {\r\n\tif (updateXYDisplay(mouse.tileX, mouse.tileY)) {\r\n\t\tupdateClientFx();\r\n\t}\r\n});\r\n\r\nwindow.addEventListener(\"error\", e => {\r\n\tshowDevChat(true);\r\n\tvar errmsg = e && e.error ? (e.error.message || e.error.stack) : e.message || \"Unknown error occurred\";\r\n\terrmsg = escapeHTML(errmsg);\r\n\terrmsg = errmsg.split('\\n');\r\n\tfor (var i = 0; i < errmsg.length; i++) {\r\n\t\t/* Should be some kind of dissapearing notification instead */\r\n\t\treceiveDevMessage(errmsg[i]);\r\n\t}\r\n\tif (player.rank !== RANK.ADMIN) { /* TODO */\r\n\t\tif (misc.exceptionTimeout) {\r\n\t\t\tclearTimeout(misc.exceptionTimeout);\r\n\t\t}\r\n\t\tmisc.exceptionTimeout = setTimeout(() => showDevChat(false), 5000);\r\n\t}\r\n});\r\n\r\nwindow.addEventListener(\"load\", () => {\r\n\telements.loadScr = document.getElementById(\"load-scr\");\r\n\telements.loadUl = document.getElementById(\"load-ul\");\r\n\telements.loadOptions = document.getElementById(\"load-options\");\r\n\telements.reconnectBtn = document.getElementById(\"reconnect-btn\");\r\n\telements.spinner = document.getElementById(\"spinner\");\r\n\telements.statusMsg = document.getElementById(\"status-msg\");\r\n\telements.status = document.getElementById(\"status\");\r\n\telements.logo = document.getElementById(\"logo\");\r\n\r\n\telements.xyDisplay = document.getElementById(\"xy-display\");\r\n\telements.devChat = document.getElementById(\"dev-chat\");\r\n\telements.chat = document.getElementById(\"chat\");\r\n\telements.devChatMessages = document.getElementById(\"dev-chat-messages\");\r\n\telements.chatMessages = document.getElementById(\"chat-messages\");\r\n\telements.playerCountDisplay = document.getElementById(\"playercount-display\");\r\n\r\n\telements.palette = document.getElementById(\"palette\");\r\n\telements.paletteColors = document.getElementById(\"palette-colors\");\r\n\telements.paletteCreate = document.getElementById(\"palette-create\");\r\n\telements.paletteInput = document.getElementById(\"palette-input\");\r\n\r\n\telements.animCanvas = document.getElementById(\"animations\");\r\n\r\n\telements.viewport = document.getElementById(\"viewport\");\r\n\telements.windows = document.getElementById(\"windows\");\r\n\r\n\telements.chatInput = document.getElementById(\"chat-input\");\r\n\r\n\tdocument.getElementById(\"help-button\").addEventListener(\"click\", function () {\r\n\t\tdocument.getElementById(\"help\").className = \"\";\r\n\t});\r\n\tdocument.getElementById(\"help-close\").addEventListener(\"click\", function () {\r\n\t\tdocument.getElementById(\"help\").className = \"hidden\";\r\n\t});\r\n\r\n\tcheckFunctionality(() => eventSys.emit(e.loaded));\r\n});\r\n\r\n/* Public API definitions */\r\nPublicAPI.emit = eventSys.emit.bind(eventSys);\r\nPublicAPI.on = eventSys.on.bind(eventSys);\r\nPublicAPI.once = eventSys.once.bind(eventSys);\r\nPublicAPI.removeListener = eventSys.removeListener.bind(eventSys);\r\nPublicAPI.elements = elements;\r\nPublicAPI.mouse = mouse;\r\nPublicAPI.world = getNewWorldApi();\r\nPublicAPI.chat = {\r\n\tsend: (msg) => net.protocol && net.protocol.sendMessage(msg),\r\n\tclear: clearChat,\r\n\tlocal: receiveMessage,\r\n\tget recvModifier() { return misc.chatRecvModifier; },\r\n\tset recvModifier(fn) { misc.chatRecvModifier = fn; },\r\n\tget sendModifier() { return misc.chatSendModifier; },\r\n\tset sendModifier(fn) { misc.chatSendModifier = fn; }\r\n};\r\nPublicAPI.sounds = sounds;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/main.js","'use strict';\r\n\r\nexport const colorUtils = {\r\n\tto888: (R, G, B) => [(R * 527 + 23) >> 6, (G * 259 + 33) >> 6, (B * 527 + 23) >> 6],\r\n\tto565: (R, G, B) => [(R * 249 + 1014) >> 11, (G * 253 + 505) >> 10, (B * 249 + 1014) >> 11],\r\n\tu16_565: (R, G, B) => B << 11 | G << 5 | R,\r\n\tu24_888: (R, G, B) => B << 16 | G << 8 | R,\r\n\tu32_888: (R, G, B) => colorUtils.u24_888(R, G, B) | 0xFF000000,\r\n\tu16_565_to_888: color => {\r\n\t\tconst R = ((color & 0b11111) * 527 + 23) >> 6;\r\n\t\tconst G = ((color >> 5 & 0b11111) * 527 + 23) >> 6;\r\n\t\tconst B = ((color >> 11 & 0b11111) * 527 + 23) >> 6;\r\n\t\treturn B << 16 | G << 8 | R;\r\n\t},\r\n\tarrFrom565: color => [color & 0b11111, color >> 5 & 0b111111, color >> 11 & 0b11111],\r\n\t/* Takes an integer, and gives an html compatible color */\r\n\ttoHTML: color => {\r\n\t\tcolor = (color >> 16 & 0xFF | color & 0xFF00 | color << 16 & 0xFF0000).toString(16);\r\n\t\treturn '#' + ('000000' + color).substring(color.length);\r\n\t}\r\n};\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/util/color.js","'use strict';\r\nimport { protocol, EVENTS as e, options } from './conf.js';\r\nimport { eventSys, PublicAPI } from './global.js';\r\nimport { elements, misc } from './main.js';\r\nimport { player } from './local_player.js';\r\nimport { activeFx } from './Fx.js';\r\nimport { getTime } from './util/misc.js';\r\nimport { colorUtils as color } from './util/color.js';\r\nimport { Lerp } from './util/Lerp.js';\r\nimport { tools } from './tools.js';\r\n\r\nexport { centerCameraTo, moveCameraBy, moveCameraTo, isVisible };\r\n\r\n/* oh boy, i'm going to get shit for making this private, aren't i?  */\r\nconst cameraValues = {\r\n\tx: 0,\r\n\ty: 0,\r\n\tzoom: -1/*,\r\n\tlerpZoom: new Lerp(options.defaultZoom, options.defaultZoom, 200)*/\r\n};\r\n\r\nexport const camera = {\r\n\tget x() { return cameraValues.x; },\r\n\tget y() { return cameraValues.y; },\r\n\tget zoom() { return cameraValues.zoom; },\r\n\t/*get lerpZoom() { return cameraValues.lerpZoom.val; },*/\r\n\tset zoom(z) {\r\n\t\tz = Math.min(options.zoomLimitMax, Math.max(options.zoomLimitMin, z));\r\n\t\tif (z !== cameraValues.zoom) {\r\n\t\t\tvar center = getCenterPixel();\r\n\t\t\tcameraValues.zoom = z;\r\n\t\t\tcenterCameraTo(center[0], center[1]);\r\n\t\t\teventSys.emit(e.camera.zoom, z);\r\n\t\t}\r\n\t},\r\n\tisVisible: isVisible\r\n};\r\n\r\nconst rendererValues = {\r\n\tupdateRequired: 3,\r\n\tanimContext: null,\r\n\tgridShown: true,\r\n\tgridPattern: null, /* Rendered each time the zoom changes */\r\n\tunloadedPattern: null,\r\n\tworldBackground: null,\r\n\tminGridZoom: options.minGridZoom,\r\n\tupdatedClusters: [], /* Clusters to render in the next frame */\r\n\tclusters: {},\r\n\tvisibleClusters: [],\r\n\tcurrentFontSize: -1\r\n};\r\n\r\n/*PublicAPI.rval = rendererValues;*/\r\n\r\nexport const renderer = {\r\n\trendertype: {\r\n\t\tALL:      0b11,\r\n\t\tFX:       0b01,\r\n\t\tWORLD:    0b10\r\n\t},\r\n\tpatterns: {\r\n\t\tget unloaded() { return rendererValues.unloadedPattern; }\r\n\t},\r\n\trender: requestRender,\r\n\tshowGrid: setGridVisibility,\r\n\tget gridShown() { return rendererValues.gridShown; },\r\n\tupdateCamera: onCameraMove,\r\n\tunloadFarClusters: unloadFarClusters\r\n};\r\n\r\nPublicAPI.camera = camera;\r\nPublicAPI.renderer = renderer;\r\n\r\nclass BufView {\r\n\tconstructor(u32data, x, y, w, h, realw) {\r\n\t\tthis.data = u32data;\r\n\t\tif (options.chunkBugWorkaround) {\r\n\t\t\tthis.changes = [];\r\n\t\t}\r\n\t\tthis.offx = x;\r\n\t\tthis.offy = y;\r\n\t\tthis.realwidth = realw;\r\n\t\tthis.width = w;\r\n\t\tthis.height = h;\r\n\t}\r\n\r\n\tget(x, y) {\r\n\t\treturn this.data[(this.offx + x) + (this.offy + y) * this.realwidth];\r\n\t}\r\n\r\n\tset(x, y, data) {\r\n\t\tthis.data[(this.offx + x) + (this.offy + y) * this.realwidth] = data;\r\n\t\tif (options.chunkBugWorkaround) {\r\n\t\t\tthis.changes.push([0, x, y, data]);\r\n\t\t}\r\n\t}\r\n\r\n\tfill(data) {\r\n\t\tfor (var i = 0; i < this.height; i++) {\r\n\t\t\tfor (var j = 0; j < this.width; j++) {\r\n\t\t\t\tthis.data[(this.offx + j) + (this.offy + i) * this.realwidth] = data;\r\n\t\t\t}\r\n\t\t}\r\n\t\tif (options.chunkBugWorkaround) {\r\n\t\t\tthis.changes.push([1, 0, 0, data]);\r\n\t\t}\r\n\t}\r\n\r\n\tfillFromBuf(u32buf) {\r\n\t\tfor (var i = 0; i < this.height; i++) {\r\n\t\t\tfor (var j = 0; j < this.width; j++) {\r\n\t\t\t\tthis.data[(this.offx + j) + (this.offy + i) * this.realwidth] = u32buf[j + i * this.width];\r\n\t\t\t\tif (options.chunkBugWorkaround) {\r\n\t\t\t\t\t/* Terrible */\r\n\t\t\t\t\tthis.changes.push([0, j, i, u32buf[j + i * this.width]]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nclass ChunkCluster {\r\n\tconstructor(x, y) {\r\n\t\tthis.removed = false;\r\n\t\tthis.toUpdate = false;\r\n\t\tthis.shown = false; /* is in document? */\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.canvas = document.createElement(\"canvas\");\r\n\t\tthis.canvas.width = protocol.chunkSize * protocol.clusterChunkAmount;\r\n\t\tthis.canvas.height = protocol.chunkSize * protocol.clusterChunkAmount;\r\n\t\tthis.ctx = this.canvas.getContext(\"2d\");\r\n\t\tthis.data = this.ctx.createImageData(this.canvas.width, this.canvas.height);\r\n\t\tthis.u32data = new Uint32Array(this.data.data.buffer);\r\n\t\tthis.chunks = [];\r\n\t\tif (options.chunkBugWorkaround) {\r\n\t\t\tthis.currentColor = 0;\r\n\t\t}\r\n\t}\r\n\t\r\n\trender() {\r\n\t\tthis.toUpdate = false;\r\n\t\tfor (var i = this.chunks.length; i--;) {\r\n\t\t\tvar c = this.chunks[i];\r\n\t\t\tif (c.needsRedraw) {\r\n\t\t\t\tc.needsRedraw = false;\r\n\t\t\t\tif (options.chunkBugWorkaround) {\r\n\t\t\t\t\tvar arr = c.view.changes;\r\n\t\t\t\t\tvar s = protocol.chunkSize;\r\n\t\t\t\t\tfor (var j = 0; j < arr.length; j++) {\r\n\t\t\t\t\t\tvar current = arr[j];\r\n\t\t\t\t\t\tif (this.currentColor !== current[3]) {\r\n\t\t\t\t\t\t\tthis.currentColor = current[3];\r\n\t\t\t\t\t\t\tthis.ctx.fillStyle = color.toHTML(current[3]);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tswitch (current[0]) {\r\n\t\t\t\t\t\tcase 0:\r\n\t\t\t\t\t\t\tthis.ctx.fillRect(c.view.offx + current[1], c.view.offy + current[2], 1, 1);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\tcase 1:\r\n\t\t\t\t\t\t\tthis.ctx.fillRect(c.view.offx, c.view.offy, s, s);\r\n\t\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tc.view.changes = [];\r\n\t\t\t\t} else {\r\n\t\t\t\t\tthis.ctx.putImageData(this.data, 0, 0,\r\n\t\t\t\t\t\tc.view.offx, c.view.offy, c.view.width, c.view.height);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tremove() {\r\n\t\tthis.removed = true;\r\n\t\tif (this.shown) {\r\n\t\t\tvar visiblecl = rendererValues.visibleClusters;\r\n\t\t\tvisiblecl.splice(visiblecl.indexOf(this), 1);\r\n\t\t\tthis.shown = false;\r\n\t\t}\r\n\t\tthis.canvas.width = 0;\r\n\t\tthis.u32data = this.data = null;\r\n\t\tdelete rendererValues.clusters[`${this.x},${this.y}`];\r\n\t\tfor (var i = 0; i < this.chunks.length; i++) {\r\n\t\t\tthis.chunks[i].view = null;\r\n\t\t\tthis.chunks[i].remove();\r\n\t\t}\r\n\t\tthis.chunks = [];\r\n\t}\r\n\t\r\n\taddChunk(chunk) {\r\n\t\t/* WARNING: Should absMod if not power of two */\r\n\t\tvar x = chunk.x & (protocol.clusterChunkAmount - 1);\r\n\t\tvar y = chunk.y & (protocol.clusterChunkAmount - 1);\r\n\t\tvar s = protocol.chunkSize;\r\n\t\tvar view = new BufView(this.u32data, x * s, y * s, s, s, protocol.clusterChunkAmount * s);\r\n\t\tif (chunk.tmpChunkBuf) {\r\n\t\t\tview.fillFromBuf(chunk.tmpChunkBuf);\r\n\t\t\tchunk.tmpChunkBuf = null;\r\n\t\t}\r\n\t\tchunk.view = view;\r\n\t\tthis.chunks.push(chunk);\r\n\t\tchunk.needsRedraw = true;\r\n\t}\r\n\t\r\n\tdelChunk(chunk) {\r\n\t\tchunk.view = null;\r\n\t\t/* There is no real need to clearRect the chunk area */\r\n\t\tvar i = this.chunks.indexOf(chunk);\r\n\t\tif (i !== -1) {\r\n\t\t\tthis.chunks.splice(i, 1);\r\n\t\t}\r\n\t\tif (!this.chunks.length) {\r\n\t\t\tthis.remove();\r\n\t\t}\r\n\t}\r\n}\r\n\r\n/* Draws white text with a black border */\r\nexport function drawText(ctx, str, x, y, centered){\r\n\tctx.strokeStyle = \"#000000\",\r\n\tctx.fillStyle = \"#FFFFFF\",\r\n\tctx.lineWidth = 2.5,\r\n\tctx.globalAlpha = 0.5;\r\n\tif(centered) {\r\n\t\tx -= ctx.measureText(str).width >> 1;\r\n\t}\r\n\tctx.strokeText(str, x, y);\r\n\tctx.globalAlpha = 1;\r\n\tctx.fillText(str, x, y);\r\n}\r\n\r\nfunction isVisible(x, y, w, h) {\r\n\tvar cx    = camera.x;\r\n\tvar cy    = camera.y;\r\n\tvar czoom = camera.zoom;\r\n\tvar cw    = window.innerWidth;\r\n\tvar ch    = window.innerHeight;\r\n\treturn x + w > cx && y + h > cy &&\r\n\t       x <= cx + cw / czoom && y <= cy + ch / czoom;\r\n}\r\n\r\nexport function unloadFarClusters() { /* Slow? */\r\n\tvar camx = camera.x;\r\n\tvar camy = camera.y;\r\n\tvar zoom = camera.zoom;\r\n\tvar camw = window.innerWidth / zoom | 0;\r\n\tvar camh = window.innerHeight / zoom | 0;\r\n\tvar ctrx = camx + camw / 2;\r\n\tvar ctry = camy + camh / 2;\r\n\tvar s = protocol.clusterChunkAmount * protocol.chunkSize;\r\n\tfor (var c in rendererValues.clusters) {\r\n\t\tc = rendererValues.clusters[c];\r\n\t\tif (!isVisible(c.x * s, c.y * s, s, s)) {\r\n\t\t\tvar dx = Math.abs(ctrx / s - c.x) | 0;\r\n\t\t\tvar dy = Math.abs(ctry / s - c.y) | 0;\r\n\t\t\tvar dist = dx + dy; /* no sqrt please */\r\n\t\t\t//console.log(dist);\r\n\t\t\tif (dist > options.unloadDistance) {\r\n\t\t\t\tc.remove();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction render(type) {\r\n\tvar time = getTime(true);\r\n\tvar camx = camera.x;\r\n\tvar camy = camera.y;\r\n\tvar zoom = camera.zoom;\r\n\tvar needsRender = 0; /* If an animation didn't finish, render again */\r\n\t\r\n\tif (type & renderer.rendertype.WORLD) {\r\n\t\tvar uClusters = rendererValues.updatedClusters;\r\n\t\tfor (var i = 0; i < uClusters.length; i++) {\r\n\t\t\tvar c = uClusters[i];\r\n\t\t\tc.render();\r\n\t\t}\r\n\t\trendererValues.updatedClusters = [];\r\n\t}\r\n\t\r\n\tif (type & renderer.rendertype.FX && misc.world !== null) {\r\n\t\tvar ctx = rendererValues.animContext;\r\n\t\tvar visible = rendererValues.visibleClusters;\r\n\t\tvar clusterCanvasSize = protocol.chunkSize * protocol.clusterChunkAmount;\r\n\t\tvar cwidth = window.innerWidth;\r\n\t\tvar cheight = window.innerHeight;\r\n\t\tvar background = rendererValues.worldBackground;\r\n\t\tvar allChunksLoaded = misc.world.allChunksLoaded();\r\n\r\n\t\tif (!allChunksLoaded) {\r\n\t\t\tctx.clearRect(0, 0, ctx.canvas.width, ctx.canvas.height);\r\n\t\t}\r\n\t\t\r\n\t\tctx.lineWidth = 2.5 / 16 * zoom;\r\n\r\n\t\tctx.scale(zoom, zoom);\r\n\r\n\t\tfor (var i = 0; i < visible.length; i++) {\r\n\t\t\tvar cluster = visible[i];\r\n\t\t\tvar gx = -(camx - cluster.x * clusterCanvasSize);\r\n\t\t\tvar gy = -(camy - cluster.y * clusterCanvasSize);\r\n\t\t\tvar clipx = gx < 0 ? -gx : 0;\r\n\t\t\tvar clipy = gy < 0 ? -gy : 0;\r\n\t\t\tvar x = gx < 0 ? 0 : gx;\r\n\t\t\tvar y = gy < 0 ? 0 : gy;\r\n\t\t\tvar clipw = clusterCanvasSize - clipx;\r\n\t\t\tvar cliph = clusterCanvasSize - clipy;\r\n\t\t\tclipw = clipw + x < cwidth / zoom ? clipw : cwidth / zoom - x;\r\n\t\t\tcliph = cliph + y < cheight / zoom ? cliph : cheight / zoom - y;\r\n\t\t\tclipw = (clipw + 1) | 0; /* Math.ceil */\r\n\t\t\tcliph = (cliph + 1) | 0;\r\n\t\t\tif (clipw > 0 && cliph > 0) {\r\n\t\t\t\tctx.drawImage(cluster.canvas, clipx, clipy, clipw, cliph, x, y, clipw, cliph);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tctx.scale(1 / zoom, 1 / zoom); /* probably faster than ctx.save(), ctx.restore() */\r\n\t\t\r\n\t\tif (background != null) {\r\n\t\t\tvar newscale = zoom / options.defaultZoom;\r\n\t\t\tvar oldscale = options.defaultZoom / zoom;\r\n\t\t\tvar gx = -(camx * zoom) % (background.width * newscale);\r\n\t\t\tvar gy = -(camy * zoom) % (background.height * newscale);\r\n\t\t\tctx.translate(gx, gy);\r\n\r\n\t\t\tctx.fillStyle = background;\r\n\t\t\tctx.globalCompositeOperation = \"destination-over\";\r\n\t\t\t\r\n\t\t\tctx.scale(newscale, newscale);\r\n\t\t\tctx.fillRect(-gx / newscale, -gy / newscale, ctx.canvas.width * oldscale, ctx.canvas.height * oldscale);\r\n\t\t\tctx.scale(oldscale, oldscale);\r\n\r\n\t\t\tctx.translate(-gx, -gy);\r\n\t\t}\r\n\r\n\t\tvar gx = -(camx * zoom) % (16 * zoom);\r\n\t\tvar gy = -(camy * zoom) % (16 * zoom);\r\n\t\tctx.translate(gx, gy);\r\n\r\n\t\tif (rendererValues.gridShown && rendererValues.gridPattern) {\r\n\t\t\tctx.fillStyle = rendererValues.gridPattern;\r\n\t\t\tif (!allChunksLoaded) {\r\n\t\t\t\tctx.globalCompositeOperation = \"source-atop\";\r\n\t\t\t}\r\n\t\t\tctx.fillRect(-gx, -gy, ctx.canvas.width, ctx.canvas.height);\r\n\t\t}\r\n\r\n\t\tif (rendererValues.unloadedPattern != null && (!allChunksLoaded || background != null)) {\r\n\t\t\tctx.fillStyle = rendererValues.unloadedPattern;\r\n\t\t\tctx.globalCompositeOperation = \"destination-over\";\r\n\t\t\tctx.fillRect(-gx, -gy, ctx.canvas.width, ctx.canvas.height);\r\n\t\t}\r\n\r\n\t\tctx.translate(-gx, -gy);\r\n\r\n\t\tctx.globalCompositeOperation = \"source-over\";\r\n\r\n\t\tfor (var i = 0; i < activeFx.length; i++) {\r\n\t\t\tswitch (activeFx[i].render(ctx, time)) {\r\n\t\t\tcase 0: /* Anim not finished */\r\n\t\t\t\tneedsRender |= renderer.rendertype.FX;\r\n\t\t\t\tbreak;\r\n\t\t\tcase 2: /* Obj deleted from array, prevent flickering */\r\n\t\t\t\t--i;\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\t\tctx.globalAlpha = 1;\r\n\t\tvar players = misc.world.players;\r\n\t\tvar fontsize = 10 / 16 * zoom | 0;\r\n\t\tif (rendererValues.currentFontSize != fontsize) {\r\n\t\t\tctx.font = fontsize + \"px sans-serif\";\r\n\t\t\trendererValues.currentFontSize = fontsize;\r\n\t\t}\r\n\t\tfor (var p in players) {\r\n\t\t\tvar player = players[p];\r\n\t\t\tif (!renderPlayer(player, fontsize)) {\r\n\t\t\t\tneedsRender |= renderer.rendertype.FX;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\trequestRender(needsRender);\r\n}\r\n\r\nfunction renderPlayer(targetPlayer, fontsize) {\r\n\tvar camx = camera.x * 16;\r\n\tvar camy = camera.y * 16;\r\n\tvar zoom = camera.zoom;\r\n\tvar ctx  = rendererValues.animContext;\r\n\tvar cnvs = ctx.canvas;\r\n\tvar tool = targetPlayer.tool;\r\n\tif (!tool) {\r\n\t\t/* Render the default tool if the selected one isn't defined */\r\n\t\ttool = tools['cursor'];\r\n\t}\r\n\tvar toolwidth = tool.cursor.width / 16 * zoom;\r\n\tvar toolheight = tool.cursor.height / 16 * zoom;\r\n\r\n\tvar x = targetPlayer.x;\r\n\tvar y = targetPlayer.y;\r\n\tvar cx = ((x - camx) - tool.offset[0]) * (zoom / 16) | 0;\r\n\tvar cy = ((y - camy) - tool.offset[1]) * (zoom / 16) | 0;\r\n\r\n\tif(cx < -toolwidth || cy < -toolheight\r\n\t|| cx > cnvs.width || cy > cnvs.height) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\t\r\n\tif (fontsize > 3) {\r\n\t\tvar idstr = targetPlayer.id;\r\n\t\tvar textw = ctx.measureText(idstr).width + (zoom / 2);\r\n\t\t\r\n\t\tctx.globalAlpha = 1;\r\n\t\tctx.fillStyle = targetPlayer.clr;\r\n\t\tctx.fillRect(cx, cy + toolheight, textw, zoom);\r\n\t\tctx.globalAlpha = 0.2;\r\n\t\tctx.lineWidth = 3;\r\n\t\tctx.strokeStyle = \"#000000\";\r\n\t\tctx.strokeRect(cx, cy + toolheight, textw, zoom);\r\n\t\tctx.globalAlpha = 1;\r\n\t\tdrawText(ctx, idstr, cx + zoom / 4, cy + fontsize + toolheight + zoom / 8);\r\n\t}\r\n\r\n\tctx.drawImage(tool.cursor, cx, cy, toolwidth, toolheight);\r\n\r\n\treturn x === targetPlayer.endX && y === targetPlayer.endY;\r\n}\r\n\r\nfunction requestRender(type) {\r\n\trendererValues.updateRequired |= type;\r\n}\r\n\r\nfunction setGridVisibility(enabled) {\r\n\trendererValues.gridShown = enabled;\r\n\trequestRender(renderer.rendertype.FX);\r\n}\r\n\r\nfunction renderGrid(zoom) {\r\n\tvar tmpcanvas = document.createElement(\"canvas\");\r\n\tvar ctx = tmpcanvas.getContext(\"2d\");\r\n\tvar size = tmpcanvas.width = tmpcanvas.height = Math.round(16 * zoom);\r\n\tctx.setLineDash([1]);\r\n\tctx.globalAlpha = 0.2;\r\n\tif (zoom >= 4) {\r\n\t\tvar fadeMult = Math.min(1, zoom - 4);\r\n\t\tif (fadeMult < 1) {\r\n\t\t\tctx.globalAlpha = 0.2 * fadeMult;\r\n\t\t}\r\n\t\tctx.beginPath();\r\n\t\tfor (var i = 16; --i;) {\r\n\t\t\tctx.moveTo(i * zoom + .5, 0);\r\n\t\t\tctx.lineTo(i * zoom + .5, size);\r\n\t\t\tctx.moveTo(0, i * zoom + .5);\r\n\t\t\tctx.lineTo(size, i * zoom + .5);\r\n\t\t}\r\n\t\tctx.stroke();\r\n\t\tctx.globalAlpha = Math.max(0.2, 1 * fadeMult);\r\n\t}\r\n\tctx.beginPath();\r\n\tctx.moveTo(0, 0);\r\n\tctx.lineTo(0, size);\r\n\tctx.lineTo(size, size);\r\n\tctx.stroke();\r\n\treturn ctx.createPattern(tmpcanvas, \"repeat\");\r\n}\r\n\r\nfunction setGridZoom(zoom) {\r\n\tif (zoom >= rendererValues.minGridZoom) {\r\n\t\trendererValues.gridPattern = renderGrid(zoom);\r\n\t} else {\r\n\t\trendererValues.gridPattern = null;\r\n\t}\r\n}\r\n\r\nfunction updateVisible() {\r\n\tvar clusters = rendererValues.clusters;\r\n\tvar visiblecl = rendererValues.visibleClusters;\r\n\tfor (var c in clusters) {\r\n\t\tc = clusters[c];\r\n\t\tvar size = protocol.chunkSize * protocol.clusterChunkAmount;\r\n\t\tvar visible = isVisible(c.x * size, c.y * size, size, size);\r\n\t\tif (!visible && c.shown) {\r\n\t\t\tc.shown = false;\r\n\t\t\tvisiblecl.splice(visiblecl.indexOf(c), 1);\r\n\t\t} else if (visible && !c.shown) {\r\n\t\t\tc.shown = true;\r\n\t\t\tvisiblecl.push(c);\r\n\t\t\trequestRender(renderer.rendertype.WORLD);\r\n\t\t}\r\n\t}\r\n};\r\n\r\nfunction onResize() {\r\n\telements.animCanvas.width = window.innerWidth;\r\n\telements.animCanvas.height = window.innerHeight;\r\n\tvar ctx = rendererValues.animContext;\r\n\tctx.imageSmoothingEnabled = false;\r\n\tctx.webkitImageSmoothingEnabled = false;\r\n\tctx.mozImageSmoothingEnabled = false;\r\n\tctx.msImageSmoothingEnabled = false;\r\n\tctx.oImageSmoothingEnabled = false;\r\n\trendererValues.currentFontSize = -1;\r\n\tonCameraMove();\r\n}\r\n\r\nfunction alignCamera() {\r\n\tvar zoom = cameraValues.zoom;\r\n\tvar alignedX = Math.round(cameraValues.x * zoom) / zoom;\r\n\tvar alignedY = Math.round(cameraValues.y * zoom) / zoom;\r\n\tcameraValues.x = alignedX;\r\n\tcameraValues.y = alignedY;\r\n}\r\n\r\nfunction requestMissingChunks() { /* TODO: move this to World */\r\n\tvar x = camera.x / protocol.chunkSize - 2 | 0;\r\n\tvar mx = camera.x / protocol.chunkSize + window.innerWidth / camera.zoom / protocol.chunkSize | 0;\r\n\tvar cy = camera.y / protocol.chunkSize - 2 | 0;\r\n\tvar my = camera.y / protocol.chunkSize + window.innerHeight / camera.zoom / protocol.chunkSize | 0;\r\n\twhile (++x <= mx) {\r\n\t\tvar y = cy;\r\n\t\twhile (++y <= my) {\r\n\t\t\tmisc.world.loadChunk(x, y);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nfunction onCameraMove() {\r\n\teventSys.emit(e.camera.moved, camera);\r\n\talignCamera();\r\n\tupdateVisible();\r\n\tif (misc.world !== null) {\r\n\t\trequestMissingChunks();\r\n\t}\r\n\trequestRender(renderer.rendertype.FX);\r\n}\r\n\r\nfunction getCenterPixel() {\r\n\tvar x = Math.round(cameraValues.x + window.innerWidth / camera.zoom / 2);\r\n\tvar y = Math.round(cameraValues.y + window.innerHeight / camera.zoom / 2);\r\n\treturn [x, y];\r\n}\r\n\r\nfunction centerCameraTo(x, y) {\r\n\tcameraValues.x = -(window.innerWidth / camera.zoom / 2) + x;\r\n\tcameraValues.y = -(window.innerHeight / camera.zoom / 2) + y;\r\n\tonCameraMove();\r\n}\r\n\r\nfunction moveCameraBy(x, y) {\r\n\tcameraValues.x += x;\r\n\tcameraValues.y += y;\r\n\tonCameraMove();\r\n}\r\n\r\nfunction moveCameraTo(x, y) {\r\n\tcameraValues.x = x;\r\n\tcameraValues.y = y;\r\n\tonCameraMove();\r\n}\r\n\r\neventSys.on(e.net.world.teleported, (x, y) => {\r\n\tcenterCameraTo(x, y);\r\n});\r\n\r\neventSys.on(e.camera.zoom, z => {\r\n\tsetGridZoom(z);\r\n\t/*cameraValues.lerpZoom.val = z;*/\r\n\trequestRender(renderer.rendertype.FX);\r\n});\r\n\r\neventSys.on(e.renderer.addChunk, chunk => {\r\n\tvar clusterX = Math.floor(chunk.x / protocol.clusterChunkAmount);\r\n\tvar clusterY = Math.floor(chunk.y / protocol.clusterChunkAmount);\r\n\tvar key = `${clusterX},${clusterY}`;\r\n\tvar clusters = rendererValues.clusters;\r\n\tvar cluster = clusters[key];\r\n\tif (!cluster) {\r\n\t\tcluster = clusters[key] = new ChunkCluster(clusterX, clusterY);\r\n\t\tupdateVisible();\r\n\t}\r\n\tcluster.addChunk(chunk);\r\n\tif (!cluster.toUpdate) {\r\n\t\tcluster.toUpdate = true;\r\n\t\trendererValues.updatedClusters.push(cluster);\r\n\t}\r\n\tvar size = protocol.chunkSize;\r\n\tif (cluster.toUpdate || isVisible(chunk.x * size, chunk.y * size, size, size)) {\r\n\t\trequestRender(renderer.rendertype.WORLD | renderer.rendertype.FX);\r\n\t}\r\n});\r\n\r\neventSys.on(e.renderer.rmChunk, chunk => {\r\n\tvar clusterX = Math.floor(chunk.x / protocol.clusterChunkAmount);\r\n\tvar clusterY = Math.floor(chunk.y / protocol.clusterChunkAmount);\r\n\tvar key = `${clusterX},${clusterY}`;\r\n\tvar clusters = rendererValues.clusters;\r\n\tvar cluster = clusters[key];\r\n\tif (cluster) {\r\n\t\tcluster.delChunk(chunk);\r\n\t\tif (!cluster.removed && !cluster.toUpdate) {\r\n\t\t\tcluster.toUpdate = true;\r\n\t\t\trendererValues.updatedClusters.push(cluster);\r\n\t\t}\r\n\t}\r\n});\r\n\r\neventSys.on(e.renderer.updateChunk, chunk => {\r\n\tvar clusterX = Math.floor(chunk.x / protocol.clusterChunkAmount);\r\n\tvar clusterY = Math.floor(chunk.y / protocol.clusterChunkAmount);\r\n\tvar key = `${clusterX},${clusterY}`;\r\n\tvar cluster = rendererValues.clusters[key];\r\n\tif (cluster && !cluster.toUpdate) {\r\n\t\tcluster.toUpdate = true;\r\n\t\trendererValues.updatedClusters.push(cluster);\r\n\t}\r\n\tvar size = protocol.chunkSize;\r\n\tif (isVisible(chunk.x * size, chunk.y * size, size, size)) {\r\n\t\trequestRender(renderer.rendertype.WORLD | renderer.rendertype.FX);\r\n\t}\r\n});\r\n\r\neventSys.on(e.misc.worldInitialized, () => {\r\n\trequestMissingChunks();\r\n});\r\n\r\neventSys.once(e.init, () => {\r\n\trendererValues.animContext = elements.animCanvas.getContext(\"2d\", { alpha: false });\r\n\twindow.addEventListener(\"resize\", onResize);\r\n\tonResize();\r\n\tcamera.zoom = options.defaultZoom;\r\n\tcenterCameraTo(0, 0);\r\n\r\n\tconst mkPatternFromUrl = (url, cb) => {\r\n\t\tvar patImg = new Image();\r\n\t\tpatImg.onload = () => {\r\n\t\t\tvar pat = rendererValues.animContext.createPattern(patImg, \"repeat\");\r\n\t\t\tpat.width = patImg.width;\r\n\t\t\tpat.height = patImg.height;\r\n\t\t\tcb(pat);\r\n\t\t};\r\n\t\tpatImg.src = url;\r\n\t};\r\n\r\n\t/* Create the pattern images */\r\n\tmkPatternFromUrl(options.unloadedPatternUrl, pat => {\r\n\t\trendererValues.unloadedPattern = pat;\r\n\t});\r\n\r\n\tif (options.backgroundUrl != null) {\r\n\t\tmkPatternFromUrl(options.backgroundUrl, pat => {\r\n\t\t\trendererValues.worldBackground = pat;\r\n\t\t});\r\n\t}\r\n\r\n\tfunction frameLoop() {\r\n\t\tlet type;\r\n\t\tif ((type = rendererValues.updateRequired) !== 0) {\r\n\t\t\trendererValues.updateRequired = 0;\r\n\t\t\trender(type);\r\n\t\t}\r\n\t\twindow.requestAnimationFrame(frameLoop);\r\n\t}\r\n\teventSys.once(e.misc.toolsInitialized, frameLoop);\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/canvas_renderer.js","'use strict';\r\nimport { eventSys, PublicAPI } from './global.js';\r\nimport { EVENTS as e, RANK } from './conf.js';\r\nimport { absMod, setTooltip } from './util/misc.js';\r\nimport { elements, mouse, misc, showDevChat, showPlayerList } from './main.js';\r\nimport { colorUtils as color } from './util/color.js';\r\nimport { renderer } from './canvas_renderer.js';\r\nimport { cursors } from './tool_renderer.js';\r\nimport { tools, updateToolbar, updateToolWindow } from './tools.js';\r\nimport { Fx, PLAYERFX } from './Fx.js';\r\nimport { net } from './networking.js';\r\nimport { Bucket } from './util/Bucket.js';\r\n\r\nexport { updateClientFx };\r\n\r\nlet toolSelected = null;\r\n\r\n// SWEETIE 16 palette\r\n/*const palette = [\r\n\t[0x1A, 0x1C, 0x2C], [0x57, 0x29, 0x56], [0xB1, 0x41, 0x56], [0xEE, 0x7B, 0x58],\r\n\t[0xFF, 0xD0, 0x79], [0xA0, 0xF0, 0x72], [0x38, 0xB8, 0x6E], [0x27, 0x6E, 0x7B],\r\n\t[0x29, 0x36, 0x6F], [0x40, 0x5B, 0xD0], [0x4F, 0xA4, 0xF7], [0x86, 0xEC, 0xF8],\r\n\t[0xF4, 0xF4, 0xF4], [0x93, 0xB6, 0xC1], [0x55, 0x71, 0x85], [0x32, 0x40, 0x56]\r\n];*/\r\n// ENDESGA 16 palette\r\nconst palette = [\r\n\t[0xE4, 0xA6, 0x72], [0xB8, 0x6F, 0x50], [0x74, 0x3F, 0x39], [0x3F, 0x28, 0x32],\r\n\t[0x9E, 0x28, 0x35], [0xE5, 0x3B, 0x44], [0xFB, 0x92, 0x2B], [0xFF, 0xE7, 0x62],\r\n\t[0x63, 0xC6, 0x4D], [0x32, 0x73, 0x45], [0x19, 0x3D, 0x3F], [0x4F, 0x67, 0x81],\r\n\t[0xAF, 0xBF, 0xD2], [0xFF, 0xFF, 0xFF], [0x2C, 0xE8, 0xF4], [0x04, 0x84, 0xD1]\r\n];\r\nlet paletteIndex = 0;\r\n\r\nexport const undoHistory = [];\r\n\r\nconst clientFx = new Fx(PLAYERFX.NONE, {\r\n\tisLocalPlayer: true,\r\n\tplayer: {\r\n\t\tget tileX() { return mouse.tileX; },\r\n\t\tget tileY() { return mouse.tileY; },\r\n\t\tget x() { return mouse.worldX; },\r\n\t\tget y() { return mouse.worldY; },\r\n\t\tget htmlRgb() {\r\n\t\t\treturn player.htmlRgb;\r\n\t\t},\r\n\t\tget tool() {\r\n\t\t\treturn player.tool;\r\n\t\t}\r\n\t}\r\n});\r\n\r\nclientFx.setVisibleFunc(() => {\r\n\treturn mouse.insideViewport && mouse.validTile;\r\n});\r\n\r\n// exported variables are always const it seems\r\nexport const networkRankVerification = [RANK.NONE];\r\nlet rank = RANK.NONE;\r\nlet somethingChanged = false;\r\n\r\nlet cachedHtmlRgb = [null, \"\"];\r\n\r\nexport const player = {\r\n\tget paletteIndex() { return paletteIndex; },\r\n\tset paletteIndex(i) {\r\n\t\tpaletteIndex = absMod(i, palette.length);\r\n\t\tupdatePalette();\r\n\t},\r\n\tget htmlRgb() {\r\n\t\tvar selClr = player.selectedColor;\r\n\t\tif (cachedHtmlRgb[0] === selClr) {\r\n\t\t\treturn cachedHtmlRgb[1];\r\n\t\t} else {\r\n\t\t\tvar str = color.toHTML(color.u24_888(selClr[0], selClr[1], selClr[2]));\r\n\t\t\tcachedHtmlRgb[0] = selClr;\r\n\t\t\tcachedHtmlRgb[1] = str;\r\n\t\t\treturn str;\r\n\t\t}\r\n\t},\r\n\tget selectedColor() { return palette[paletteIndex]; },\r\n\tset selectedColor(c) {\r\n\t\taddPaletteColor(c);\r\n\t},\r\n\tget palette() { return palette; },\r\n\tget rank() { return rank },\r\n\tget tool() { return toolSelected; },\r\n\tset tool(name) {\r\n\t\tselectTool(name);\r\n\t},\r\n\t/* TODO: Clear confusion between netid and tool id */\r\n\tget toolId() { return net.currentServer.proto.tools.id[toolSelected.id]; },\r\n\tget tools() { return tools; }\r\n};\r\n\r\nPublicAPI.player = player;\r\n\r\nexport function shouldUpdate() { /* sets colorChanged to false when called */\r\n\treturn somethingChanged ? !(somethingChanged = false) : somethingChanged;\r\n}\r\n\r\nfunction changedColor() {\r\n\tupdateClientFx();\r\n\tupdatePaletteIndex();\r\n\tsomethingChanged = true;\r\n}\r\n\r\nfunction updatePalette() {\r\n\tvar paletteColors = elements.paletteColors;\r\n\tpaletteColors.innerHTML = \"\";\r\n\tvar colorClick = (index) => () => {\r\n\t\tpaletteIndex = index;\r\n\t\tchangedColor();\r\n\t};\r\n\tvar colorDelete = (index) => () => {\r\n\t\tif(palette.length > 1) {\r\n\t\t\tpalette.splice(index, 1);\r\n\t\t\tif(paletteIndex > index || paletteIndex === palette.length) {\r\n\t\t\t\t--paletteIndex;\r\n\t\t\t}\r\n\t\t\tupdatePalette();\r\n\t\t\tchangedColor();\r\n\t\t}\r\n\t};\r\n\r\n\tfor (var i = 0; i < palette.length; i++) {\r\n\t\tvar element = document.createElement(\"div\");\r\n\t\tvar clr = palette[i];\r\n\t\telement.style.backgroundColor = \"rgb(\" + clr[0] + \",\" + clr[1] + \",\" + clr[2] + \")\";\r\n\t\tsetTooltip(element, color.toHTML(color.u24_888(clr[0], clr[1], clr[2])));\r\n\t\telement.onmouseup = function(e) {\r\n\t\t\tswitch(e.button) {\r\n\t\t\t\tcase 0:\r\n\t\t\t\t\tthis.sel();\r\n\t\t\t\t\tbreak;\r\n\t\t\t\tcase 2:\r\n\t\t\t\t\tthis.del();\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t\treturn false;\r\n\t\t}.bind({\r\n\t\t\tsel: colorClick(i),\r\n\t\t\tdel: colorDelete(i)\r\n\t\t});\r\n\t\telement.oncontextmenu = () => false;\r\n\t\tpaletteColors.appendChild(element);\r\n\t}\r\n\tchangedColor();\r\n}\r\n\r\nfunction updatePaletteIndex() {\r\n\telements.paletteColors.style.transform = \"translateY(\" + (-paletteIndex * 40) + \"px)\";\r\n}\r\n\r\nfunction addPaletteColor(color) {\r\n\tfor (var i = 0; i < palette.length; i++) {\r\n\t\tif (palette[i][0] === color[0] && palette[i][1] === color[1] && palette[i][2] === color[2]) {\r\n\t\t\tpaletteIndex = i;\r\n\t\t\tchangedColor();\r\n\t\t\treturn;\r\n\t\t}\r\n\t}\r\n\tpaletteIndex = palette.length;\r\n\tpalette.push(color);\r\n\tupdatePalette();\r\n}\r\n\r\nexport function getDefaultTool() {\r\n\tfor (var toolName in tools) {\r\n\t\tif (tools[toolName].rankRequired <= player.rank) {\r\n\t\t\treturn toolName;\r\n\t\t}\r\n\t}\r\n\treturn null;\r\n}\r\n\r\nfunction selectTool(name) {\r\n\tlet tool = tools[name];\r\n\tif(!tool || tool === toolSelected || tool.rankRequired > player.rank) {\r\n\t\treturn false;\r\n\t}\r\n\tif (toolSelected) {\r\n\t\ttoolSelected.call('deselect');\r\n\t}\r\n\ttoolSelected = tool;\r\n\tmouse.cancelMouseDown();\r\n\ttool.call('select');\r\n\tupdateToolWindow(name);\r\n\tmouse.validClick = false;\r\n\tclientFx.setRenderer(tool.fxRenderer);\r\n\tsomethingChanged = true;\r\n\tupdateClientFx();\r\n\treturn true;\r\n}\r\n\r\nfunction updateClientFx() {\r\n\trenderer.render(renderer.rendertype.FX);\r\n}\r\n\r\neventSys.once(e.misc.toolsInitialized, () => {\r\n\tplayer.tool = getDefaultTool();\r\n});\r\n\r\neventSys.on(e.net.sec.rank, newRank => {\r\n\tif (networkRankVerification[0] < newRank) {\r\n\t\treturn;\r\n\t}\r\n\trank = newRank;\r\n\tconsole.log('Got rank:', newRank);\r\n\t/* This is why we can't have nice things */\r\n\tif (net.isConnected()) {\r\n\t\tnet.protocol.ws.send((new Uint8Array([newRank])).buffer);\r\n\t}\r\n\tswitch (newRank) {\r\n\t\tcase RANK.USER:\r\n\t\tcase RANK.NONE:\r\n\t\t\tshowDevChat(false);\r\n\t\t\tshowPlayerList(false);\r\n\t\t\tbreak;\r\n\r\n\t\tcase RANK.MODERATOR:\r\n\t\tcase RANK.ADMIN:\r\n\t\t\tshowDevChat(true);\r\n\t\t\tshowPlayerList(true);\r\n\t\t\tbreak;\r\n\t}\r\n\tupdateToolbar();\r\n});\r\n\r\neventSys.once(e.init, () => {\r\n\telements.paletteInput.onclick = function() {\r\n\t\tvar c = player.selectedColor;\r\n\t\tthis.value = color.toHTML(color.u24_888(c[0], c[1], c[2]));;\r\n\t};\r\n\telements.paletteInput.onchange = function() {\r\n\t\tvar value = /^#?([a-f\\d]{2})([a-f\\d]{2})([a-f\\d]{2})$/i.exec(this.value);\r\n\t\taddPaletteColor([parseInt(value[1], 16), parseInt(value[2], 16), parseInt(value[3], 16)]);\r\n\t};\r\n\telements.paletteCreate.onclick = () => elements.paletteInput.click();\r\n\tsetTooltip(elements.paletteCreate, \"Add color\");\r\n\tupdatePalette();\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/local_player.js","\"use strict\";\r\nimport { colorUtils as color } from './util/color.js';\r\nimport { EVENTS as e, protocol } from './conf.js';\r\nimport { getTime } from './util/misc.js';\r\nimport { eventSys, PublicAPI } from './global.js';\r\nimport { camera, renderer } from './canvas_renderer.js';\r\n\r\nexport const PLAYERFX = {\r\n\tNONE: null,\r\n\tRECT_SELECT_ALIGNED: (pixelSize, htmlColor) => (fx, ctx, time) => {\r\n\t\tvar x = fx.extra.player.x;\r\n\t\tvar y = fx.extra.player.y;\r\n\t\tvar fxx = (Math.floor(x / (16 * pixelSize)) * pixelSize - camera.x) * camera.zoom;\r\n\t\tvar fxy = (Math.floor(y / (16 * pixelSize)) * pixelSize - camera.y) * camera.zoom;\r\n\t\tctx.globalAlpha = 0.8;\r\n\t\tctx.strokeStyle = htmlColor || fx.extra.player.htmlRgb;\r\n\t\tctx.strokeRect(fxx, fxy, camera.zoom * pixelSize, camera.zoom * pixelSize);\r\n\t\treturn 1; /* Rendering finished (won't change on next frame) */\r\n\t}\r\n};\r\n\r\nexport const WORLDFX = {\r\n\tNONE: null,\r\n\tRECT_FADE_ALIGNED: (size, x, y, startTime = getTime()) => (fx, ctx, time) => {\r\n\t\tvar alpha = 1 - (time - startTime) / 1000;\r\n\t\tif (alpha <= 0) {\r\n\t\t\tfx.delete();\r\n\t\t\treturn 2; /* 2 = An FX object was deleted */\r\n\t\t}\r\n\t\tvar fxx = (x * size - camera.x) * camera.zoom;\r\n\t\tvar fxy = (y * size - camera.y) * camera.zoom;\r\n\t\tctx.globalAlpha = alpha;\r\n\t\tctx.strokeStyle = fx.extra.htmlRgb || \"#000000\";\r\n\t\tctx.strokeRect(fxx, fxy, camera.zoom * size, camera.zoom * size);\r\n\t\treturn 0; /* 0 = Animation not finished */\r\n\t}\r\n};\r\n\r\nexport const activeFx = [];\r\n\r\n/*PublicAPI.activeFx = activeFx;*/\r\n\r\nexport class Fx {\r\n    constructor(renderFunc, extra) {\r\n\t\tthis.visible = true;\r\n\t\tthis.renderFunc = renderFunc;\r\n\t\tthis.extra = extra || {};\r\n\t\tactiveFx.push(this);\r\n\t}\r\n\r\n\trender(ctx, time) {\r\n\t\tif (this.renderFunc && this.visible) {\r\n\t\t\treturn this.renderFunc(this, ctx, time);\r\n\t\t}\r\n\t\treturn 1;\r\n\t}\r\n\t\r\n\tsetVisibleFunc(func) {\r\n\t\tObject.defineProperty(this, 'visible', {\r\n\t\t\tget: func\r\n\t\t});\r\n\t}\r\n\r\n\tsetVisible(bool) {\r\n\t\tthis.visible = bool;\r\n\t}\r\n\r\n\tsetRenderer(func) {\r\n\t\tthis.renderFunc = func;\r\n\t}\r\n\t\r\n\tupdate(extra) {\r\n\t\tthis.extra = extra;\r\n\t}\r\n\r\n\tdelete() {\r\n\t\tvar i = activeFx.indexOf(this);\r\n\t\tif(i !== -1) {\r\n\t\t\tactiveFx.splice(i, 1);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nPublicAPI.fx = {\r\n\tworld: WORLDFX,\r\n\tplayer: PLAYERFX,\r\n\tclass: Fx\r\n};\r\n\r\neventSys.on(e.net.world.tilesUpdated, tiles => {\r\n\tlet time = getTime(true);\r\n\tlet made = false;\r\n\tfor (var i = 0; i < tiles.length; i++) {\r\n\t\tvar t = tiles[i];\r\n\t\tif (camera.isVisible(t.x, t.y, 1, 1)) {\r\n\t\t\tnew Fx(WORLDFX.RECT_FADE_ALIGNED(1, t.x, t.y), { htmlRgb: color.toHTML(t.rgb ^ 0xFFFFFF) });\r\n\t\t\tmade = true;\r\n\t\t}\r\n\t}\r\n\tif (made) {\r\n\t\trenderer.render(renderer.rendertype.FX);\r\n\t}\r\n});\r\n\r\neventSys.on(e.net.chunk.set, (chunkX, chunkY, data) => {\r\n\tvar wX = chunkX * protocol.chunkSize;\r\n\tvar wY = chunkY * protocol.chunkSize;\r\n\tif (camera.isVisible(wX, wY, protocol.chunkSize, protocol.chunkSize)) {\r\n\t\tnew Fx(WORLDFX.RECT_FADE_ALIGNED(16, chunkX, chunkY));\r\n\t\trenderer.render(renderer.rendertype.FX);\r\n\t}\r\n});\r\n\r\neventSys.on(e.net.chunk.lock, (chunkX, chunkY, state, local) => {\r\n\tvar wX = chunkX * protocol.chunkSize;\r\n\tvar wY = chunkY * protocol.chunkSize;\r\n\tif (!local && camera.isVisible(wX, wY, protocol.chunkSize, protocol.chunkSize)) {\r\n\t\tnew Fx(WORLDFX.RECT_FADE_ALIGNED(16, chunkX, chunkY), {\r\n\t\t\thtmlRgb: state ? \"#00FF00\" : \"#FF0000\"\r\n\t\t});\r\n\t\trenderer.render(renderer.rendertype.FX);\r\n\t}\r\n});\n\n\n// WEBPACK FOOTER //\n// ./src/js/Fx.js","'use strict';\r\nimport { EVENTS as e, protocol } from './conf.js';\r\nimport { eventSys, PublicAPI } from './global.js';\r\n\r\nexport const net = {\r\n\tcurrentServer: null,\r\n\tprotocol: null,\r\n\tisConnected: isConnected,\r\n\tconnect: connect\r\n};\r\n\r\nPublicAPI.net = net;\r\n\r\nfunction isConnected() {\r\n\treturn net.protocol !== null && net.protocol.isConnected();\r\n}\r\n\r\nfunction connect(server, worldName) {\r\n\teventSys.emit(e.net.connecting, server);\r\n\tnet.connection = new WebSocket("ws://localhost:7000");\r\n\tnet.connection.binaryType = \"arraybuffer\";\r\n\tnet.currentServer = server;\r\n\tnet.protocol = new server.proto.class(net.connection, worldName);\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/networking.js","'use strict';\r\n\r\nexport class Bucket {\r\n\tconstructor(rate, time) {\r\n\t\tthis.lastCheck = Date.now();\r\n\t\tthis.allowance = rate;\r\n\t\tthis.rate = rate;\r\n\t\tthis.time = time;\r\n\t\tthis.infinite = false;\r\n\t}\r\n\t\r\n\tcanSpend(count) {\r\n\t\tif (this.infinite) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\t\r\n\t\tthis.allowance += (Date.now() - this.lastCheck) / 1000 * (this.rate / this.time);\r\n\t\tthis.lastCheck = Date.now();\r\n\t\tif (this.allowance > this.rate) {\r\n\t\t\tthis.allowance = this.rate;\r\n\t\t}\r\n\t\tif (this.allowance < count) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tthis.allowance -= count;\r\n\t\treturn true;\r\n\t}\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/util/Bucket.js","'use strict';\r\nimport { PublicAPI, eventSys } from './global.js';\r\nimport { EVENTS as e, protocol, options, RANK } from './conf.js';\r\nimport { absMod, setTooltip, mkHTML, line } from './util/misc.js';\r\nimport { cursors } from './tool_renderer.js';\r\nimport { net } from './networking.js';\r\nimport { player } from './local_player.js';\r\nimport { camera, moveCameraTo, moveCameraBy, renderer, drawText } from './canvas_renderer.js';\r\nimport { windowSys, GUIWindow, UtilDialog } from './windowsys.js';\r\nimport { misc, elements, mouse, sounds } from './main.js';\r\nimport { PLAYERFX } from './Fx.js';\r\n\r\nexport const tools = {};\r\nexport let toolsWindow = null;\r\nlet windowShown = false;\r\n\r\nexport function updateToolWindow(name) {\r\n\tif (!toolsWindow) {\r\n\t\treturn;\r\n\t}\r\n\tlet tool = tools[name];\r\n\tvar children = toolsWindow.container.children;\r\n\tfor (var i = 0; i < children.length; i++) {\r\n\t\tvar button = children[i];\r\n\t\tvar isSelected = button.id.split('-')[1] === name;\r\n\t\tbutton.className = isSelected ? 'selected' : '';\r\n\t\tbutton.children[0].style.backgroundImage = \"url(\" + (isSelected ? cursors.slotset : cursors.set.src) + \")\";\r\n\t}\r\n\telements.viewport.style.cursor = \"url(\" + tool.cursorblob + \") \" + tool.offset[0] + \" \" + tool.offset[1] + \", pointer\";\r\n}\r\n\r\nexport function updateToolbar(win = toolsWindow) {\r\n\tif (!win) {\r\n\t\treturn;\r\n\t}\r\n\r\n\tconst container = win.container;\r\n\tconst toolButtonClick = name => event => {\r\n\t\tplayer.tool = name;\r\n\t\tsounds.play(sounds.click);\r\n\t};\r\n\r\n\tcontainer.innerHTML = \"\";\r\n\r\n\t// Add tools to the tool-select menu\r\n\tfor (const name in tools) {\r\n\t\tvar tool = tools[name];\r\n\t\tif (player.rank >= tool.rankRequired) {\r\n\t\t\tvar element = document.createElement(\"button\");\r\n\t\t\tvar mask = document.createElement(\"div\");\r\n\t\t\tsetTooltip(element, tool.name + \" tool\");\r\n\t\t\telement.id = \"tool-\" + name;\r\n\t\t\telement.addEventListener(\"click\", toolButtonClick(name));\r\n\t\t\tif (tool === player.tool) {\r\n\t\t\t\tmask.style.backgroundImage = \"url(\" + cursors.slotset + \")\";\r\n\t\t\t\telement.className = \"selected\";\r\n\t\t\t} else {\r\n\t\t\t\tmask.style.backgroundImage = \"url(\" + cursors.set.src + \")\";\r\n\t\t\t}\r\n\t\t\tmask.style.backgroundPosition = tool.setposition;\r\n\t\t\telement.appendChild(mask);\r\n\t\t\tcontainer.appendChild(element);\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport function showToolsWindow(bool) {\r\n\tif (windowShown !== bool) {\r\n\t\tif (bool && toolsWindow) {\r\n\t\t\twindowSys.addWindow(toolsWindow);\r\n\t\t} else if (toolsWindow) {\r\n\t\t\twindowSys.delWindow(toolsWindow);\r\n\t\t}\r\n\t\twindowShown = bool;\r\n\t}\r\n}\r\n\r\nexport function addTool(tool) {\r\n\ttool.id = tool.name.toLowerCase();\r\n\ttools[tool.id] = tool;\r\n\tupdateToolbar();\r\n}\r\n\r\nclass Tool {\r\n    constructor(name, cursor, fxRenderer, rankNeeded, onInit) {\r\n\t\tthis.name = name;\r\n\t\tthis.id = null;\r\n        this.fxRenderer = fxRenderer;\r\n        this.cursorblob = cursor.img.shadowblob;\r\n        this.cursor = cursor.img.shadowed;\r\n        this.setposition = (-cursor.imgpos[0] * 36) + \"px \" + (-cursor.imgpos[1] * 36) + \"px\";\r\n        this.offset = cursor.hotspot;\r\n        this.rankRequired = rankNeeded;\r\n        this.extra = {}; /* Extra storage for tools */\r\n        this.events = {\r\n\t\t\tmouseup: null,\r\n\t\t\tmousedown: null,\r\n\t\t\tmousemove: null,\r\n\t\t\ttouchstart: null,\r\n\t\t\ttouchmove: null,\r\n\t\t\ttouchend: null,\r\n\t\t\ttouchcancel: null,\r\n\t\t\tselect: null,\r\n\t\t\tdeselect: null,\r\n\t\t\tkeydown: null,\r\n\t\t\tkeyup: null,\r\n\t\t\tscroll: null,\r\n\t\t\ttick: null\r\n        };\r\n        onInit(this);\r\n\t}\r\n\r\n\t/* Doesn't update if tool already selected */\r\n\tsetFxRenderer(func) {\r\n\t\tthis.fxRenderer = func;\r\n\t}\r\n\r\n\tisEventDefined(type) {\r\n\t\treturn type in this.events;\r\n\t}\r\n\r\n    setEvent(type, func) {\r\n\t\tvar events = type.split(' ');\r\n\t\tfor (var i = 0; i < events.length; i++) {\r\n\t\t\tthis.events[events[i]] = func || null;\r\n\t\t}\r\n    }\r\n\r\n    call(type, data) {\r\n        var func = this.events[type];\r\n        if (func) {\r\n            return func.apply(this, data);\r\n        } else if (type.indexOf(\"touch\") === 0) {\r\n            return this.defaultTouchHandler(type.slice(5), data);\r\n        }\r\n        return false;\r\n    }\r\n\r\n    defaultTouchHandler(type, data) {\r\n\t\tvar mouse = data[0];\r\n\t\tvar event = data[1]; /* hmm... */\r\n\t\tvar handlers = {\r\n\t\t\tstart: this.events.mousedown,\r\n\t\t\tmove: this.events.mousemove,\r\n\t\t\tend: this.events.mouseup,\r\n\t\t\tcancel: this.events.mouseup\r\n\t\t};\r\n\t\tvar handler = handlers[type];\r\n\t\tif (handler) {\r\n\t\t\tvar touches = event.changedTouches;\r\n\t\t\tfor (var i = 0; i < touches.length; i++) {\r\n\t\t\t\tmouse.x = touches[i].pageX;\r\n\t\t\t\tmouse.y = touches[i].pageY;\r\n\t\t\t\thandler.apply(this, data);\r\n\t\t\t}\r\n\t\t}\r\n    }\r\n}\r\n\r\nPublicAPI.tool = {\r\n\tclass: Tool,\r\n\taddToolObject: addTool,\r\n\tupdateToolbar,\r\n\tallTools: tools\r\n};\r\n\r\neventSys.once(e.misc.toolsRendered, () => {\r\n\t// Cursor tool\r\n\taddTool(new Tool('Cursor', cursors.cursor, PLAYERFX.RECT_SELECT_ALIGNED(1), RANK.USER,\r\n\t\ttool => {\r\n\t\t\tvar lastX,\r\n\t\t\t    lastY;\r\n\t\t\ttool.setEvent('mousedown mousemove', (mouse, event) => {\r\n\t\t\t\tvar usedButtons = 0b11; /* Left and right mouse buttons are always used... */\r\n\t\t\t\t/* White color if right clicking */\r\n\t\t\t\tvar color = mouse.buttons === 2 ? [255, 255, 255] : player.selectedColor;\r\n\t\t\t\tswitch (mouse.buttons) {\r\n\t\t\t\t\tcase 1:\r\n\t\t\t\t\tcase 2:\r\n\t\t\t\t\t\tif (!lastX || !lastY) {\r\n\t\t\t\t\t\t\tlastX = mouse.tileX;\r\n\t\t\t\t\t\t\tlastY = mouse.tileY;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tline(lastX, lastY, mouse.tileX, mouse.tileY, 1, (x, y) => {\r\n\t\t\t\t\t\t\tvar pixel = misc.world.getPixel(x, y);\r\n\t\t\t\t\t\t\tif (pixel !== null && !(color[0] === pixel[0] && color[1] === pixel[1] && color[2] === pixel[2])) {\r\n\t\t\t\t\t\t\t\tmisc.world.setPixel(x, y, color);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tlastX = mouse.tileX;\r\n\t\t\t\t\t\tlastY = mouse.tileY;\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\tcase 4:\r\n\t\t\t\t\t\tif (event.ctrlKey) {\r\n\t\t\t\t\t\t\tusedButtons |= 0b100;\r\n\t\t\t\t\t\t\tvar color = misc.world.getPixel(mouse.tileX, mouse.tileY);\r\n\t\t\t\t\t\t\tif (color) {\r\n\t\t\t\t\t\t\t\tplayer.selectedColor = color;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\treturn usedButtons;\r\n\t\t\t});\r\n\t\t\ttool.setEvent('mouseup', mouse => {\r\n\t\t\t\tlastX = null;\r\n\t\t\t\tlastY = null;\r\n\t\t\t});\r\n\t\t}\r\n\t));\r\n\r\n\t// Move tool\r\n\taddTool(new Tool('Move', cursors.move, PLAYERFX.NONE, RANK.NONE,\r\n\t\ttool => {\r\n\t\t\tfunction move(x, y, startX, startY) {\r\n\t\t\t\tmoveCameraBy((startX - x) / 16, (startY - y) / 16);\r\n\t\t\t}\r\n\t\t\ttool.setEvent('mousemove', (mouse, event) => {\r\n\t\t\t\tif (mouse.buttons !== 0) {\r\n\t\t\t\t\tmove(mouse.worldX, mouse.worldY, mouse.mouseDownWorldX, mouse.mouseDownWorldY);\r\n\t\t\t\t\treturn mouse.buttons;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\ttool.setEvent('scroll', (mouse, event, rawEvent) => {\r\n\t\t\t\tif (!rawEvent.ctrlKey) {\r\n\t\t\t\t\tvar dx = Math.max(-500, Math.min(event.spinX * 16, 500));\r\n\t\t\t\t\tvar dy = Math.max(-500, Math.min(event.spinY * 16, 500));\r\n\t\t\t\t\tvar pxAmount = camera.zoom//Math.max(camera.zoom, 2);\r\n\t\t\t\t\tmoveCameraBy(dx / pxAmount, dy / pxAmount);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t));\r\n\r\n\t// Pipette tool\r\n\taddTool(new Tool('Pipette', cursors.pipette, PLAYERFX.NONE, RANK.NONE,\r\n\t\ttool => {\r\n\t\t\ttool.setEvent('mousedown mousemove', (mouse, event) => {\r\n\t\t\t\tif (mouse.buttons !== 0 && !(mouse.buttons & 0b100)) {\r\n\t\t\t\t\tvar color = misc.world.getPixel(mouse.tileX, mouse.tileY);\r\n\t\t\t\t\tif (color) {\r\n\t\t\t\t\t\tplayer.selectedColor = color;\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn mouse.buttons;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t));\r\n\r\n\t// Erase/Fill tool\r\n\taddTool(new Tool('Eraser', cursors.erase, PLAYERFX.RECT_SELECT_ALIGNED(16), RANK.ADMIN,\r\n\t\ttool => {\r\n\t\t\tfunction fillChunk(chunkX, chunkY, c) {\r\n\t\t\t\tconst color = c[2] << 16 | c[1] << 8 | c[0];\r\n\t\t\t\tvar chunk = misc.world.getChunkAt(chunkX, chunkY);\r\n\t\t\t\tif (chunk) {\r\n\t\t\t\t\tvar empty = true;\r\n\t\t\t\t\tfirstLoop: for (var y = 0; y < protocol.chunkSize; y++) {\r\n\t\t\t\t\t\tfor (var x = 0; x < protocol.chunkSize; x++) {\r\n\t\t\t\t\t\t\tif ((chunk.get(x, y) & 0xFFFFFF) != color) {\r\n\t\t\t\t\t\t\t\tempty = false;\r\n\t\t\t\t\t\t\t\tbreak firstLoop;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (!empty) {\r\n\t\t\t\t\t\tchunk.set(color);\r\n\t\t\t\t\t\tnet.protocol.setChunk(chunkX, chunkY, new Array(256).fill(color));\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttool.setEvent('mousedown mousemove', (mouse, event) => {\r\n\t\t\t\tif (mouse.buttons & 0b1) {\r\n\t\t\t\t\tfillChunk(Math.floor(mouse.tileX / protocol.chunkSize), Math.floor(mouse.tileY / protocol.chunkSize), player.selectedColor);\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t} else if (mouse.buttons & 0b10) {\r\n\t\t\t\t\tfillChunk(Math.floor(mouse.tileX / protocol.chunkSize), Math.floor(mouse.tileY / protocol.chunkSize), [255, 255, 255]);\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t));\r\n\r\n\t// Zoom tool\r\n\taddTool(new Tool('Zoom', cursors.zoom, PLAYERFX.NONE, RANK.NONE,\r\n\t\ttool => {\r\n\t\t\tfunction zoom(mouse, type) {\r\n\t\t\t\tvar lzoom = camera.zoom;\r\n\t\t\t\tvar nzoom = camera.zoom;\r\n\t\t\t\tvar offX = 0;\r\n\t\t\t\tvar offY = 0;\r\n\t\t\t\tvar w = window.innerWidth;\r\n\t\t\t\tvar h = window.innerHeight;\r\n\t\t\t\tif (type === 1) {\r\n\t\t\t\t\t// Zoom in\r\n\t\t\t\t\tnzoom *= 1 + options.zoomStrength;\r\n\t\t\t\t\toffX = (mouse.x - w / 2) / nzoom;\r\n\t\t\t\t\toffY = (mouse.y - h / 2) / nzoom;\r\n\t\t\t\t} else if (type === 2) {\r\n\t\t\t\t\t// Zoom out\r\n\t\t\t\t\tnzoom /= 1 + options.zoomStrength;\r\n\t\t\t\t\toffX = (mouse.x - w / 2) * (3 / lzoom - 2 / nzoom);\r\n\t\t\t\t\toffY = (mouse.y - h / 2) * (3 / lzoom - 2 / nzoom);\r\n\t\t\t\t} else if (type === 3) {\r\n\t\t\t\t\t// Reset zoom (right + left click)\r\n\t\t\t\t\tnzoom = options.defaultZoom;\r\n\t\t\t\t}\r\n\t\t\t\tnzoom = Math.round(nzoom);\r\n\t\t\t\tcamera.zoom = nzoom;\r\n\t\t\t\tif (camera.zoom !== lzoom) {\r\n\t\t\t\t\tmoveCameraBy(offX, offY);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\ttool.setEvent(\"mousedown\", (mouse, event) => {\r\n\t\t\t\tzoom(mouse, mouse.buttons);\r\n\t\t\t});\r\n\t\t\ttool.setEvent(\"touchstart\", (mouse, event) => {\r\n\t\t\t\ttool.extra.maxTouches = Math.max(tool.extra.maxTouches || 0, event.touches.length);\r\n\t\t\t});\r\n\t\t\ttool.setEvent(\"touchend\", (mouse, event) => {\r\n\t\t\t\tif (event.touches.length === 0) {\r\n\t\t\t\t\tif (tool.extra.maxTouches > 1) {\r\n\t\t\t\t\t\tzoom(mouse, tool.extra.maxTouches);\r\n\t\t\t\t\t}\r\n\t\t\t\t\ttool.extra.maxTouches = 0;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t));\r\n\r\n\t// Area to PNG tool\r\n\taddTool(new Tool('Export', cursors.select, PLAYERFX.NONE, RANK.NONE,\r\n\t\ttool => {\r\n\t\t\ttool.setFxRenderer((fx, ctx, time) => {\r\n\t\t\t\tif (!fx.extra.isLocalPlayer) return 1;\r\n\t\t\t\tvar x = fx.extra.player.x;\r\n\t\t\t\tvar y = fx.extra.player.y;\r\n\t\t\t\tvar fxx = (Math.floor(x / 16) - camera.x) * camera.zoom;\r\n\t\t\t\tvar fxy = (Math.floor(y / 16) - camera.y) * camera.zoom;\r\n\t\t\t\tvar oldlinew = ctx.lineWidth;\r\n\t\t\t\tctx.lineWidth = 1;\r\n\t\t\t\tif (tool.extra.end) {\r\n\t\t\t\t\tvar s = tool.extra.start;\r\n\t\t\t\t\tvar e = tool.extra.end;\r\n\t\t\t\t\tvar x = (s[0] - camera.x) * camera.zoom + 0.5;\r\n\t\t\t\t\tvar y = (s[1] - camera.y) * camera.zoom + 0.5;\r\n\t\t\t\t\tvar w = e[0] - s[0];\r\n\t\t\t\t\tvar h = e[1] - s[1];\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.rect(x, y, w * camera.zoom, h * camera.zoom);\r\n\t\t\t\t\tctx.globalAlpha = 1;\r\n\t\t\t\t\tctx.strokeStyle = \"#FFFFFF\";\r\n\t\t\t\t\tctx.stroke();\r\n\t\t\t\t\tctx.setLineDash([3, 4]);\r\n\t\t\t\t\tctx.strokeStyle = \"#000000\";\r\n\t\t\t\t\tctx.stroke();\r\n\t\t\t\t\tctx.globalAlpha = 0.25 + Math.sin(time / 500) / 4;\r\n\t\t\t\t\tctx.fillStyle = renderer.patterns.unloaded;\r\n\t\t\t\t\tctx.fill();\r\n\t\t\t\t\tctx.setLineDash([]);\r\n\t\t\t\t\tvar oldfont = ctx.font;\r\n\t\t\t\t\tctx.font = \"16px sans-serif\";\r\n\t\t\t\t\tvar txt = `${!tool.extra.clicking ? \"Right click to screenshot \" : \"\"}(${Math.abs(w)}x${Math.abs(h)})`;\r\n\t\t\t\t\tvar txtx = window.innerWidth >> 1;\r\n\t\t\t\t\tvar txty = window.innerHeight >> 1;\r\n\t\t\t\t\ttxtx = Math.max(x, Math.min(txtx, x + w * camera.zoom));\r\n\t\t\t\t\ttxty = Math.max(y, Math.min(txty, y + h * camera.zoom));\r\n\r\n\t\t\t\t\tdrawText(ctx, txt, txtx, txty, true);\r\n\t\t\t\t\tctx.font = oldfont;\r\n\t\t\t\t\tctx.lineWidth = oldlinew;\r\n\t\t\t\t\treturn 0;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tctx.beginPath();\r\n\t\t\t\t\tctx.moveTo(0, fxy + 0.5);\r\n\t\t\t\t\tctx.lineTo(window.innerWidth, fxy + 0.5);\r\n\t\t\t\t\tctx.moveTo(fxx + 0.5, 0);\r\n\t\t\t\t\tctx.lineTo(fxx + 0.5, window.innerHeight);\r\n\r\n\t\t\t\t\t//ctx.lineWidth = 1;\r\n\t\t\t\t\tctx.globalAlpha = 1;\r\n\t\t\t\t\tctx.strokeStyle = \"#FFFFFF\";\r\n\t\t\t\t\tctx.stroke();\r\n\t\t\t\t\tctx.setLineDash([3]);\r\n\t\t\t\t\tctx.strokeStyle = \"#000000\";\r\n\t\t\t\t\tctx.stroke();\r\n\r\n\t\t\t\t\tctx.setLineDash([]);\r\n\t\t\t\t\tctx.lineWidth = oldlinew;\r\n\t\t\t\t\treturn 1;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tfunction dlarea(x, y, w, h, onblob){\r\n\t\t\t\tvar c = document.createElement('canvas');\r\n\t\t\t\tc.width = w;\r\n\t\t\t\tc.height = h;\r\n\t\t\t\tvar ctx = c.getContext('2d');\r\n\t\t\t\tvar d = ctx.createImageData(w, h);\r\n\t\t\t\tfor(var i = y; i < y + h; i++){\r\n\t\t\t\t  for(var j = x; j < x + w; j++){\r\n\t\t\t\t\tvar pix = misc.world.getPixel(j, i);\r\n\t\t\t\t\tif (!pix) continue;\r\n\t\t\t\t\td.data[4*((i - y)*w + (j - x))] = pix[0];\r\n\t\t\t\t\td.data[4*((i - y)*w + (j - x)) + 1] = pix[1];\r\n\t\t\t\t\td.data[4*((i - y)*w + (j - x)) + 2] = pix[2];\r\n\t\t\t\t\td.data[4*((i - y)*w + (j - x)) + 3] = 255;\r\n\t\t\t\t  }\r\n\t\t\t\t}\r\n\t\t\t\tctx.putImageData(d, 0, 0);\r\n\t\t\t\tc.toBlob(onblob);\r\n\t\t\t  }\r\n\r\n\t\t\ttool.extra.start = null;\r\n\t\t\ttool.extra.end = null;\r\n\t\t\ttool.extra.clicking = false;\r\n\r\n\t\t\ttool.setEvent('mousedown', (mouse, event) => {\r\n\t\t\t\tvar s = tool.extra.start;\r\n\t\t\t\tvar e = tool.extra.end;\r\n\t\t\t\tconst isInside = () => mouse.tileX >= s[0] && mouse.tileX < e[0] && mouse.tileY >= s[1] && mouse.tileY < e[1];\r\n\t\t\t\tif (mouse.buttons === 1 && !tool.extra.end) {\r\n\t\t\t\t\ttool.extra.start = [mouse.tileX, mouse.tileY];\r\n\t\t\t\t\ttool.extra.clicking = true;\r\n\t\t\t\t\ttool.setEvent('mousemove', (mouse, event) => {\r\n\t\t\t\t\t\tif (tool.extra.start && mouse.buttons === 1) {\r\n\t\t\t\t\t\t\ttool.extra.end = [mouse.tileX, mouse.tileY];\r\n\t\t\t\t\t\t\treturn 1;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconst finish = () => {\r\n\t\t\t\t\t\ttool.setEvent('mousemove mouseup deselect', null);\r\n\t\t\t\t\t\ttool.extra.clicking = false;\r\n\t\t\t\t\t\tvar s = tool.extra.start;\r\n\t\t\t\t\t\tvar e = tool.extra.end;\r\n\t\t\t\t\t\tif (e) {\r\n\t\t\t\t\t\t\tif (s[0] === e[0] || s[1] === e[1]) {\r\n\t\t\t\t\t\t\t\ttool.extra.start = null;\r\n\t\t\t\t\t\t\t\ttool.extra.end = null;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (s[0] > e[0]) {\r\n\t\t\t\t\t\t\t\tvar tmp = e[0];\r\n\t\t\t\t\t\t\t\te[0] = s[0];\r\n\t\t\t\t\t\t\t\ts[0] = tmp;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\tif (s[1] > e[1]) {\r\n\t\t\t\t\t\t\t\tvar tmp = e[1];\r\n\t\t\t\t\t\t\t\te[1] = s[1];\r\n\t\t\t\t\t\t\t\ts[1] = tmp;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\trenderer.render(renderer.rendertype.FX);\r\n\t\t\t\t\t};\r\n\t\t\t\t\ttool.setEvent('deselect', finish);\r\n\t\t\t\t\ttool.setEvent('mouseup', (mouse, event) => {\r\n\t\t\t\t\t\tif (!(mouse.buttons & 1)) {\r\n\t\t\t\t\t\t\tfinish();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t});\r\n\t\t\t\t} else if (mouse.buttons === 1 && tool.extra.end) {\r\n\t\t\t\t\tif (isInside()) {\r\n\t\t\t\t\t\tvar offx = mouse.tileX;\r\n\t\t\t\t\t\tvar offy = mouse.tileY;\r\n\t\t\t\t\t\ttool.setEvent('mousemove', (mouse, event) => {\r\n\t\t\t\t\t\t\tvar dx = mouse.tileX - offx;\r\n\t\t\t\t\t\t\tvar dy = mouse.tileY - offy;\r\n\t\t\t\t\t\t\ttool.extra.start = [s[0] + dx, s[1] + dy];\r\n\t\t\t\t\t\t\ttool.extra.end = [e[0] + dx, e[1] + dy];\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tconst end = () => {\r\n\t\t\t\t\t\t\ttool.setEvent('mouseup deselect mousemove', null);\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\ttool.setEvent('deselect', end);\r\n\t\t\t\t\t\ttool.setEvent('mouseup', (mouse, event) => {\r\n\t\t\t\t\t\t\tif (!(mouse.buttons & 1)) {\r\n\t\t\t\t\t\t\t\tend();\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\ttool.extra.start = null;\r\n\t\t\t\t\t\ttool.extra.end = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t} else if (mouse.buttons === 2 && tool.extra.end && isInside()) {\r\n\t\t\t\t\ttool.extra.start = null;\r\n\t\t\t\t\ttool.extra.end = null;\r\n\t\t\t\t\tvar cvs = dlarea(s[0], s[1], e[0] - s[0], e[1] - s[1], b => {\r\n\t\t\t\t\t\tvar url = URL.createObjectURL(b);\r\n\t\t\t\t\t\tvar img = new Image();\r\n\t\t\t\t\t\timg.onload = () => {\r\n\t\t\t\t\t\t\twindowSys.addWindow(new GUIWindow(\"Resulting image\", {\r\n\t\t\t\t\t\t\t\tcenterOnce: true,\r\n\t\t\t\t\t\t\t\tcloseable: true\r\n\t\t\t\t\t\t\t}, function(win) {\r\n\t\t\t\t\t\t\t\tvar props = ['width', 'height'];\r\n\t\t\t\t\t\t\t\tif (img.width > img.height) {\r\n\t\t\t\t\t\t\t\t\tprops.reverse();\r\n\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\tvar r = img[props[0]] / img[props[1]];\r\n\t\t\t\t\t\t\t\tvar shownSize = img[props[1]] >= 128 ? 256 : 128;\r\n\t\t\t\t\t\t\t\timg[props[0]] = r * shownSize;\r\n\t\t\t\t\t\t\t\timg[props[1]] = shownSize;\r\n\t\t\t\t\t\t\t\twin.container.classList.add('centeredChilds')\r\n\t\t\t\t\t\t\t\tvar image = win.addObj(img);\r\n\t\t\t\t\t\t\t\tsetTooltip(img, \"Right click to copy/save!\");\r\n\t\t\t\t\t\t\t\t/*var okButton = win.addObj(mkHTML(\"button\", {\r\n\t\t\t\t\t\t\t\t\tinnerHTML: \"OK\",\r\n\t\t\t\t\t\t\t\t\tstyle: \"display: block; width: 80px; height: 30px; margin: auto;\",\r\n\t\t\t\t\t\t\t\t\tonclick: function() {\r\n\t\t\t\t\t\t\t\t\t\timg.remove();\r\n\t\t\t\t\t\t\t\t\t\tURL.revokeObjectURL(url);\r\n\t\t\t\t\t\t\t\t\t\twin.getWindow().close();\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t}));*/\r\n\t\t\t\t\t\t\t}));\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\timg.src = url;\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t));\r\n\r\n\t// Fill tool\r\n\taddTool(new Tool('Fill', cursors.fill, PLAYERFX.NONE, RANK.USER, tool => {\r\n\t\ttool.extra.tickAmount = 6;\r\n\t\tvar queue = [];\r\n\t\tvar fillingColor = null;\r\n\t\tvar defaultFx = PLAYERFX.RECT_SELECT_ALIGNED(1);\r\n\t\ttool.setFxRenderer((fx, ctx, time) => {\r\n\t\t\tctx.globalAlpha = 0.8;\r\n\t\t\tctx.strokeStyle = fx.extra.player.htmlRgb;\r\n\t\t\tvar z = camera.zoom;\r\n\t\t\tif (!fillingColor || !fx.extra.isLocalPlayer) {\r\n\t\t\t\tdefaultFx(fx, ctx, time);\r\n\t\t\t} else {\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tfor (var i = 0; i < queue.length; i++) {\r\n\t\t\t\t\tctx.rect((queue[i][0] - camera.x) * z, (queue[i][1] - camera.y) * z, z, z);\r\n\t\t\t\t}\r\n\t\t\t\tctx.stroke();\r\n\t\t\t}\r\n\t\t});\r\n\t\tfunction tick() {\r\n\t\t\tconst eq = (a, b) => a && b && a[0] === b[0] && a[1] === b[1] && a[2] === b[2];\r\n\t\t\tconst check = (x, y) => {\r\n\t\t\t\tif (eq(misc.world.getPixel(x, y), fillingColor)) {\r\n\t\t\t\t\tqueue.unshift([x, y]);\r\n\t\t\t\t\treturn true;\r\n\t\t\t\t}\r\n\t\t\t\treturn false;\r\n\t\t\t};\r\n\r\n\t\t\tif (!queue.length || !fillingColor) {\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\r\n\t\t\tvar selClr = player.selectedColor;\r\n\t\t\tvar painted = 0;\r\n\t\t\tvar tickAmount = tool.extra.tickAmount;\r\n\t\t\tfor (var painted = 0; painted < tickAmount && queue.length; painted++) {\r\n\t\t\t\tvar current = queue.pop();\r\n\t\t\t\tvar x = current[0];\r\n\t\t\t\tvar y = current[1];\r\n\t\t\t\tvar thisClr = misc.world.getPixel(x, y);\r\n\t\t\t\tif (eq(thisClr, fillingColor) && !eq(thisClr, selClr)) {\r\n\t\t\t\t\tif (!misc.world.setPixel(x, y, selClr)) {\r\n\t\t\t\t\t\tqueue.push(current);\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// diamond check first\r\n\t\t\t\t\tvar top = check(x, y - 1);\r\n\t\t\t\t\tvar bottom = check(x, y + 1);\r\n\t\t\t\t\tvar left = check(x - 1, y);\r\n\t\t\t\t\tvar right = check(x + 1, y);\r\n\r\n\t\t\t\t\t// if corners are not closed by parts of the diamond, then they can be accessed\r\n\t\t\t\t\tif (top && left) {\r\n\t\t\t\t\t\tcheck(x - 1, y - 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (top && right) {\r\n\t\t\t\t\t\tcheck(x + 1, y - 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (bottom && left) {\r\n\t\t\t\t\t\tcheck(x - 1, y + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tif (bottom && right) {\r\n\t\t\t\t\t\tcheck(x + 1, y + 1);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\t// Shape diamond, infra not like\r\n\t\t\t\t\t/*check(x    , y - 1);\r\n\t\t\t\t\tcheck(x - 1, y    );\r\n\t\t\t\t\tcheck(x + 1, y    );\r\n\t\t\t\t\tcheck(x    , y + 1);*/\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\ttool.setEvent('mousedown', mouse => {\r\n\t\t\tif (!(mouse.buttons & 0b100)) {\r\n\t\t\t\tfillingColor = misc.world.getPixel(mouse.tileX, mouse.tileY);\r\n\t\t\t\tif (fillingColor) {\r\n\t\t\t\t\tqueue.push([mouse.tileX, mouse.tileY]);\r\n\t\t\t\t\ttool.setEvent('tick', tick);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\ttool.setEvent('mouseup deselect', mouse => {\r\n\t\t\tif (!mouse || !(mouse.buttons & 0b1)) {\r\n\t\t\t\tfillingColor = null;\r\n\t\t\t\tqueue = [];\r\n\t\t\t\ttool.setEvent('tick', null);\r\n\t\t\t}\r\n\t\t});\r\n\t}));\r\n\r\n\taddTool(new Tool('Line', cursors.wand, PLAYERFX.NONE, RANK.USER, tool => {\r\n\t\tvar start = null;\r\n\t\tvar end = null;\r\n\t\tvar queue = [];\r\n\t\tfunction line(x1, y1, x2, y2, plot) {\r\n\t\t\tvar dx =  Math.abs(x2 - x1), sx = x1 < x2 ? 1 : -1;\r\n\t\t\tvar dy = -Math.abs(y2 - y1), sy = y1 < y2 ? 1 : -1;\r\n\t\t\tvar err = dx + dy,\r\n\t\t\t    e2;\r\n\r\n\t\t\twhile(true) {\r\n\t\t\t\tplot(x1, y1);\r\n\t\t\t\tif (x1 == x2 && y1 == y2) break;\r\n\t\t\t\te2 = 2 * err;\r\n\t\t\t\tif (e2 >= dy) { err += dy; x1 += sx; }\r\n\t\t\t\tif (e2 <= dx) { err += dx; y1 += sy; }\r\n\t\t\t}\r\n\t\t}\r\n\t\tvar defaultFx = PLAYERFX.RECT_SELECT_ALIGNED(1);\r\n\t\ttool.setFxRenderer((fx, ctx, time) => {\r\n\t\t\tctx.globalAlpha = 0.8;\r\n\t\t\tctx.strokeStyle = fx.extra.player.htmlRgb;\r\n\t\t\tvar z = camera.zoom;\r\n\t\t\tif (!start || !end || !fx.extra.isLocalPlayer) {\r\n\t\t\t\tdefaultFx(fx, ctx, time);\r\n\t\t\t} else {\r\n\t\t\t\tctx.beginPath();\r\n\t\t\t\tline(start[0], start[1], end[0], end[1], (x, y) => {\r\n\t\t\t\t\tctx.rect((x - camera.x) * camera.zoom, (y - camera.y) * camera.zoom, camera.zoom, camera.zoom);\r\n\t\t\t\t});\r\n\t\t\t\tctx.stroke();\r\n\t\t\t}\r\n\t\t});\r\n\t\tfunction tick() {\r\n\t\t\tfor (var painted = 0; painted < 3 && queue.length; painted++) {\r\n\t\t\t\tvar current = queue.pop();\r\n\t\t\t\tvar c = misc.world.getPixel(current[0], current[1]);\r\n\t\t\t\tvar pc = player.selectedColor;\r\n\t\t\t\tif ((c[0] != pc[0] || c[1] != pc[1] || c[2] != pc[2]) && !misc.world.setPixel(current[0], current[1], player.selectedColor)) {\r\n\t\t\t\t\tqueue.push(current);\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (!queue.length) {\r\n\t\t\t\tstart = null;\r\n\t\t\t\tend = null;\r\n\t\t\t\ttool.setEvent('tick', null);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\t\ttool.setEvent('mousedown', mouse => {\r\n\t\t\tif (!(mouse.buttons & 0b100)) {\r\n\t\t\t\tqueue = [];\r\n\t\t\t\ttool.setEvent('tick', null);\r\n\t\t\t\tstart = [mouse.tileX, mouse.tileY];\r\n\t\t\t\tend = [mouse.tileX, mouse.tileY];\r\n\t\t\t}\r\n\t\t});\r\n\t\ttool.setEvent('mousemove', mouse => {\r\n\t\t\tif (!queue.length) {\r\n\t\t\t\tend = [mouse.tileX, mouse.tileY];\r\n\t\t\t}\r\n\t\t});\r\n\t\ttool.setEvent('mouseup', mouse => {\r\n\t\t\tif (!(mouse.buttons & 0b11) && !queue.length) {\r\n\t\t\t\tend = [mouse.tileX, mouse.tileY];\r\n\t\t\t\tif (!start) {\r\n\t\t\t\t\tend = null;\r\n\t\t\t\t\treturn;\r\n\t\t\t\t}\r\n\t\t\t\tif (player.rank == RANK.ADMIN) {\r\n\t\t\t\t\tline(start[0], start[1], end[0], end[1], (x, y) => {\r\n\t\t\t\t\t\tmisc.world.setPixel(x, y, player.selectedColor);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tstart = null;\r\n\t\t\t\t\tend = null;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tline(start[0], start[1], end[0], end[1], (x, y) => {\r\n\t\t\t\t\t\tqueue.push([x, y]);\r\n\t\t\t\t\t});\r\n\t\t\t\t\ttool.setEvent('tick', tick);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t\ttool.setEvent('deselect', mouse => {\r\n\t\t\tqueue = [];\r\n\t\t\tstart = null;\r\n\t\t\tend = null;\r\n\t\t\ttool.setEvent('tick', null);\r\n\t\t});\r\n\t}));\r\n\r\n\taddTool(new Tool('Protect', cursors.shield, PLAYERFX.RECT_SELECT_ALIGNED(16, \"#000000\"), RANK.MODERATOR, tool => {\r\n\t\ttool.setFxRenderer((fx, ctx, time) => {\r\n\t\t\tvar x = fx.extra.player.x;\r\n\t\t\tvar y = fx.extra.player.y;\r\n\t\t\tvar fxx = (Math.floor(x / 256) * 16 - camera.x) * camera.zoom;\r\n\t\t\tvar fxy = (Math.floor(y / 256) * 16 - camera.y) * camera.zoom;\r\n\t\t\tctx.globalAlpha = 0.5;\r\n\t\t\tvar chunkX = Math.floor(fx.extra.player.tileX / protocol.chunkSize);\r\n\t\t\tvar chunkY = Math.floor(fx.extra.player.tileY / protocol.chunkSize);\r\n\t\t\tvar chunk = misc.world.getChunkAt(chunkX, chunkY);\r\n\t\t\tif (chunk) {\r\n\t\t\t\tctx.fillStyle = chunk.locked ? \"#00FF00\" : \"#FF0000\";\r\n\t\t\t\tctx.fillRect(fxx, fxy, camera.zoom * 16, camera.zoom * 16);\r\n\t\t\t}\r\n\t\t\treturn 1; /* Rendering finished (won't change on next frame) */\r\n\t\t});\r\n\t\ttool.setEvent('mousedown mousemove', mouse => {\r\n\t\t\tvar chunkX = Math.floor(mouse.tileX / protocol.chunkSize);\r\n\t\t\tvar chunkY = Math.floor(mouse.tileY / protocol.chunkSize);\r\n\t\t\tvar chunk = misc.world.getChunkAt(chunkX, chunkY);\r\n\t\t\tswitch (mouse.buttons) {\r\n\t\t\t\tcase 0b1:\r\n\t\t\t\t\tif (!chunk.locked) {\r\n\t\t\t\t\t\tnet.protocol.protectChunk(chunkX, chunkY, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\r\n\t\t\t\tcase 0b10:\r\n\t\t\t\t\tif (chunk.locked) {\r\n\t\t\t\t\t\tnet.protocol.protectChunk(chunkX, chunkY, 0);\r\n\t\t\t\t\t}\r\n\t\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t});\r\n\t}));\r\n\r\n\taddTool(new Tool('Paste', cursors.paste, PLAYERFX.NONE, RANK.ADMIN, tool => {\r\n\t\ttool.setFxRenderer((fx, ctx, time) => {\r\n\t\t\tvar z = camera.zoom;\r\n\t\t\tvar x = fx.extra.player.x;\r\n\t\t\tvar y = fx.extra.player.y;\r\n\t\t\tvar fxx = Math.floor(x / 16) - camera.x;\r\n\t\t\tvar fxy = Math.floor(y / 16) - camera.y;\r\n\t\t\tif (tool.extra.canvas && fx.extra.isLocalPlayer) {\r\n\t\t\t\tctx.globalAlpha = 0.5 + Math.sin(time / 500) / 4;\r\n\t\t\t\tctx.strokeStyle = \"#000000\";\r\n\t\t\t\tctx.scale(z, z);\r\n\t\t\t\tctx.drawImage(tool.extra.canvas, fxx, fxy);\r\n\t\t\t\tctx.scale(1 / z, 1 / z);\r\n\t\t\t\tctx.globalAlpha = 0.8;\r\n\t\t\t\tctx.strokeRect(fxx * z, fxy * z, tool.extra.canvas.width * z, tool.extra.canvas.height * z);\r\n\t\t\t\treturn 0;\r\n\t\t\t}\r\n\t\t});\r\n\t\tconst paint = (tileX, tileY) => {\r\n\t\t\tvar tmpBuffer = new Uint32Array(protocol.chunkSize * protocol.chunkSize);\r\n\t\t\tvar ctx = tool.extra.canvas.getContext(\"2d\");\r\n\t\t\tvar dat = ctx.getImageData(0, 0, tool.extra.canvas.width, tool.extra.canvas.height);\r\n\t\t\tvar u32dat = new Uint32Array(dat.data.buffer);\r\n\t\t\tvar totalChunksW = Math.ceil((absMod(tileX, protocol.chunkSize) + dat.width) / protocol.chunkSize);\r\n\t\t\tvar totalChunksH = Math.ceil((absMod(tileY, protocol.chunkSize) + dat.height) / protocol.chunkSize);\r\n\t\t\tconst getModifiedPixel = (x, y) => {\r\n\t\t\t\tvar imgY = y - tileY;\r\n\t\t\t\tvar imgX = x - tileX;\r\n\t\t\t\tif (imgY < 0 || imgX < 0 || imgY >= dat.height || imgX >= dat.width) {\r\n\t\t\t\t\tvar currentPixel = misc.world.getPixel(x, y);\r\n\t\t\t\t\treturn currentPixel ? (currentPixel[2] << 16 | currentPixel[1] << 8 | currentPixel[0])\r\n\t\t\t\t\t\t: null;\r\n\t\t\t\t}\r\n\t\t\t\tvar img = u32dat[imgY * dat.width + imgX];\r\n\t\t\t\tvar oldPixel = misc.world.getPixel(x, y);\r\n\t\t\t\tvar alpha = img >> 24 & 0xFF;\r\n\t\t\t\tif (!oldPixel) {\r\n\t\t\t\t\treturn null;\r\n\t\t\t\t}\r\n\t\t\t\tvar r = (1 - alpha / 255) * oldPixel[0] + (alpha / 255) * (img       & 0xFF);\r\n\t\t\t\tvar g = (1 - alpha / 255) * oldPixel[1] + (alpha / 255) * (img >> 8  & 0xFF);\r\n\t\t\t\tvar b = (1 - alpha / 255) * oldPixel[2] + (alpha / 255) * (img >> 16 & 0xFF);\r\n\t\t\t\tvar rgb = b << 16 | g << 8 | r;\r\n\t\t\t\treturn (r == oldPixel[0] && g == oldPixel[1] && b == oldPixel[2]) ? rgb : 0xFF000000 | rgb;\r\n\t\t\t};\r\n\t\t\tconst getModifiedChunk = (chunkX, chunkY) => {\r\n\t\t\t\tvar modified = 0;\r\n\t\t\t\tvar offX = chunkX * protocol.chunkSize;\r\n\t\t\t\tvar offY = chunkY * protocol.chunkSize;\r\n\t\t\t\tfor (var y = 0; y < protocol.chunkSize; y++) {\r\n\t\t\t\t\tfor (var x = 0; x < protocol.chunkSize; x++) {\r\n\t\t\t\t\t\tvar color = getModifiedPixel(x + offX, y + offY);\r\n\t\t\t\t\t\tif (color !== null) {\r\n\t\t\t\t\t\t\tif (color & 0xFF000000) {\r\n\t\t\t\t\t\t\t\t++modified;\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\ttmpBuffer[y * protocol.chunkSize + x] = color & 0xFFFFFF;\r\n\t\t\t\t\t\t} else {\r\n\t\t\t\t\t\t\t/* Chunk not loaded... */\r\n\t\t\t\t\t\t\tthrow new Error(`Couldn't paste -- chunk (${chunkX}, ${chunkY}) is unloaded`);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\treturn modified ? tmpBuffer : null;\r\n\t\t\t};\r\n\t\t\tif (!net.protocol.setChunk) {\r\n\t\t\t\tthrow new Error(\"Protocol doesn't support pasting\");\r\n\t\t\t}\r\n\t\t\tfor (var y = Math.floor(tileY / protocol.chunkSize), t = totalChunksH; --t >= 0; y++) {\r\n\t\t\t\tfor (var x = Math.floor(tileX / protocol.chunkSize), tw = totalChunksW; --tw >= 0; x++) {\r\n\t\t\t\t\tvar newChunk = getModifiedChunk(x, y);\r\n\t\t\t\t\tif (newChunk) {\r\n\t\t\t\t\t\tnet.protocol.setChunk(x, y, newChunk);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttool.setEvent('mousedown', mouse => {\r\n\t\t\tif (!(mouse.buttons & 0b100)) {\r\n\t\t\t\tif (tool.extra.canvas) {\r\n\t\t\t\t\tpaint(mouse.tileX, mouse.tileY);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tvar input = document.createElement(\"input\");\r\n\t\tinput.type = \"file\";\r\n\t\tinput.accept = \"image/*\";\r\n\t\ttool.setEvent('select', () => {\r\n\t\t\tinput.onchange = event => {\r\n\t\t\t\tif (input.files && input.files[0]) {\r\n\t\t\t\t\tvar reader = new FileReader();\r\n\t\t\t\t\treader.onload = e => {\r\n\t\t\t\t\t\tvar image = new Image();\r\n\t\t\t\t\t\timage.onload = () => {\r\n\t\t\t\t\t\t\ttool.extra.canvas = document.createElement(\"canvas\");\r\n\t\t\t\t\t\t\ttool.extra.canvas.width = image.width;\r\n\t\t\t\t\t\t\ttool.extra.canvas.height = image.height;\r\n\t\t\t\t\t\t\tvar ctx = tool.extra.canvas.getContext(\"2d\");\r\n\t\t\t\t\t\t\tctx.drawImage(image, 0, 0);\r\n\t\t\t\t\t\t\tconsole.log('Loaded image');\r\n\t\t\t\t\t\t};\r\n\t\t\t\t\t\timage.src = e.target.result;\r\n\t\t\t\t\t};\r\n\t\t\t\t\treader.readAsDataURL(input.files[0]);\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\t\tinput.click();\r\n\t\t});\r\n\t}));\r\n\r\n\teventSys.emit(e.misc.toolsInitialized);\r\n});\r\n\r\neventSys.once(e.init, () => {\r\n\ttoolsWindow = new GUIWindow('Tools', {}, wdow => {\r\n\t\twdow.container.id = \"toole-container\";\r\n\t\twdow.container.style.cssText = \"max-width: 40px\";\r\n\t}).move(5, 32);\r\n});\r\n\r\neventSys.once(e.misc.toolsInitialized, () => {\r\n\tupdateToolbar();\r\n\tif (windowShown) {\r\n\t\twindowSys.addWindow(toolsWindow);\r\n\t}\r\n});\r\n\r\neventSys.on(e.net.disconnected, () => {\r\n\tshowToolsWindow(false);\r\n});\r\n\r\neventSys.on(e.misc.worldInitialized, () => {\r\n\tshowToolsWindow(true);\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/tools.js","\"use strict\";\r\nimport { elements } from './main.js';\r\nimport { EVENTS as e } from './conf.js';\r\nimport { PublicAPI, eventSys } from './global.js';\r\nimport { mkHTML, waitFrames } from './util/misc.js';\r\n\r\nexport const windowSys = {\r\n\twindows: {},\r\n\tclass: {\r\n\t\tinput: UtilInput,\r\n\t\tdialog: UtilDialog,\r\n\t\tdropDown: OWOPDropDown,\r\n\t\twindow: GUIWindow\r\n\t},\r\n\taddWindow: addWindow,\r\n\tdelWindow: delWindow,\r\n\tcenterWindow: centerWindow\r\n};\r\n\r\nPublicAPI.windowSys = windowSys;\r\n\r\nexport function UtilInput(title, message, inputType, cb) {\r\n\tthis.win = new GUIWindow(title, {\r\n\t\tcenterOnce: true,\r\n\t\tcloseable: true\r\n\t}, function(win) {\r\n\t\tthis.inputField = win.addObj(mkHTML(\"input\", {\r\n\t\t\tstyle: \"width: 100%; height: 50%;\",\r\n\t\t\ttype: inputType,\r\n\t\t\tplaceholder: message,\r\n\t\t\tonkeyup: function(e) {\r\n\t\t\t\tif((e.which || e.keyCode) == 13) {\r\n\t\t\t\t\tthis.okButton.click();\r\n\t\t\t\t}\r\n\t\t\t}.bind(this)\r\n\t\t}));\r\n\t\tthis.okButton = win.addObj(mkHTML(\"button\", {\r\n\t\t\tinnerHTML: \"OK\",\r\n\t\t\tstyle: \"width: 100%; height: 50%;\",\r\n\t\t\tonclick: function() {\r\n\t\t\t\tcb(this.inputField.value);\r\n\t\t\t\tthis.getWindow().close();\r\n\t\t\t}.bind(this)\r\n\t\t}));\r\n\t}.bind(this)).resize(200, 60);\r\n}\r\n\r\nUtilInput.prototype.getWindow = function() {\r\n\treturn this.win;\r\n};\r\n\r\nexport function UtilDialog(title, message, canClose, cb) {\r\n\tthis.win = new GUIWindow(title, {\r\n\t\tcentered: true,\r\n\t\tcloseable: canClose\r\n\t}, function(win) {\r\n\t\tthis.messageBox = win.addObj(mkHTML(\"span\", {\r\n\t\t\tclassName: \"whitetext\",\r\n\t\t\tstyle: \"display: block; padding-bottom: 4px;\",\r\n\t\t\tinnerHTML: message\r\n\t\t}));\r\n\t\tthis.okButton = win.addObj(mkHTML(\"button\", {\r\n\t\t\tinnerHTML: \"OK\",\r\n\t\t\tstyle: \"display: block; width: 80px; height: 30px; margin: auto;\",\r\n\t\t\tonclick: function() {\r\n\t\t\t\tcb();\r\n\t\t\t\tthis.getWindow().close();\r\n\t\t\t}.bind(this)\r\n\t\t}));\r\n\t}.bind(this));\r\n}\r\n\r\nUtilDialog.prototype.getWindow = function() {\r\n\treturn this.win;\r\n};\r\n\r\n/* Highly specific purpose, should only be created once */\r\nexport function OWOPDropDown() {\r\n\tthis.win = new GUIWindow(null, {\r\n\t\timmobile: true\r\n\t},\r\n\tfunction(win) {\r\n\t\twin.frame.className = \"owopdropdown\";\r\n\t\twin.container.style.cssText = \"border: none;\\\r\n\t\t\tbackground-color: initial;\\\r\n\t\t\tpointer-events: none;\\\r\n\t\t\tmargin: 0;\";\r\n\t\tvar hlpdiv = win.addObj(mkHTML(\"div\", {\r\n\t\t\tclassName: \"winframe\",\r\n\t\t\tstyle: \"padding: 0;\\\r\n\t\t\t\twidth: 68px; height: 64px;\"\r\n\t\t}));\r\n\t\tvar hidebtn = win.addObj(mkHTML(\"button\", {\r\n\t\t\tinnerHTML: 'hi'\r\n\t\t\t/*className: \"winframe\",\r\n\t\t\tstyle: \"padding: 0;\\\r\n\t\t\tbackground-color: #ffd162;\\\r\n\t\t\tleft: -6px; top: 70px;\\\r\n\t\t\twidth: 38px; height: 36px;\"*/\r\n\t\t}));\r\n\t\t/*var rddtbtn = win.addObj(mkHTML(\"button\", {\r\n\t\t\tclassName: \"winframe\",\r\n\t\t\tstyle: \"padding: 0;\\\r\n\t\t\tright: -6px; top: 70px;\\\r\n\t\t\twidth: 38px; height: 36px;\"\r\n\t\t}));*/\r\n\t\tvar hlpcontainer = mkHTML(\"div\", {\r\n\t\t\tclassName: \"wincontainer\",\r\n\t\t\tstyle: \"margin-top: -5px;\"\r\n\t\t});\r\n\t\thlpdiv.appendChild(hlpcontainer);\r\n\t\thlpcontainer.appendChild(mkHTML(\"button\", {\r\n\t\t\tstyle: \"background-image: url(img/gui.png);\\\r\n\t\t\t\tbackground-position: -64px 4px;\\\r\n\t\t\t\tbackground-origin: border-box;\\\r\n\t\t\t\tbackground-repeat: no-repeat;\\\r\n\t\t\t\twidth: 100%; height: 100%;\",\r\n\t\t\tonclick: function() {console.log(\"help\")}.bind(this)\r\n\t\t}));\r\n\t}).resize(68, 64);\r\n}\r\n\r\nOWOPDropDown.prototype.getWindow = function() {\r\n\treturn this.win;\r\n};\r\n\r\n/* wm = WindowManager object \r\n * initfunc = function where all the windows objects should be added,\r\n *            first function argument is the guiwindow object itself\r\n */\r\nexport function GUIWindow(title, options, initfunc) {\r\n\toptions = options || {};\r\n\tthis.wm = WorldOfPixels.windowsys;\r\n\tthis.opt = options;\r\n\tthis.title = title;\r\n\tthis.frame = document.createElement(\"div\");\r\n\tthis.container = document.createElement(\"div\");\r\n\tthis.container.className = 'wincontainer';\r\n\t\r\n\tif (title) {\r\n\t\tthis.titlespan = document.createElement(\"span\");\r\n\t\tthis.titlespan.innerHTML = title;\r\n\t\r\n\t\tthis.frame.appendChild(this.titlespan);\r\n\t}\r\n\t\r\n\tthis.frame.appendChild(this.container);\r\n\t\r\n\tif (options.centered) {\r\n\t\toptions.immobile = true;\r\n\t\tthis.frame.className = \"centered\";\r\n\t}\r\n\t\t\r\n\tObject.defineProperty(this, \"realw\", {\r\n\t\tget: function() {\r\n\t\t\treturn this.frame.offsetWidth;\r\n\t\t}.bind(this)\r\n\t});\r\n\tObject.defineProperty(this, \"realh\", {\r\n\t\tget: function() {\r\n\t\t\treturn this.frame.offsetHeight;\r\n\t\t}.bind(this)\r\n\t});\r\n\t\r\n\tthis.elements = [];\r\n\t\r\n\tthis.creationtime = Date.now();\r\n\tthis.currentaction = null; /* Func to call every mousemove evt */\r\n\t\r\n\tif (initfunc) {\r\n\t\tinitfunc(this);\r\n\t}\r\n\t\r\n\tthis.mdownfunc = function(e) {\r\n\t\tvar offx = e.clientX - this.x;\r\n\t\tvar offy = e.clientY - this.y;\r\n\t\tif (e.target === this.frame && !this.opt.immobile) {\r\n\t\t\tthis.currentaction = function(x, y) {\r\n\t\t\t\tx = x <= 0 ? 0 : x > window.innerWidth ? window.innerWidth : x;\r\n\t\t\t\ty = y <= 0 ? 0 : y > window.innerHeight ? window.innerHeight : y;\r\n\t\t\t\tthis.move(x - offx, y - offy);\r\n\t\t\t}\r\n\t\t}\r\n\t}.bind(this);\r\n\t\r\n\tif (options.centerOnce) {\r\n\t\t/* Ugly solution to wait for offset(Height, Width) values to be available */\r\n\t\tthis.move(window.innerWidth, window.innerHeight); /* Hide the window */\r\n\t\twaitFrames(2, () => centerWindow(this));\r\n\t}\r\n\t\r\n\tthis.frame.addEventListener(\"mousedown\", this.mdownfunc);\r\n\t\r\n\tthis.mupfunc = function(e) {\r\n\t\tthis.currentaction = null;\r\n\t}.bind(this);\r\n\t\r\n\twindow.addEventListener(\"mouseup\", this.mupfunc);\r\n\t\r\n\tthis.mmovefunc = function(e) {\r\n\t\tif (this.currentaction) {\r\n\t\t\tthis.currentaction(e.clientX, e.clientY);\r\n\t\t}\r\n\t}.bind(this);\r\n\t\r\n\twindow.addEventListener(\"mousemove\", this.mmovefunc);\r\n\t\r\n\tif(options.closeable) {\r\n\t\tthis.frame.appendChild(mkHTML(\"button\", {\r\n\t\t\tonclick: function() {\r\n\t\t\t\tthis.close();\r\n\t\t\t}.bind(this),\r\n\t\t\tclassName: 'windowCloseButton'\r\n\t\t}));\r\n\t}\r\n}\r\n\r\nGUIWindow.prototype.getWindow = function() {\r\n\treturn this;\r\n};\r\n\r\nGUIWindow.prototype.addObj = function(object) {\r\n\tthis.elements.push(object);\r\n\tthis.container.appendChild(object);\r\n\treturn object;\r\n};\r\n\r\nGUIWindow.prototype.delObj = function(object) {\r\n\tvar i = this.elements.indexOf(object);\r\n\tif (i != -1) {\r\n\t\tthis.elements.splice(i, 1);\r\n\t\tthis.container.removeChild(object);\r\n\t}\r\n};\r\n\r\nGUIWindow.prototype.move = function(x, y) {\r\n\tif (!this.opt.immobile) {\r\n\t\tthis.frame.style.transform = \"translate(\" + x + \"px,\" + y + \"px)\";\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t}\r\n\treturn this;\r\n};\r\n\r\nGUIWindow.prototype.resize = function(w, h){\r\n\tthis.w = w;\r\n\tthis.h = h;\r\n\tthis.container.style.width = w + \"px\";\r\n\tthis.container.style.height = h + \"px\";\r\n\treturn this;\r\n};\r\n\r\nGUIWindow.prototype.close = function() {\r\n\tdelWindow(this);\r\n\twindow.removeEventListener(\"mousemove\", this.mmovefunc);\r\n\twindow.removeEventListener(\"mouseup\", this.mupfunc);\r\n\tthis.frame.removeEventListener(\"mousedown\", this.mdownfunc);\r\n\tif (this.onclose) {\r\n\t\tthis.onclose();\r\n\t}\r\n};\r\n\r\n/* Window X/Y is specified on window.x, window.y */\r\nexport function addWindow(window) {\r\n\tvar realWindow = window.getWindow();\r\n\tif(!windowSys.windows[realWindow.title]) {\r\n\t\telements.windows.appendChild(realWindow.frame);\r\n\t\twindowSys.windows[realWindow.title] = realWindow;\r\n\t}\r\n\teventSys.emit(e.misc.windowAdded, window);\r\n\treturn window;\r\n}\r\n\r\nexport function delWindow(window) {\r\n\tvar realWindow = window.getWindow();\r\n\tif(windowSys.windows[realWindow.title]) {\r\n\t\telements.windows.removeChild(realWindow.frame);\r\n\t\tdelete windowSys.windows[realWindow.title];\r\n\t}\r\n\treturn window;\r\n}\r\n\r\nexport function centerWindow(win) {\r\n\twin = win.getWindow();\r\n\twin.move(window.innerWidth / 2 - win.realw / 2 | 0, window.innerHeight / 2 - win.realh / 2 | 0);\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/windowsys.js","\"use strict\";\r\nimport { protocol, EVENTS as e, options, RANK } from './conf.js';\r\nimport { eventSys } from './global.js';\r\nimport { colorUtils } from './util/color.js';\r\nimport { net } from './networking.js';\r\nimport { camera, isVisible, renderer } from './canvas_renderer.js';\r\nimport { mouse, sounds } from './main.js';\r\nimport { player } from './local_player.js';\r\nimport { Player } from './Player.js';\r\nimport { Fx } from './Fx.js';\r\n\r\nlet lastPlace = 0;\r\n\r\nexport class Chunk {\r\n\tconstructor(x, y, netdata, locked) { /* netdata = Uint32Array */\r\n\t\tthis.needsRedraw = false;\r\n\t\tthis.x = x;\r\n\t\tthis.y = y;\r\n\t\tthis.tmpChunkBuf = netdata;\r\n\t\tthis.view = null;\r\n\t\tthis.locked = locked;\r\n\t\tthis.lockedNeighbors = 0b0000; /* Up, Right, Down, Left */\r\n\t}\r\n\r\n\tupdate(x, y, color) {\r\n\t\t/* WARNING: Should absMod if not power of two */\r\n\t\tx &= (protocol.chunkSize - 1);\r\n\t\ty &= (protocol.chunkSize - 1);\r\n\t\tthis.view.set(x, y, 0xFF000000 | color);\r\n\t\tthis.needsRedraw = true;\r\n\t}\r\n\r\n\tget(x, y) {\r\n\t\tx &= (protocol.chunkSize - 1);\r\n\t\ty &= (protocol.chunkSize - 1);\r\n\t\treturn this.view.get(x, y);\r\n\t}\r\n\r\n\tset(data) {\r\n\t\tif (Number.isInteger(data)) {\r\n\t\t\tthis.view.fill(0xFF000000 | data);\r\n\t\t} else {\r\n\t\t\tthis.view.fillFromBuf(data);\r\n\t\t}\r\n\t\tthis.needsRedraw = true;\r\n\t}\r\n\r\n\tremove() { /* Can be called when manually unloading too */\r\n\t\teventSys.emit(e.net.chunk.unload, this);\r\n\t}\r\n}\r\nChunk.dir = {\r\n\tUP: 0b1000,\r\n\tRIGHT: 0b0100,\r\n\tDOWN: 0b0010,\r\n\tLEFT: 0b0001\r\n};\r\n\r\nexport class World {\r\n\tconstructor(worldName) {\r\n\t\tthis.name = worldName;\r\n\t\tthis.chunks = {};\r\n\t\tthis.protectedChunks = {};\r\n\t\tthis.players = {};\r\n\t\tthis.undoHistory = [];\r\n\t\tthis.pathUpdaterTimeout = -1;\r\n\t\tthis.pathFx = new Fx((fx, ctx, time) => {\r\n\t\t\tvar retval = 1;\r\n\t\t\tif (fx.extra.path) {\r\n\t\t\t\tctx.strokeStyle = \"#525252\";\r\n\t\t\t\tvar l = ctx.lineWidth;\r\n\t\t\t\tctx.lineWidth = 3 / camera.zoom;\r\n\t\t\t\tctx.setTransform(camera.zoom, 0, 0, camera.zoom, -camera.x * camera.zoom, -camera.y * camera.zoom);\r\n\t\t\t\tif (time - fx.extra.placeTime < 1500) {\r\n\t\t\t\t\tctx.globalAlpha = (1 - (time - fx.extra.placeTime) / 1500) * 0.5;\r\n\t\t\t\t\tctx.fillStyle = renderer.patterns.unloaded;\r\n\t\t\t\t\tctx.fill(fx.extra.path);\r\n\t\t\t\t\tretval = 0;\r\n\t\t\t\t}\r\n\t\t\t\tctx.globalAlpha = 0.75;\r\n\t\t\t\tctx.stroke(fx.extra.path);\r\n\t\t\t\tctx.setTransform(1, 0, 0, 1, 0, 0);\r\n\t\t\t\tctx.lineWidth = l;\r\n\t\t\t}\r\n\t\t\treturn retval;\r\n\t\t});\r\n\r\n\t\tconst loadCFunc = chunk => this.chunkLoaded(chunk);\r\n\t\tconst unloadCFunc = chunk => this.chunkUnloaded(chunk);\r\n\t\tconst setCFunc = (x, y, data) => this.chunkPasted(x, y, data);\r\n\t\tconst lockCFunc = (x, y, newState) => this.chunkLocked(x, y, newState);\r\n\t\tconst disconnectedFunc = () => eventSys.emit(e.net.world.leave);\r\n\t\tconst updateTileFunc = t => this.tilesUpdated(t);\r\n\t\tconst updatePlayerFunc = p => this.playersMoved(p);\r\n\t\tconst destroyPlayerFunc = p => this.playersLeft(p);\r\n\t\tconst leaveWFunc = () => {\r\n\t\t\tthis.pathFx.delete();\r\n\t\t\tthis.unloadAllChunks();\r\n\t\t\tthis.playersLeft(Object.keys(this.players));\r\n\t\t\teventSys.removeListener(e.net.chunk.load, loadCFunc);\r\n\t\t\teventSys.removeListener(e.net.chunk.unload, unloadCFunc);\r\n\t\t\teventSys.removeListener(e.net.chunk.set, setCFunc);\r\n\t\t\teventSys.removeListener(e.net.chunk.lock, lockCFunc);\r\n\t\t\teventSys.removeListener(e.net.disconnected, disconnectedFunc);\r\n\t\t\teventSys.removeListener(e.net.world.tilesUpdated, updateTileFunc);\r\n\t\t\teventSys.removeListener(e.net.world.playersMoved, updatePlayerFunc);\r\n\t\t\teventSys.removeListener(e.net.world.playersLeft, destroyPlayerFunc);\r\n\t\t};\r\n\t\teventSys.on(e.net.chunk.load, loadCFunc);\r\n\t\teventSys.on(e.net.chunk.unload, unloadCFunc);\r\n\t\teventSys.on(e.net.chunk.set, setCFunc);\r\n\t\teventSys.on(e.net.chunk.lock, lockCFunc);\r\n\t\teventSys.on(e.net.world.tilesUpdated, updateTileFunc);\r\n\t\teventSys.on(e.net.world.playersMoved, updatePlayerFunc);\r\n\t\teventSys.on(e.net.world.playersLeft, destroyPlayerFunc);\r\n\t\teventSys.once(e.net.world.leave, leaveWFunc);\r\n\t\teventSys.once(e.net.disconnected, disconnectedFunc);\r\n\t}\r\n\t\r\n\tmakeLockedChunksPath() {\r\n\t\tconst d = Chunk.dir;\r\n\t\tvar mainPath = new Path2D();\r\n\t\t\r\n\t\tvar vpoints = {};\r\n\t\tvar hpoints = {};\r\n\t\t\r\n\t\tconst addPoint = (fx, fy, tx, ty, points) => {\r\n\t\t\tconst fkey = `${fx},${fy}`;\r\n\t\t\tconst tkey = `${tx},${ty}`;\r\n\t\t\tif (tkey in points && fkey in points) {\r\n\t\t\t\tpoints[points[fkey]] = points[tkey];\r\n\t\t\t\tpoints[points[tkey]] = points[fkey];\r\n\t\t\t\tdelete points[tkey];\r\n\t\t\t\tdelete points[fkey];\r\n\t\t\t} else if (tkey in points) {\r\n\t\t\t\tvar newTo = points[tkey];\r\n\t\t\t\tpoints[newTo] = fkey;\r\n\t\t\t\tdelete points[tkey];\r\n\t\t\t\tpoints[fkey] = newTo;\r\n\t\t\t} else if (fkey in points) {\r\n\t\t\t\tvar newFrom = points[fkey];\r\n\t\t\t\tpoints[newFrom] = tkey;\r\n\t\t\t\tdelete points[fkey];\r\n\t\t\t\tpoints[tkey] = newFrom;\r\n\t\t\t} else {\r\n\t\t\t\tpoints[fkey] = tkey;\r\n\t\t\t\tpoints[tkey] = fkey;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\tfor (var k in this.protectedChunks) {\r\n\t\t\tconst chunk = this.protectedChunks[k];\r\n\t\t\tconst ln = chunk.lockedNeighbors;\r\n\t\t\tif (ln === (d.LEFT | d.DOWN | d.UP | d.RIGHT)) {\r\n\t\t\t\tcontinue;\r\n\t\t\t}\r\n\t\t\t\r\n\t\t\tif (!(ln & d.UP)) {\r\n\t\t\t\taddPoint(chunk.x + 1, chunk.y, chunk.x, chunk.y, hpoints);\r\n\t\t\t}\r\n\t\t\tif (!(ln & d.DOWN)) {\r\n\t\t\t\taddPoint(chunk.x, chunk.y + 1, chunk.x + 1, chunk.y + 1, hpoints);\r\n\t\t\t}\r\n\r\n\t\t\tif (!(ln & d.LEFT)) {\r\n\t\t\t\taddPoint(chunk.x, chunk.y + 1, chunk.x, chunk.y, vpoints);\r\n\t\t\t}\r\n\t\t\tif (!(ln & d.RIGHT)) {\r\n\t\t\t\taddPoint(chunk.x + 1, chunk.y + 1, chunk.x + 1, chunk.y, vpoints);\r\n\t\t\t}\r\n\t\t}\r\n\t\t\r\n\t\tvar polys = 0;\r\n\t\tvar pointobjs = [vpoints, hpoints];\r\n\t\tfor (var p in vpoints) {\r\n\t\t\tvar a = p.split(',');\r\n\t\t\tmainPath.moveTo(a[0] * 16, a[1] * 16);\r\n\t\t\t\r\n\t\t\tdelete vpoints[vpoints[p]];\r\n\t\t\tdelete vpoints[p];\r\n\t\t\tp = hpoints[p];\r\n\t\t\tfor (var i = 0; p && (a = p.split(',')); i++) {\r\n\t\t\t\tvar prev = pointobjs[(i + 1) & 1];\r\n\t\t\t\tvar next = pointobjs[i & 1];\r\n\t\t\t\tmainPath.lineTo(a[0] * 16, a[1] * 16);\r\n\t\t\t\t\r\n\t\t\t\tdelete prev[prev[p]];\r\n\t\t\t\tdelete prev[p];\r\n\t\t\t\tp = next[p];\r\n\t\t\t}\r\n\t\t\tmainPath.closePath();\r\n\t\t\t++polys;\r\n\t\t}\r\n\r\n\t\treturn polys === 0 ? null : mainPath;\r\n\t}\r\n\t\r\n\tfindNeighborLockedChunks(chunk, newState) {\r\n\t\tconst d = Chunk.dir;\r\n\t\tconst checkSide = (x, y, to, from) => {\r\n\t\t\tvar sidec = this.getChunkAt(chunk.x + x, chunk.y + y);\r\n\t\t\tif (sidec && sidec.locked) {\r\n\t\t\t\tif (newState) {\r\n\t\t\t\t\tchunk.lockedNeighbors |= to;\r\n\t\t\t\t\tsidec.lockedNeighbors |= from;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tchunk.lockedNeighbors &= ~to;\r\n\t\t\t\t\tsidec.lockedNeighbors &= ~from;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t};\r\n\t\t\r\n\t\tcheckSide(0, -1, d.UP, d.DOWN);\r\n\t\tcheckSide(1, 0, d.RIGHT, d.LEFT);\r\n\t\tcheckSide(-1, 0, d.LEFT, d.RIGHT);\r\n\t\tcheckSide(0, 1, d.DOWN, d.UP);\r\n\t\t\r\n\t\tclearTimeout(this.pathUpdaterTimeout);\r\n\t\tthis.pathUpdaterTimeout = setTimeout(() => {\r\n\t\t\tthis.pathFx.update({path: this.makeLockedChunksPath()});\r\n\t\t\trenderer.render(renderer.rendertype.FX);\r\n\t\t}, 100);\r\n\t}\r\n\r\n\tloadChunk(x, y) {\r\n\t\tvar key = `${x},${y}`;\r\n\t\tif (!this.chunks[key] && net.isConnected()) {\r\n\t\t\tnet.protocol.requestChunk(x, y);\r\n\t\t}\r\n\t}\r\n\r\n\tallChunksLoaded() {\r\n\t\treturn net.protocol.allChunksLoaded();\r\n\t}\r\n\r\n\ttilesUpdated(tiles) {\r\n\t\tvar chunksUpdated = {};\r\n\t\tvar chunkSize = protocol.chunkSize;\r\n\t\tfor (var i = 0; i < tiles.length; i++) {\r\n\t\t\tvar t = tiles[i];\r\n\t\t\tvar key = `${Math.floor(t.x / chunkSize)},${Math.floor(t.y / chunkSize)}`;\r\n\t\t\tvar chunk = this.chunks[key];\r\n\t\t\tif (chunk) {\r\n\t\t\t\tchunksUpdated[key] = chunk;\r\n\t\t\t\tchunk.update(t.x, t.y, t.rgb);\r\n\t\t\t}\r\n\t\t}\r\n\t\tfor (var c in chunksUpdated) {\r\n\t\t\teventSys.emit(e.renderer.updateChunk, chunksUpdated[c]);\r\n\t\t}\r\n\t}\r\n\r\n\tplayersMoved(players) {\r\n\t\tvar rendered = false;\r\n\t\tfor (const id in players) {\r\n\t\t\tvar player = this.players[id];\r\n\t\t\tvar u = players[id];\r\n\t\t\tif (player) {\r\n\t\t\t\tplayer.update(u.x, u.y, u.rgb, u.tool);\r\n\t\t\t} else {\r\n\t\t\t\tplayer = this.players[id] = new Player(u.x, u.y, u.rgb, u.tool, id);\r\n\t\t\t}\r\n\t\t\tif (!rendered && (isVisible(player.endX / 16, player.endY / 16, 4, 4)\r\n\t\t\t\t\t|| isVisible(player.x / 16, player.y / 16, 4, 4))) {\r\n\t\t\t\trendered = true;\r\n\t\t\t\trenderer.render(renderer.rendertype.FX);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tplayersLeft(ids) {\r\n\t\tvar rendered = false;\r\n\t\tfor (var i = 0; i < ids.length; i++) {\r\n\t\t\tvar id = ids[i];\r\n\t\t\tvar player = this.players[id];\r\n\t\t\tif (player) {\r\n\t\t\t\tplayer.disconnect();\r\n\t\t\t\tif (!rendered && isVisible(player.x / 16, player.y / 16, 4, 4)) {\r\n\t\t\t\t\trendered = true;\r\n\t\t\t\t\trenderer.render(renderer.rendertype.FX);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tdelete this.players[id];\r\n\t\t}\r\n\t}\r\n\r\n\tsetPixel(x, y, color, noUndo) {\r\n\t\tvar time = Date.now();\r\n\t\tvar chunkSize = protocol.chunkSize;\r\n\t\tvar chunk = this.chunks[`${Math.floor(x / chunkSize)},${Math.floor(y / chunkSize)}`];\r\n\t\tif (chunk && (!chunk.locked || player.rank >= RANK.MODERATOR)) {\r\n\t\t\tvar oldPixel = this.getPixel(x, y, chunk);\r\n\t\t\tif (!oldPixel || (oldPixel[0] === color[0] && oldPixel[1] === color[1] && oldPixel[2] === color[2])\r\n\t\t\t|| !net.protocol.updatePixel(x, y, color)) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\tif (!noUndo) {\r\n\t\t\t\toldPixel.push(x, y, time);\r\n\t\t\t\tthis.undoHistory.push(oldPixel);\r\n\t\t\t}\r\n\t\t\tchunk.update(x, y, colorUtils.u24_888(color[0], color[1], color[2]));\r\n\t\t\teventSys.emit(e.renderer.updateChunk, chunk);\r\n\t\t\tif (time - lastPlace > 30) {\r\n\t\t\t\tsounds.play(sounds.place);\r\n\t\t\t\tlastPlace = time;\r\n\t\t\t}\r\n\t\t\treturn true;\r\n\t\t} else if (chunk && chunk.locked) {\r\n\t\t\tthis.pathFx.extra.placeTime = time;\r\n\t\t\trenderer.render(renderer.rendertype.FX);\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\tundo(bulkUndo) {\r\n\t\tconst eq = (a, b) => a[0] == b[0] && a[1] == b[1] && a[2] == b[2];\r\n\t\tif (this.undoHistory.length === 0) {\r\n\t\t\treturn false;\r\n\t\t}\r\n\t\tvar changeTime = null;\r\n\t\tfor (var i = this.undoHistory.length; --i >= 0;) {\r\n\t\t\tvar undo = this.undoHistory[i];\r\n\t\t\tif (!changeTime) {\r\n\t\t\t\tchangeTime = undo[5];\r\n\t\t\t}\r\n\t\t\tvar px = this.getPixel(undo[3], undo[4]);\r\n\t\t\tif (px) {\r\n\t\t\t\tvar shouldContinue = !bulkUndo || changeTime - undo[5] < 500;\r\n\t\t\t\tvar unchanged = eq(px, undo);\r\n\t\t\t\tif (!shouldContinue) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t\tif (unchanged || this.setPixel(undo[3], undo[4], undo, true)) {\r\n\t\t\t\t\tthis.undoHistory.splice(i, 1);\r\n\t\t\t\t\tif (!bulkUndo) {\r\n\t\t\t\t\t\tbreak;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tgetChunkAt(x, y) {\r\n\t\treturn this.chunks[`${x},${y}`];\r\n\t}\r\n\r\n\tgetPixel(x, y, chunk) {\r\n\t\tif (!chunk) {\r\n\t\t\tvar chunkSize = protocol.chunkSize;\r\n\t\t\tchunk = this.chunks[`${Math.floor(x / chunkSize)},${Math.floor(y / chunkSize)}`];\r\n\t\t}\r\n\r\n\t\tif (chunk) {\r\n\t\t\tvar clr = chunk.get(x, y);\r\n\t\t\treturn [clr & 0xFF, clr >> 8 & 0xFF, clr >> 16 & 0xFF];\r\n\t\t}\r\n\t\treturn null;\r\n\t}\r\n\r\n\tvalidMousePos(tileX, tileY) {\r\n\t\treturn this.getPixel(tileX, tileY) !== null;\r\n\t}\r\n\r\n\tchunkLocked(x, y, newState) {\r\n\t\tconst key = `${x},${y}`;\r\n\t\tvar chunk = this.getChunkAt(x, y);\r\n\t\tif (chunk) {\r\n\t\t\tif (newState) {\r\n\t\t\t\tthis.protectedChunks[key] = chunk;\r\n\t\t\t\tchunk.locked = true;\r\n\t\t\t} else {\r\n\t\t\t\tdelete this.protectedChunks[key];\r\n\t\t\t\tchunk.locked = false;\r\n\t\t\t}\r\n\t\t\tthis.findNeighborLockedChunks(chunk, newState);\r\n\t\t}\r\n\t}\r\n\r\n\tchunkLoaded(chunk) {\r\n\t\tconst key = `${chunk.x},${chunk.y}`;\r\n\t\tthis.chunks[key] = chunk;\r\n\t\tif (chunk.locked) {\r\n\t\t\tthis.protectedChunks[key] = chunk;\r\n\t\t\tthis.findNeighborLockedChunks(chunk, chunk.locked);\r\n\t\t}\r\n\t\teventSys.emit(e.renderer.addChunk, chunk);\r\n\t}\r\n\r\n\tchunkUnloaded(chunk) {\r\n\t\tconst key = `${chunk.x},${chunk.y}`;\r\n\t\tdelete this.chunks[key];\r\n\t\tif (chunk.locked) {\r\n\t\t\tdelete this.protectedChunks[key];\r\n\t\t\tchunk.locked = false;\r\n\t\t\tthis.findNeighborLockedChunks(chunk, chunk.locked);\r\n\t\t}\r\n\t\teventSys.emit(e.renderer.rmChunk, chunk);\r\n\t}\r\n\r\n\tchunkPasted(x, y, data) {\r\n\t\tvar chunk = this.chunks[`${x},${y}`];\r\n\t\tif (chunk) {\r\n\t\t\tchunk.set(data);\r\n\t\t\teventSys.emit(e.renderer.updateChunk, chunk);\r\n\t\t}\r\n\t}\r\n\r\n\tunloadAllChunks() {\r\n\t\tfor (const c in this.chunks) {\r\n\t\t\tthis.chunks[c].remove();\r\n\t\t}\r\n\t}\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/World.js","'use strict';\r\nimport { EVENTS as e, options } from './conf.js';\r\nimport { eventSys, PublicAPI } from './global.js';\r\n\r\nexport const cursors = {\r\n\tset: new Image(),\r\n\tcursor: {imgpos: [0, 0], hotspot: [0, 0]},\r\n\tmove: {imgpos: [1, 0], hotspot: [18, 18]},\r\n\tpipette: {imgpos: [0, 1], hotspot: [0, 28]},\r\n\terase: {imgpos: [0, 2], hotspot: [4, 26]},\r\n\tzoom: {imgpos: [1, 2], hotspot: [19, 10]},\r\n\tfill: {imgpos: [1, 1], hotspot: [3, 29]},\r\n\tbrush: {imgpos: [0, 3], hotspot: [0, 26]},\r\n\tselect: {imgpos: [2, 0], hotspot: [0, 0]}, // needs better hotspot\r\n\tcopy: {imgpos: [3, 0], hotspot: [0, 0]}, // and this\r\n\tpaste: {imgpos: [3, 1], hotspot: [0, 0]}, // this too\r\n\tcut: {imgpos: [3, 2], hotspot: [11, 5]},\r\n\twand: {imgpos: [3, 3], hotspot: [0, 0]},\r\n\tshield: {imgpos: [2, 3], hotspot: [18, 18]},\r\n\tkick: {imgpos: [2, 1], hotspot: [3, 6]},\r\n\tban: {imgpos: [3, 0], hotspot: [10, 4]},\r\n\twrite: {imgpos: [1, 3], hotspot: [10, 4]} // fix hotspot\r\n};\r\n\r\nPublicAPI.cursors = cursors;\r\n\r\nfunction reduce(canvas) { /* Removes unused space from the image */\r\n\tvar nw = canvas.width;\r\n\tvar nh = canvas.height;\r\n\tvar ctx = canvas.getContext('2d');\r\n\tvar idat = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n\tvar u32dat = new Uint32Array(idat.data.buffer);\r\n\tvar xoff = 0;\r\n\tvar yoff = 0;\r\n\tfor(var y = 0, x, i = 0; y < idat.height; y++) {\r\n\t\tfor(x = idat.width; x--; i += u32dat[y * idat.width + x]);\r\n\t\tif(i) { break; }\r\n\t\tyoff++;\r\n\t}\r\n\tfor(var x = 0, y, i = 0; x < idat.width; x++) {\r\n\t\tfor(y = nh; y--; i += u32dat[y * idat.width + x]);\r\n\t\tif(i) { break; }\r\n\t\txoff++;\r\n\t}\r\n\tfor(var y = idat.height, x, i = 0; y--;) {\r\n\t\tfor(x = idat.width; x--; i += u32dat[y * idat.width + x]);\r\n\t\tif(i) { break; }\r\n\t\tnh--;\r\n\t}\r\n\tfor(var x = idat.width, y, i = 0; x--;) {\r\n\t\tfor(y = nh; y--; i += u32dat[y * idat.width + x]);\r\n\t\tif(i) { break; }\r\n\t\tnw--;\r\n\t}\r\n\tcanvas.width = nw;\r\n\tcanvas.height = nh;\r\n\tctx.putImageData(idat, -xoff, -yoff);\r\n}\r\n\r\nfunction shadow(canvas, img) {\r\n\t/* Make a bigger image so the shadow doesn't get cut */\r\n\tcanvas.width  = 2 + img.width + 6;\r\n\tcanvas.height = 2 + img.height + 6;\r\n\tvar ctx = canvas.getContext('2d');\r\n\tctx.shadowColor = '#000000';\r\n\tctx.globalAlpha = 0.5; /* The shadow is too dark so we draw it transparent */\r\n\tctx.shadowBlur  = 4;\r\n\tctx.shadowOffsetX = 2;\r\n\tctx.shadowOffsetY = 2;\r\n\tctx.drawImage(img, 2, 2);\r\n\tctx.globalAlpha = 1;\r\n\tctx.shadowColor = 'rgba(0, 0, 0, 0)'; /* disables the shadow */\r\n\tctx.drawImage(img, 2, 2);\r\n}\r\n\r\n/* makes a hole with the shape of the image */\r\nfunction popOut(canvas, img) {\r\n\tvar shadowcolor = 0xFF3B314D;\r\n\tvar backgroundcolor = 0xFF5C637E;\r\n\tcanvas.width = img.width;\r\n\tcanvas.height = img.height;\r\n\tvar ctx = canvas.getContext('2d');\r\n\tctx.drawImage(img, 0, 0);\r\n\tvar idat = ctx.getImageData(0, 0, canvas.width, canvas.height);\r\n\tvar u32dat = new Uint32Array(idat.data.buffer);\r\n\tvar clr = function(x, y) {\r\n\t\treturn (x < 0 || y < 0 || x >= idat.width || y >= idat.height) ? 0\r\n\t\t\t: u32dat[y * idat.width + x];\r\n\t};\r\n\tfor(var i = u32dat.length; i--;) {\r\n\t\tif(u32dat[i] !== 0) {\r\n\t\t\tu32dat[i] = backgroundcolor;\r\n\t\t}\r\n\t}\r\n\tfor(var y = idat.height; y--;) {\r\n\t\tfor(var x = idat.width; x--;) {\r\n\t\t\tif(clr(x, y) === backgroundcolor && (!clr(x, y - 1) || !clr(x - 1, y)) && !clr(x - 1, y - 1)) {\r\n\t\t\t\tu32dat[y * idat.width + x] = shadowcolor;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tfor(var y = idat.height; y--;) {\r\n\t\tfor(var x = idat.width; x--;) {\r\n\t\t\tif(clr(x, y - 1) === shadowcolor\r\n\t\t\t   && clr(x - 1, y) === shadowcolor) {\r\n\t\t\t\tu32dat[y * idat.width + x] = shadowcolor;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\tctx.putImageData(idat, 0, 0);\r\n}\r\n\r\nfunction load(oncomplete) {\r\n\tcursors.set.onload = function() {\r\n\t\tvar set = cursors.set;\r\n\t\tvar slotcanvas = document.createElement('canvas');\r\n\t\tpopOut(slotcanvas, set);\r\n\t\tvar j = Object.keys(cursors).length - 1 + 1; /* +1 slotset to blob url */\r\n\t\tfor(var tool in cursors) {\r\n\t\t\tif (tool === 'set') { continue; }\r\n\t\t\ttool = cursors[tool];\r\n\t\t\tvar original = document.createElement('canvas');\r\n\t\t\tvar i = tool.img = {\r\n\t\t\t\tshadowed: document.createElement('canvas'),\r\n\t\t\t\tshadowblob: null\r\n\t\t\t};\r\n\t\t\toriginal.width = original.height = 36;\r\n\t\t\toriginal.getContext('2d').drawImage(set,\r\n\t\t\t\ttool.imgpos[0] * 36,\r\n\t\t\t\ttool.imgpos[1] * 36,\r\n\t\t\t\t36, 36,\r\n\t\t\t\t0, 0,\r\n\t\t\t\t36, 36\r\n\t\t\t);\r\n\t\t\treduce(original);\r\n\t\t\tshadow(i.shadowed, original);\r\n\t\t\ttool.hotspot[0] += 2;\r\n\t\t\ttool.hotspot[1] += 2; /* Check shadow() for explanation */\r\n\t\t\t\r\n\t\t\t/* Blob-ify images */\r\n\t\t\ti.shadowed.toBlob(function(blob) {\r\n\t\t\t\tthis.img.shadowblob = URL.createObjectURL(blob);\r\n\t\t\t\tif(!--j) oncomplete();\r\n\t\t\t}.bind(tool));\r\n\t\t}\r\n\t\tslotcanvas.toBlob(blob => {\r\n\t\t\tcursors.slotset = URL.createObjectURL(blob);\r\n\t\t\tif(!--j) oncomplete();\r\n\t\t});\r\n\t};\r\n\r\n\tcursors.set.src = options.toolSetUrl;\r\n}\r\n\r\neventSys.once(e.loaded, () => {\r\n\tload(() => eventSys.emit(e.misc.toolsRendered));\r\n});\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/tool_renderer.js","'use strict';\r\nimport { getTime } from './misc.js';\r\n\r\n/* Time function, time will be updated by the renderer */\r\nconst time = getTime /*() => getTime(true)*/;\r\n\r\nexport class Lerp {\r\n    constructor(start, end, ms) {\r\n        this.start = start;\r\n        this.end = end;\r\n        this.ms = ms;\r\n        this.time = time();\r\n    }\r\n\r\n    get val() {\r\n        let amt = Math.min((time() - this.time) / this.ms, 1);\r\n        return (1 - amt) * this.start + amt * this.end;\r\n    }\r\n\r\n    set val(v) {\r\n        this.start = this.val;\r\n        this.end = v;\r\n        this.time = time(true);\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/util/Lerp.js","/**\r\n * Copyright (c) 2015, Facebook, Inc.\r\n * All rights reserved.\r\n *\r\n * This source code is licensed under the BSD-style license found in the\r\n * LICENSE file in the root directory of this source tree. An additional grant\r\n * of patent rights can be found in the PATENTS file in the same directory.\r\n *\r\n * @providesModule normalizeWheel\r\n * @typechecks\r\n */\r\n\r\n /* source: https://github.com/facebookarchive/fixed-data-table/blob/master/src/vendor_upstream/dom/normalizeWheel.js */\r\n\r\n'use strict';\r\n\r\n// Reasonable defaults\r\nvar PIXEL_STEP  = 10;\r\nvar LINE_HEIGHT = 40;\r\nvar PAGE_HEIGHT = 800;\r\n\r\nexport function normalizeWheel(/*object*/ event) /*object*/ {\r\n  var sX = 0, sY = 0,       // spinX, spinY\r\n      pX = 0, pY = 0;       // pixelX, pixelY\r\n\r\n  // Legacy\r\n  if ('detail'      in event) { sY = event.detail; }\r\n  if ('wheelDelta'  in event) { sY = -event.wheelDelta / 120; }\r\n  if ('wheelDeltaY' in event) { sY = -event.wheelDeltaY / 120; }\r\n  if ('wheelDeltaX' in event) { sX = -event.wheelDeltaX / 120; }\r\n\r\n  // side scrolling on FF with DOMMouseScroll\r\n  if ( 'axis' in event && event.axis === event.HORIZONTAL_AXIS ) {\r\n    sX = sY;\r\n    sY = 0;\r\n  }\r\n\r\n  pX = sX * PIXEL_STEP;\r\n  pY = sY * PIXEL_STEP;\r\n\r\n  if ('deltaY' in event) { pY = event.deltaY; }\r\n  if ('deltaX' in event) { pX = event.deltaX; }\r\n\r\n  if ((pX || pY) && event.deltaMode) {\r\n    if (event.deltaMode == 1) {          // delta in LINE units\r\n      pX *= LINE_HEIGHT;\r\n      pY *= LINE_HEIGHT;\r\n    } else {                             // delta in PAGE units\r\n      pX *= PAGE_HEIGHT;\r\n      pY *= PAGE_HEIGHT;\r\n    }\r\n  }\r\n\r\n  // Fall-back if spin cannot be determined\r\n  if (pX && !sX) { sX = (pX < 1) ? -1 : 1; }\r\n  if (pY && !sY) { sY = (pY < 1) ? -1 : 1; }\r\n\r\n  return { spinX  : sX,\r\n           spinY  : sY,\r\n           pixelX : pX,\r\n           pixelY : pY };\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/util/normalizeWheel.js","!function(e,a){\"object\"==typeof exports&&\"undefined\"!=typeof module?module.exports=a():\"function\"==typeof define&&define.amd?define(a):e.anchorme=a()}(this,function(){\"use strict\";function e(e,a){return a={exports:{}},e(a,a.exports),a.exports}var a=e(function(e,a){function n(e){return e||(e={attributes:[],ips:!0,emails:!0,urls:!0,files:!0,truncate:1/0,defaultProtocol:\"http://\",list:!1}),\"object\"!=typeof e.attributes&&(e.attributes=[]),\"boolean\"!=typeof e.ips&&(e.ips=!0),\"boolean\"!=typeof e.emails&&(e.emails=!0),\"boolean\"!=typeof e.urls&&(e.urls=!0),\"boolean\"!=typeof e.files&&(e.files=!0),\"boolean\"!=typeof e.list&&(e.list=!1),\"string\"!=typeof e.defaultProtocol&&\"function\"!=typeof e.defaultProtocol&&(e.defaultProtocol=\"http://\"),\"number\"==typeof e.truncate||\"object\"==typeof e.truncate&&null!==e.truncate||(e.truncate=1/0),e}function t(e){return!isNaN(Number(e))&&!(Number(e)>65535)}Object.defineProperty(a,\"__esModule\",{value:!0}),a.defaultOptions=n,a.isPort=t}),n=e(function(e,a){Object.defineProperty(a,\"__esModule\",{value:!0}),a.tlds=[\"com\",\"org\",\"net\",\"uk\",\"gov\",\"edu\",\"io\",\"cc\",\"co\",\"aaa\",\"aarp\",\"abarth\",\"abb\",\"abbott\",\"abbvie\",\"abc\",\"able\",\"abogado\",\"abudhabi\",\"ac\",\"academy\",\"accenture\",\"accountant\",\"accountants\",\"aco\",\"active\",\"actor\",\"ad\",\"adac\",\"ads\",\"adult\",\"ae\",\"aeg\",\"aero\",\"aetna\",\"af\",\"afamilycompany\",\"afl\",\"africa\",\"ag\",\"agakhan\",\"agency\",\"ai\",\"aig\",\"aigo\",\"airbus\",\"airforce\",\"airtel\",\"akdn\",\"al\",\"alfaromeo\",\"alibaba\",\"alipay\",\"allfinanz\",\"allstate\",\"ally\",\"alsace\",\"alstom\",\"am\",\"americanexpress\",\"americanfamily\",\"amex\",\"amfam\",\"amica\",\"amsterdam\",\"analytics\",\"android\",\"anquan\",\"anz\",\"ao\",\"aol\",\"apartments\",\"app\",\"apple\",\"aq\",\"aquarelle\",\"ar\",\"aramco\",\"archi\",\"army\",\"arpa\",\"art\",\"arte\",\"as\",\"asda\",\"asia\",\"associates\",\"at\",\"athleta\",\"attorney\",\"au\",\"auction\",\"audi\",\"audible\",\"audio\",\"auspost\",\"author\",\"auto\",\"autos\",\"avianca\",\"aw\",\"aws\",\"ax\",\"axa\",\"az\",\"azure\",\"ba\",\"baby\",\"baidu\",\"banamex\",\"bananarepublic\",\"band\",\"bank\",\"bar\",\"barcelona\",\"barclaycard\",\"barclays\",\"barefoot\",\"bargains\",\"baseball\",\"basketball\",\"bauhaus\",\"bayern\",\"bb\",\"bbc\",\"bbt\",\"bbva\",\"bcg\",\"bcn\",\"bd\",\"be\",\"beats\",\"beauty\",\"beer\",\"bentley\",\"berlin\",\"best\",\"bestbuy\",\"bet\",\"bf\",\"bg\",\"bh\",\"bharti\",\"bi\",\"bible\",\"bid\",\"bike\",\"bing\",\"bingo\",\"bio\",\"biz\",\"bj\",\"black\",\"blackfriday\",\"blanco\",\"blockbuster\",\"blog\",\"bloomberg\",\"blue\",\"bm\",\"bms\",\"bmw\",\"bn\",\"bnl\",\"bnpparibas\",\"bo\",\"boats\",\"boehringer\",\"bofa\",\"bom\",\"bond\",\"boo\",\"book\",\"booking\",\"boots\",\"bosch\",\"bostik\",\"boston\",\"bot\",\"boutique\",\"box\",\"br\",\"bradesco\",\"bridgestone\",\"broadway\",\"broker\",\"brother\",\"brussels\",\"bs\",\"bt\",\"budapest\",\"bugatti\",\"build\",\"builders\",\"business\",\"buy\",\"buzz\",\"bv\",\"bw\",\"by\",\"bz\",\"bzh\",\"ca\",\"cab\",\"cafe\",\"cal\",\"call\",\"calvinklein\",\"cam\",\"camera\",\"camp\",\"cancerresearch\",\"canon\",\"capetown\",\"capital\",\"capitalone\",\"car\",\"caravan\",\"cards\",\"care\",\"career\",\"careers\",\"cars\",\"cartier\",\"casa\",\"case\",\"caseih\",\"cash\",\"casino\",\"cat\",\"catering\",\"catholic\",\"cba\",\"cbn\",\"cbre\",\"cbs\",\"cd\",\"ceb\",\"center\",\"ceo\",\"cern\",\"cf\",\"cfa\",\"cfd\",\"cg\",\"ch\",\"chanel\",\"channel\",\"chase\",\"chat\",\"cheap\",\"chintai\",\"chloe\",\"christmas\",\"chrome\",\"chrysler\",\"church\",\"ci\",\"cipriani\",\"circle\",\"cisco\",\"citadel\",\"citi\",\"citic\",\"city\",\"cityeats\",\"ck\",\"cl\",\"claims\",\"cleaning\",\"click\",\"clinic\",\"clinique\",\"clothing\",\"cloud\",\"club\",\"clubmed\",\"cm\",\"cn\",\"coach\",\"codes\",\"coffee\",\"college\",\"cologne\",\"comcast\",\"commbank\",\"community\",\"company\",\"compare\",\"computer\",\"comsec\",\"condos\",\"construction\",\"consulting\",\"contact\",\"contractors\",\"cooking\",\"cookingchannel\",\"cool\",\"coop\",\"corsica\",\"country\",\"coupon\",\"coupons\",\"courses\",\"cr\",\"credit\",\"creditcard\",\"creditunion\",\"cricket\",\"crown\",\"crs\",\"cruise\",\"cruises\",\"csc\",\"cu\",\"cuisinella\",\"cv\",\"cw\",\"cx\",\"cy\",\"cymru\",\"cyou\",\"cz\",\"dabur\",\"dad\",\"dance\",\"data\",\"date\",\"dating\",\"datsun\",\"day\",\"dclk\",\"dds\",\"de\",\"deal\",\"dealer\",\"deals\",\"degree\",\"delivery\",\"dell\",\"deloitte\",\"delta\",\"democrat\",\"dental\",\"dentist\",\"desi\",\"design\",\"dev\",\"dhl\",\"diamonds\",\"diet\",\"digital\",\"direct\",\"directory\",\"discount\",\"discover\",\"dish\",\"diy\",\"dj\",\"dk\",\"dm\",\"dnp\",\"do\",\"docs\",\"doctor\",\"dodge\",\"dog\",\"doha\",\"domains\",\"dot\",\"download\",\"drive\",\"dtv\",\"dubai\",\"duck\",\"dunlop\",\"duns\",\"dupont\",\"durban\",\"dvag\",\"dvr\",\"dz\",\"earth\",\"eat\",\"ec\",\"eco\",\"edeka\",\"education\",\"ee\",\"eg\",\"email\",\"emerck\",\"energy\",\"engineer\",\"engineering\",\"enterprises\",\"epost\",\"epson\",\"equipment\",\"er\",\"ericsson\",\"erni\",\"es\",\"esq\",\"estate\",\"esurance\",\"et\",\"eu\",\"eurovision\",\"eus\",\"events\",\"everbank\",\"exchange\",\"expert\",\"exposed\",\"express\",\"extraspace\",\"fage\",\"fail\",\"fairwinds\",\"faith\",\"family\",\"fan\",\"fans\",\"farm\",\"farmers\",\"fashion\",\"fast\",\"fedex\",\"feedback\",\"ferrari\",\"ferrero\",\"fi\",\"fiat\",\"fidelity\",\"fido\",\"film\",\"final\",\"finance\",\"financial\",\"fire\",\"firestone\",\"firmdale\",\"fish\",\"fishing\",\"fit\",\"fitness\",\"fj\",\"fk\",\"flickr\",\"flights\",\"flir\",\"florist\",\"flowers\",\"fly\",\"fm\",\"fo\",\"foo\",\"food\",\"foodnetwork\",\"football\",\"ford\",\"forex\",\"forsale\",\"forum\",\"foundation\",\"fox\",\"fr\",\"free\",\"fresenius\",\"frl\",\"frogans\",\"frontdoor\",\"frontier\",\"ftr\",\"fujitsu\",\"fujixerox\",\"fun\",\"fund\",\"furniture\",\"futbol\",\"fyi\",\"ga\",\"gal\",\"gallery\",\"gallo\",\"gallup\",\"game\",\"games\",\"gap\",\"garden\",\"gb\",\"gbiz\",\"gd\",\"gdn\",\"ge\",\"gea\",\"gent\",\"genting\",\"george\",\"gf\",\"gg\",\"ggee\",\"gh\",\"gi\",\"gift\",\"gifts\",\"gives\",\"giving\",\"gl\",\"glade\",\"glass\",\"gle\",\"global\",\"globo\",\"gm\",\"gmail\",\"gmbh\",\"gmo\",\"gmx\",\"gn\",\"godaddy\",\"gold\",\"goldpoint\",\"golf\",\"goo\",\"goodhands\",\"goodyear\",\"goog\",\"google\",\"gop\",\"got\",\"gp\",\"gq\",\"gr\",\"grainger\",\"graphics\",\"gratis\",\"green\",\"gripe\",\"group\",\"gs\",\"gt\",\"gu\",\"guardian\",\"gucci\",\"guge\",\"guide\",\"guitars\",\"guru\",\"gw\",\"gy\",\"hair\",\"hamburg\",\"hangout\",\"haus\",\"hbo\",\"hdfc\",\"hdfcbank\",\"health\",\"healthcare\",\"help\",\"helsinki\",\"here\",\"hermes\",\"hgtv\",\"hiphop\",\"hisamitsu\",\"hitachi\",\"hiv\",\"hk\",\"hkt\",\"hm\",\"hn\",\"hockey\",\"holdings\",\"holiday\",\"homedepot\",\"homegoods\",\"homes\",\"homesense\",\"honda\",\"honeywell\",\"horse\",\"hospital\",\"host\",\"hosting\",\"hot\",\"hoteles\",\"hotmail\",\"house\",\"how\",\"hr\",\"hsbc\",\"ht\",\"htc\",\"hu\",\"hughes\",\"hyatt\",\"hyundai\",\"ibm\",\"icbc\",\"ice\",\"icu\",\"id\",\"ie\",\"ieee\",\"ifm\",\"ikano\",\"il\",\"im\",\"imamat\",\"imdb\",\"immo\",\"immobilien\",\"in\",\"industries\",\"infiniti\",\"info\",\"ing\",\"ink\",\"institute\",\"insurance\",\"insure\",\"int\",\"intel\",\"international\",\"intuit\",\"investments\",\"ipiranga\",\"iq\",\"ir\",\"irish\",\"is\",\"iselect\",\"ismaili\",\"ist\",\"istanbul\",\"it\",\"itau\",\"itv\",\"iveco\",\"iwc\",\"jaguar\",\"java\",\"jcb\",\"jcp\",\"je\",\"jeep\",\"jetzt\",\"jewelry\",\"jio\",\"jlc\",\"jll\",\"jm\",\"jmp\",\"jnj\",\"jo\",\"jobs\",\"joburg\",\"jot\",\"joy\",\"jp\",\"jpmorgan\",\"jprs\",\"juegos\",\"juniper\",\"kaufen\",\"kddi\",\"ke\",\"kerryhotels\",\"kerrylogistics\",\"kerryproperties\",\"kfh\",\"kg\",\"kh\",\"ki\",\"kia\",\"kim\",\"kinder\",\"kindle\",\"kitchen\",\"kiwi\",\"km\",\"kn\",\"koeln\",\"komatsu\",\"kosher\",\"kp\",\"kpmg\",\"kpn\",\"kr\",\"krd\",\"kred\",\"kuokgroup\",\"kw\",\"ky\",\"kyoto\",\"kz\",\"la\",\"lacaixa\",\"ladbrokes\",\"lamborghini\",\"lamer\",\"lancaster\",\"lancia\",\"lancome\",\"land\",\"landrover\",\"lanxess\",\"lasalle\",\"lat\",\"latino\",\"latrobe\",\"law\",\"lawyer\",\"lb\",\"lc\",\"lds\",\"lease\",\"leclerc\",\"lefrak\",\"legal\",\"lego\",\"lexus\",\"lgbt\",\"li\",\"liaison\",\"lidl\",\"life\",\"lifeinsurance\",\"lifestyle\",\"lighting\",\"like\",\"lilly\",\"limited\",\"limo\",\"lincoln\",\"linde\",\"link\",\"lipsy\",\"live\",\"living\",\"lixil\",\"lk\",\"loan\",\"loans\",\"locker\",\"locus\",\"loft\",\"lol\",\"london\",\"lotte\",\"lotto\",\"love\",\"lpl\",\"lplfinancial\",\"lr\",\"ls\",\"lt\",\"ltd\",\"ltda\",\"lu\",\"lundbeck\",\"lupin\",\"luxe\",\"luxury\",\"lv\",\"ly\",\"ma\",\"macys\",\"madrid\",\"maif\",\"maison\",\"makeup\",\"man\",\"management\",\"mango\",\"market\",\"marketing\",\"markets\",\"marriott\",\"marshalls\",\"maserati\",\"mattel\",\"mba\",\"mc\",\"mcd\",\"mcdonalds\",\"mckinsey\",\"md\",\"me\",\"med\",\"media\",\"meet\",\"melbourne\",\"meme\",\"memorial\",\"men\",\"menu\",\"meo\",\"metlife\",\"mg\",\"mh\",\"miami\",\"microsoft\",\"mil\",\"mini\",\"mint\",\"mit\",\"mitsubishi\",\"mk\",\"ml\",\"mlb\",\"mls\",\"mm\",\"mma\",\"mn\",\"mo\",\"mobi\",\"mobile\",\"mobily\",\"moda\",\"moe\",\"moi\",\"mom\",\"monash\",\"money\",\"monster\",\"montblanc\",\"mopar\",\"mormon\",\"mortgage\",\"moscow\",\"moto\",\"motorcycles\",\"mov\",\"movie\",\"movistar\",\"mp\",\"mq\",\"mr\",\"ms\",\"msd\",\"mt\",\"mtn\",\"mtpc\",\"mtr\",\"mu\",\"museum\",\"mutual\",\"mv\",\"mw\",\"mx\",\"my\",\"mz\",\"na\",\"nab\",\"nadex\",\"nagoya\",\"name\",\"nationwide\",\"natura\",\"navy\",\"nba\",\"nc\",\"ne\",\"nec\",\"netbank\",\"netflix\",\"network\",\"neustar\",\"new\",\"newholland\",\"news\",\"next\",\"nextdirect\",\"nexus\",\"nf\",\"nfl\",\"ng\",\"ngo\",\"nhk\",\"ni\",\"nico\",\"nike\",\"nikon\",\"ninja\",\"nissan\",\"nissay\",\"nl\",\"no\",\"nokia\",\"northwesternmutual\",\"norton\",\"now\",\"nowruz\",\"nowtv\",\"np\",\"nr\",\"nra\",\"nrw\",\"ntt\",\"nu\",\"nyc\",\"nz\",\"obi\",\"observer\",\"off\",\"office\",\"okinawa\",\"olayan\",\"olayangroup\",\"oldnavy\",\"ollo\",\"om\",\"omega\",\"one\",\"ong\",\"onl\",\"online\",\"onyourside\",\"ooo\",\"open\",\"oracle\",\"orange\",\"organic\",\"orientexpress\",\"origins\",\"osaka\",\"otsuka\",\"ott\",\"ovh\",\"pa\",\"page\",\"pamperedchef\",\"panasonic\",\"panerai\",\"paris\",\"pars\",\"partners\",\"parts\",\"party\",\"passagens\",\"pay\",\"pccw\",\"pe\",\"pet\",\"pf\",\"pfizer\",\"pg\",\"ph\",\"pharmacy\",\"philips\",\"phone\",\"photo\",\"photography\",\"photos\",\"physio\",\"piaget\",\"pics\",\"pictet\",\"pictures\",\"pid\",\"pin\",\"ping\",\"pink\",\"pioneer\",\"pizza\",\"pk\",\"pl\",\"place\",\"play\",\"playstation\",\"plumbing\",\"plus\",\"pm\",\"pn\",\"pnc\",\"pohl\",\"poker\",\"politie\",\"porn\",\"post\",\"pr\",\"pramerica\",\"praxi\",\"press\",\"prime\",\"pro\",\"prod\",\"productions\",\"prof\",\"progressive\",\"promo\",\"properties\",\"property\",\"protection\",\"pru\",\"prudential\",\"ps\",\"pt\",\"pub\",\"pw\",\"pwc\",\"py\",\"qa\",\"qpon\",\"quebec\",\"quest\",\"qvc\",\"racing\",\"radio\",\"raid\",\"re\",\"read\",\"realestate\",\"realtor\",\"realty\",\"recipes\",\"red\",\"redstone\",\"redumbrella\",\"rehab\",\"reise\",\"reisen\",\"reit\",\"reliance\",\"ren\",\"rent\",\"rentals\",\"repair\",\"report\",\"republican\",\"rest\",\"restaurant\",\"review\",\"reviews\",\"rexroth\",\"rich\",\"richardli\",\"ricoh\",\"rightathome\",\"ril\",\"rio\",\"rip\",\"rmit\",\"ro\",\"rocher\",\"rocks\",\"rodeo\",\"rogers\",\"room\",\"rs\",\"rsvp\",\"ru\",\"ruhr\",\"run\",\"rw\",\"rwe\",\"ryukyu\",\"sa\",\"saarland\",\"safe\",\"safety\",\"sakura\",\"sale\",\"salon\",\"samsclub\",\"samsung\",\"sandvik\",\"sandvikcoromant\",\"sanofi\",\"sap\",\"sapo\",\"sarl\",\"sas\",\"save\",\"saxo\",\"sb\",\"sbi\",\"sbs\",\"sc\",\"sca\",\"scb\",\"schaeffler\",\"schmidt\",\"scholarships\",\"school\",\"schule\",\"schwarz\",\"science\",\"scjohnson\",\"scor\",\"scot\",\"sd\",\"se\",\"seat\",\"secure\",\"security\",\"seek\",\"select\",\"sener\",\"services\",\"ses\",\"seven\",\"sew\",\"sex\",\"sexy\",\"sfr\",\"sg\",\"sh\",\"shangrila\",\"sharp\",\"shaw\",\"shell\",\"shia\",\"shiksha\",\"shoes\",\"shop\",\"shopping\",\"shouji\",\"show\",\"showtime\",\"shriram\",\"si\",\"silk\",\"sina\",\"singles\",\"site\",\"sj\",\"sk\",\"ski\",\"skin\",\"sky\",\"skype\",\"sl\",\"sling\",\"sm\",\"smart\",\"smile\",\"sn\",\"sncf\",\"so\",\"soccer\",\"social\",\"softbank\",\"software\",\"sohu\",\"solar\",\"solutions\",\"song\",\"sony\",\"soy\",\"space\",\"spiegel\",\"spot\",\"spreadbetting\",\"sr\",\"srl\",\"srt\",\"st\",\"stada\",\"staples\",\"star\",\"starhub\",\"statebank\",\"statefarm\",\"statoil\",\"stc\",\"stcgroup\",\"stockholm\",\"storage\",\"store\",\"stream\",\"studio\",\"study\",\"style\",\"su\",\"sucks\",\"supplies\",\"supply\",\"support\",\"surf\",\"surgery\",\"suzuki\",\"sv\",\"swatch\",\"swiftcover\",\"swiss\",\"sx\",\"sy\",\"sydney\",\"symantec\",\"systems\",\"sz\",\"tab\",\"taipei\",\"talk\",\"taobao\",\"target\",\"tatamotors\",\"tatar\",\"tattoo\",\"tax\",\"taxi\",\"tc\",\"tci\",\"td\",\"tdk\",\"team\",\"tech\",\"technology\",\"tel\",\"telecity\",\"telefonica\",\"temasek\",\"tennis\",\"teva\",\"tf\",\"tg\",\"th\",\"thd\",\"theater\",\"theatre\",\"tiaa\",\"tickets\",\"tienda\",\"tiffany\",\"tips\",\"tires\",\"tirol\",\"tj\",\"tjmaxx\",\"tjx\",\"tk\",\"tkmaxx\",\"tl\",\"tm\",\"tmall\",\"tn\",\"to\",\"today\",\"tokyo\",\"tools\",\"top\",\"toray\",\"toshiba\",\"total\",\"tours\",\"town\",\"toyota\",\"toys\",\"tr\",\"trade\",\"trading\",\"training\",\"travel\",\"travelchannel\",\"travelers\",\"travelersinsurance\",\"trust\",\"trv\",\"tt\",\"tube\",\"tui\",\"tunes\",\"tushu\",\"tv\",\"tvs\",\"tw\",\"tz\",\"ua\",\"ubank\",\"ubs\",\"uconnect\",\"ug\",\"unicom\",\"university\",\"uno\",\"uol\",\"ups\",\"us\",\"uy\",\"uz\",\"va\",\"vacations\",\"vana\",\"vanguard\",\"vc\",\"ve\",\"vegas\",\"ventures\",\"verisign\",\"versicherung\",\"vet\",\"vg\",\"vi\",\"viajes\",\"video\",\"vig\",\"viking\",\"villas\",\"vin\",\"vip\",\"virgin\",\"visa\",\"vision\",\"vista\",\"vistaprint\",\"viva\",\"vivo\",\"vlaanderen\",\"vn\",\"vodka\",\"volkswagen\",\"volvo\",\"vote\",\"voting\",\"voto\",\"voyage\",\"vu\",\"vuelos\",\"wales\",\"walmart\",\"walter\",\"wang\",\"wanggou\",\"warman\",\"watch\",\"watches\",\"weather\",\"weatherchannel\",\"webcam\",\"weber\",\"website\",\"wed\",\"wedding\",\"weibo\",\"weir\",\"wf\",\"whoswho\",\"wien\",\"wiki\",\"williamhill\",\"win\",\"windows\",\"wine\",\"winners\",\"wme\",\"wolterskluwer\",\"woodside\",\"work\",\"works\",\"world\",\"wow\",\"ws\",\"wtc\",\"wtf\",\"xbox\",\"xerox\",\"xfinity\",\"xihuan\",\"xin\",\"xn--11b4c3d\",\"xn--1ck2e1b\",\"xn--1qqw23a\",\"xn--30rr7y\",\"xn--3bst00m\",\"xn--3ds443g\",\"xn--3e0b707e\",\"xn--3oq18vl8pn36a\",\"xn--3pxu8k\",\"xn--42c2d9a\",\"xn--45brj9c\",\"xn--45q11c\",\"xn--4gbrim\",\"xn--54b7fta0cc\",\"xn--55qw42g\",\"xn--55qx5d\",\"xn--5su34j936bgsg\",\"xn--5tzm5g\",\"xn--6frz82g\",\"xn--6qq986b3xl\",\"xn--80adxhks\",\"xn--80ao21a\",\"xn--80aqecdr1a\",\"xn--80asehdb\",\"xn--80aswg\",\"xn--8y0a063a\",\"xn--90a3ac\",\"xn--90ae\",\"xn--90ais\",\"xn--9dbq2a\",\"xn--9et52u\",\"xn--9krt00a\",\"xn--b4w605ferd\",\"xn--bck1b9a5dre4c\",\"xn--c1avg\",\"xn--c2br7g\",\"xn--cck2b3b\",\"xn--cg4bki\",\"xn--clchc0ea0b2g2a9gcd\",\"xn--czr694b\",\"xn--czrs0t\",\"xn--czru2d\",\"xn--d1acj3b\",\"xn--d1alf\",\"xn--e1a4c\",\"xn--eckvdtc9d\",\"xn--efvy88h\",\"xn--estv75g\",\"xn--fct429k\",\"xn--fhbei\",\"xn--fiq228c5hs\",\"xn--fiq64b\",\"xn--fiqs8s\",\"xn--fiqz9s\",\"xn--fjq720a\",\"xn--flw351e\",\"xn--fpcrj9c3d\",\"xn--fzc2c9e2c\",\"xn--fzys8d69uvgm\",\"xn--g2xx48c\",\"xn--gckr3f0f\",\"xn--gecrj9c\",\"xn--gk3at1e\",\"xn--h2brj9c\",\"xn--hxt814e\",\"xn--i1b6b1a6a2e\",\"xn--imr513n\",\"xn--io0a7i\",\"xn--j1aef\",\"xn--j1amh\",\"xn--j6w193g\",\"xn--jlq61u9w7b\",\"xn--jvr189m\",\"xn--kcrx77d1x4a\",\"xn--kprw13d\",\"xn--kpry57d\",\"xn--kpu716f\",\"xn--kput3i\",\"xn--l1acc\",\"xn--lgbbat1ad8j\",\"xn--mgb9awbf\",\"xn--mgba3a3ejt\",\"xn--mgba3a4f16a\",\"xn--mgba7c0bbn0a\",\"xn--mgbaam7a8h\",\"xn--mgbab2bd\",\"xn--mgbai9azgqp6j\",\"xn--mgbayh7gpa\",\"xn--mgbb9fbpob\",\"xn--mgbbh1a71e\",\"xn--mgbc0a9azcg\",\"xn--mgbca7dzdo\",\"xn--mgberp4a5d4ar\",\"xn--mgbi4ecexp\",\"xn--mgbpl2fh\",\"xn--mgbt3dhd\",\"xn--mgbtx2b\",\"xn--mgbx4cd0ab\",\"xn--mix891f\",\"xn--mk1bu44c\",\"xn--mxtq1m\",\"xn--ngbc5azd\",\"xn--ngbe9e0a\",\"xn--node\",\"xn--nqv7f\",\"xn--nqv7fs00ema\",\"xn--nyqy26a\",\"xn--o3cw4h\",\"xn--ogbpf8fl\",\"xn--p1acf\",\"xn--p1ai\",\"xn--pbt977c\",\"xn--pgbs0dh\",\"xn--pssy2u\",\"xn--q9jyb4c\",\"xn--qcka1pmc\",\"xn--qxam\",\"xn--rhqv96g\",\"xn--rovu88b\",\"xn--s9brj9c\",\"xn--ses554g\",\"xn--t60b56a\",\"xn--tckwe\",\"xn--tiq49xqyj\",\"xn--unup4y\",\"xn--vermgensberater-ctb\",\"xn--vermgensberatung-pwb\",\"xn--vhquv\",\"xn--vuq861b\",\"xn--w4r85el8fhu5dnra\",\"xn--w4rs40l\",\"xn--wgbh1c\",\"xn--wgbl6a\",\"xn--xhq521b\",\"xn--xkc2al3hye2a\",\"xn--xkc2dl3a5ee0h\",\"xn--y9a3aq\",\"xn--yfro4i67o\",\"xn--ygbi2ammx\",\"xn--zfr164b\",\"xperia\",\"xxx\",\"xyz\",\"yachts\",\"yahoo\",\"yamaxun\",\"yandex\",\"ye\",\"yodobashi\",\"yoga\",\"yokohama\",\"you\",\"youtube\",\"yt\",\"yun\",\"za\",\"zappos\",\"zara\",\"zero\",\"zip\",\"zippo\",\"zm\",\"zone\",\"zuerich\",\"zw\"],a.htmlAttrs=[\"src=\",\"data=\",\"href=\",\"cite=\",\"formaction=\",\"icon=\",\"manifest=\",\"poster=\",\"codebase=\",\"background=\",\"profile=\",\"usemap=\"]}),t=e(function(e,a){function t(e){var a=e.match(o);if(null===a)return!1;for(var t=r.length-1;t>=0;t--)if(r[t].test(e))return!1;var i=a[2];return!!i&&-1!==n.tlds.indexOf(i)}Object.defineProperty(a,\"__esModule\",{value:!0});var o=/^[a-z0-9!#$%&'*+\\-\\/=?^_`{|}~.]+@([a-z0-9%\\-]+\\.){1,}([a-z0-9\\-]+)?$/i,r=[/^[!#$%&'*+\\-\\/=?^_`{|}~.]/,/[.]{2,}[a-z0-9!#$%&'*+\\-\\/=?^_`{|}~.]+@/i,/\\.@/];a.default=t}),o=e(function(e,n){function t(e){if(!o.test(e))return!1;var n=e.split(\".\"),t=Number(n[0]);if(isNaN(t)||t>255||t<0)return!1;var r=Number(n[1]);if(isNaN(r)||r>255||r<0)return!1;var i=Number(n[2]);if(isNaN(i)||i>255||i<0)return!1;var s=Number((n[3].match(/^\\d+/)||[])[0]);if(isNaN(s)||s>255||s<0)return!1;var c=(n[3].match(/(^\\d+)(:)(\\d+)/)||[])[3];return!(c&&!a.isPort(c))}Object.defineProperty(n,\"__esModule\",{value:!0});var o=/^(\\d{1,3}\\.){3}\\d{1,3}(:\\d{1,5})?(\\/([a-z0-9\\-._~:\\/\\?#\\[\\]@!$&'\\(\\)\\*\\+,;=%]+)?)?$/i;n.default=t}),r=e(function(e,t){function o(e){var t=e.match(r);return null!==t&&(\"string\"==typeof t[3]&&(-1!==n.tlds.indexOf(t[3].toLowerCase())&&!(t[5]&&!a.isPort(t[5]))))}Object.defineProperty(t,\"__esModule\",{value:!0});var r=/^(https?:\\/\\/|ftps?:\\/\\/)?([a-z0-9%\\-]+\\.){1,}([a-z0-9\\-]+)?(:(\\d{1,5}))?(\\/([a-z0-9\\-._~:\\/\\?#\\[\\]@!$&'\\(\\)\\*\\+,;=%]+)?)?$/i;t.default=o}),i=e(function(e,a){function n(e,a,t){return e.forEach(function(o,r){!(o.indexOf(\".\")>-1)||e[r-1]===a&&e[r+1]===t||e[r+1]!==a&&e[r+1]!==t||(e[r]=e[r]+e[r+1],\"string\"==typeof e[r+2]&&(e[r]=e[r]+e[r+2]),\"string\"==typeof e[r+3]&&(e[r]=e[r]+e[r+3]),\"string\"==typeof e[r+4]&&(e[r]=e[r]+e[r+4]),e.splice(r+1,4),n(e,a,t))}),e}function t(e){return e=n(e,\"(\",\")\"),e=n(e,\"[\",\"]\"),e=n(e,'\"','\"'),e=n(e,\"'\",\"'\")}Object.defineProperty(a,\"__esModule\",{value:!0}),a.fixSeparators=n,a.default=t}),s=e(function(e,a){function n(e){var a=e.replace(/([\\s\\(\\)\\[\\]<>\"'])/g,\"\\0$1\\0\").replace(/([?;:,.!]+)(?=(\\0|$|\\s))/g,\"\\0$1\\0\").split(\"\\0\");return i.default(a)}function t(e){return e.join(\"\")}Object.defineProperty(a,\"__esModule\",{value:!0}),a.separate=n,a.deSeparate=t}),c=e(function(e,a){function n(e){return e=e.toLowerCase(),0===e.indexOf(\"http://\")?\"http://\":0===e.indexOf(\"https://\")?\"https://\":0===e.indexOf(\"ftp://\")?\"ftp://\":0===e.indexOf(\"ftps://\")?\"ftps://\":0===e.indexOf(\"file:///\")?\"file:///\":0===e.indexOf(\"mailto:\")&&\"mailto:\"}Object.defineProperty(a,\"__esModule\",{value:!0}),a.default=n}),l=e(function(e,a){function i(e,a){return e.map(function(i,s){var l=encodeURI(i);if(l.indexOf(\".\")<1&&!c.default(l))return i;var u=null,d=c.default(l)||\"\";return d&&(l=l.substr(d.length)),a.files&&\"file:///\"===d&&l.split(/\\/|\\\\/).length-1&&(u={reason:\"file\",protocol:d,raw:i,encoded:l}),!u&&a.urls&&r.default(l)&&(u={reason:\"url\",protocol:d||(\"function\"==typeof a.defaultProtocol?a.defaultProtocol(i):a.defaultProtocol),raw:i,encoded:l}),!u&&a.emails&&t.default(l)&&(u={reason:\"email\",protocol:\"mailto:\",raw:i,encoded:l}),!u&&a.ips&&o.default(l)&&(u={reason:\"ip\",protocol:d||(\"function\"==typeof a.defaultProtocol?a.defaultProtocol(i):a.defaultProtocol),raw:i,encoded:l}),u&&(\"'\"!==e[s-1]&&'\"'!==e[s-1]||!~n.htmlAttrs.indexOf(e[s-2]))?u:i})}Object.defineProperty(a,\"__esModule\",{value:!0}),a.default=i}),u=e(function(e,a){function n(e,a){var n=o.separate(e),r=l.default(n,a);if(a.exclude)for(var i=0;i<r.length;i++){var c=r[i];\"object\"==typeof c&&a.exclude(c)&&(r[i]=c.raw)}if(a.list){for(var u=[],d=0;d<r.length;d++){var b=r[d];\"string\"!=typeof b&&u.push(b)}return u}return r=r.map(function(e){return\"string\"==typeof e?e:t(e,a)}),s.deSeparate(r)}function t(e,a){var n=e.protocol+e.encoded,t=e.raw;return\"number\"==typeof a.truncate&&t.length>a.truncate&&(t=t.substring(0,a.truncate)+\"...\"),\"object\"==typeof a.truncate&&t.length>a.truncate[0]+a.truncate[1]&&(t=t.substr(0,a.truncate[0])+\"...\"+t.substr(t.length-a.truncate[1])),void 0===a.attributes&&(a.attributes=[]),'<a href=\"'+n+'\" '+a.attributes.map(function(a){if(\"function\"!=typeof a)return\" \"+a.name+'=\"'+a.value+'\" ';var n=(a(e)||{}).name,t=(a(e)||{}).value;return n&&!t?\" name \":n&&t?\" \"+n+'=\"'+t+'\" ':void 0}).join(\"\")+\">\"+t+\"</a>\"}Object.defineProperty(a,\"__esModule\",{value:!0});var o=s;a.default=n}),d=e(function(e,n){Object.defineProperty(n,\"__esModule\",{value:!0});var i=function(e,n){return n=a.defaultOptions(n),u.default(e,n)};i.validate={ip:o.default,url:function(e){var a=c.default(e)||\"\";return e=e.substr(a.length),e=encodeURI(e),r.default(e)},email:t.default},n.default=i});return function(e){return e&&e.__esModule?e.default:e}(d)});\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/util/anchorme.js","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/events/events.js\n// module id = 17\n// module chunks = 0","module.exports = __webpack_public_path__ + \"img/toolset.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/img/toolset.png\n// module id = 18\n// module chunks = 0","module.exports = __webpack_public_path__ + \"img/unloaded.png\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/img/unloaded.png\n// module id = 19\n// module chunks = 0","'use strict';\r\nimport { Lerp } from './util/Lerp.js';\r\nimport { colorUtils as color } from './util/color.js';\r\nimport { misc, playerList, playerListTable } from './main.js';\r\nimport { Fx, PLAYERFX } from './Fx.js';\r\nimport { tools } from './tools.js';\r\n\r\nexport class Player {\r\n    constructor(x, y, rgb, tool, id) {\r\n        this.id = id.toString(); /* Prevents calling .toString every frame */\r\n        this._x = new Lerp(x, x, 65);\r\n        this._y = new Lerp(y, y, 65);\r\n\r\n        this.tool = tools[tool] || tools['cursor'];\r\n        this.fx = new Fx(tool ? tool.fxType : PLAYERFX.NONE, { player: this });\r\n        this.fx.setVisible(misc.world.validMousePos(\r\n            Math.floor(this.endX / 16), Math.floor(this.endY / 16)));\r\n\r\n        this.rgb = rgb;\r\n        this.htmlRgb = color.toHTML(color.u24_888(rgb[0], rgb[1], rgb[2]));\r\n\r\n        this.clr = (((id + 75387) * 67283 + 53143) % 256) << 16\r\n                 | (((id + 9283)  * 4673  + 7483)  % 256) << 8\r\n                 | (  id * 3000                    % 256);\r\n        this.clr = color.toHTML(this.clr);\r\n\r\n\t\tvar playerListEntry = document.createElement(\"tr\");\r\n\t\tplayerListEntry.innerHTML = \"<td>\" + this.id + \"</td><td>\" + Math.floor(x / 16) + \"</td><td>\" + Math.floor(y / 16) + \"</td>\";\r\n\t\tplayerList[this.id] = playerListEntry;\r\n\t\tplayerListTable.appendChild(playerListEntry);\r\n\t}\r\n\t\r\n\tget tileX() {\r\n\t\treturn Math.floor(this.x / 16);\r\n\t}\r\n\r\n\tget tileY() {\r\n\t\treturn Math.floor(this.y / 16);\r\n\t}\r\n\r\n    get endX() {\r\n        return this._x.end;\r\n    }\r\n\r\n    get endY() {\r\n        return this._y.end;\r\n    }\r\n\r\n    get x() {\r\n        return this._x.val;\r\n    }\r\n\r\n    get y() {\r\n        return this._y.val;\r\n    }\r\n\r\n    update(x, y, rgb, tool) {\r\n        this._x.val = x;\r\n        this._y.val = y;\r\n        /* TODO: fix weird bug (caused by connecting before tools initialized?) */\r\n        //console.log(tool)\r\n        this.tool = tools[tool] || tools['cursor'];\r\n        this.fx.setRenderer((this.tool || {}).fxRenderer ); // temp until fix: || {}\r\n        this.fx.setVisible(misc.world.validMousePos(\r\n            Math.floor(this.endX / 16), Math.floor(this.endY / 16)));\r\n        this.rgb = rgb;\r\n        this.htmlRgb = color.toHTML(color.u24_888(rgb[0], rgb[1], rgb[2]));\r\n\r\n\t\tplayerList[this.id].childNodes[1].innerHTML = Math.floor(x / 16);\r\n\t\tplayerList[this.id].childNodes[2].innerHTML = Math.floor(y / 16);\r\n    }\r\n\r\n    disconnect() {\r\n        this.fx.delete();\r\n\r\n\t\tplayerListTable.removeChild(playerList[this.id]);\r\n\t\tdelete playerList[this.id];\r\n    }\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/Player.js","'use strict';\r\nimport { OldProtocol } from './old.js';\r\nimport { options } from './../conf.js';\r\n\r\nexport const definedProtos = {\r\n\t'old': OldProtocol\r\n};\r\n\r\nexport function resolveProtocols() {\r\n\tfor (var i = 0; i < options.serverAddress.length; i++) {\r\n\t\tvar server = options.serverAddress[i];\r\n\t\tserver.proto = definedProtos[server.proto];\r\n\t}\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/js/protocol/all.js","'use strict';\r\nimport { Protocol } from './Protocol.js';\r\nimport { EVENTS as e, RANK, options } from './../conf.js';\r\nimport { eventSys } from './../global.js';\r\nimport { Chunk } from './../World.js';\r\nimport { Bucket } from './../util/Bucket.js';\r\nimport { decompress } from './../util/misc.js';\r\nimport { loadAndRequestCaptcha } from './../captcha.js';\r\nimport { colorUtils as color } from './../util/color.js';\r\nimport { player, shouldUpdate, networkRankVerification } from './../local_player.js';\r\nimport { camera } from './../canvas_renderer.js';\r\nimport { mouse, elements } from './../main.js';\r\n\r\nexport const captchaState = {\r\n\tCA_WAITING: 0,\r\n\tCA_VERIFYING: 1,\r\n\tCA_VERIFIED: 2,\r\n\tCA_OK: 3,\r\n\tCA_INVALID: 4\r\n};\r\n\r\nexport const OldProtocol = {\r\n\tclass: null,\r\n\tchunkSize: 16,\r\n\tnetUpdateSpeed: 20,\r\n\tclusterChunkAmount: 64,\r\n\tmaxWorldNameLength: 24,\r\n\tworldBorder: 0xFFFFF,\r\n\tchatBucket: [4, 6],\r\n\tplaceBucket: {\r\n\t\t[RANK.NONE]: [0, 1],\r\n\t\t[RANK.USER]: [32, 4],\r\n\t\t[RANK.MODERATOR]: [32, 2],\r\n\t\t[RANK.ADMIN]: [32, 0]\r\n\t},\r\n\tmaxMessageLength: {\r\n\t\t[RANK.NONE]: 128,\r\n\t\t[RANK.USER]: 128,\r\n\t\t[RANK.MODERATOR]: 512,\r\n\t\t[RANK.ADMIN]: 16384\r\n\t},\r\n\ttools: {\r\n\t\tid: {}, /* Generated automatically */\r\n\t\t0: 'cursor',\r\n\t\t1: 'move',\r\n\t\t2: 'pipette',\r\n\t\t3: 'eraser',\r\n\t\t4: 'zoom',\r\n\t\t5: 'fill',\r\n\t\t6: 'paste',\r\n\t\t7: 'export',\r\n\t\t8: 'line',\r\n\t\t9: 'protect'\r\n\t},\r\n\tmisc: {\r\n\t\tworldVerification: 1234,\r\n\t\tchatVerification: String.fromCharCode(10),\r\n\t\ttokenVerification: 'CaptchA'\r\n\t},\r\n\topCode: {\r\n\t\tclient: {\r\n\t\t\t\r\n\t\t},\r\n\t\tserver: {\r\n\t\t\tsetId: 0,\r\n\t\t\tworldUpdate: 1,\r\n\t\t\tchunkLoad: 2,\r\n\t\t\tteleport: 3,\r\n\t\t\tsetRank: 4,\r\n\t\t\tcaptcha: 5,\r\n\t\t\tsetPQuota: 6,\r\n\t\t\tchunkProtected: 7\r\n\t\t}\r\n\t}\r\n};\r\n\r\nfor (const id in OldProtocol.tools) {\r\n\tif (+id >= 0) {\r\n\t\tOldProtocol.tools.id[OldProtocol.tools[id]] = +id;\r\n\t}\r\n}\r\n\r\nfunction stoi(string, max) {\r\n\tvar ints = [];\r\n\tvar fstring = \"\";\r\n\tstring = string.toLowerCase();\r\n\tfor (var i = 0; i < string.length && i < max; i++) {\r\n\t\tvar charCode = string.charCodeAt(i);\r\n\t\tif ((charCode < 123 && charCode > 96)\r\n\t\t|| (charCode < 58 && charCode > 47)\r\n\t\t|| charCode == 95 || charCode == 46) {\r\n\t\t\tfstring += String.fromCharCode(charCode);\r\n\t\t\tints.push(charCode);\r\n\t\t}\r\n\t}\r\n\treturn [ints, fstring];\r\n}\r\n\r\nclass OldProtocolImpl extends Protocol {\r\n\tconstructor(ws, worldName) {\r\n\t\tsuper(ws);\r\n\t\tsuper.hookEvents(this);\r\n\t\tthis.lastSentX = 0;\r\n\t\tthis.lastSentY = 0;\r\n\t\tthis.playercount = 1;\r\n\t\tthis.worldName = worldName ? worldName : options.defaultWorld;\r\n\t\tthis.players = {};\r\n\t\tthis.chunksLoading = {}; /* duplicate */\r\n\t\tthis.waitingForChunks = 0;\r\n\t\tthis.id = null;\r\n\r\n\t\tvar params = OldProtocol.chatBucket;\r\n\t\tthis.chatBucket = new Bucket(params[0], params[1]);\r\n\t\tparams = OldProtocol.placeBucket[player.rank];\r\n\t\tthis.placeBucket = new Bucket(params[0], params[1]);\r\n\r\n\t\tthis.interval = null;\r\n\r\n\t\tthis.joinFunc = () => {\r\n\t\t\tthis.interval = setInterval(() => this.sendUpdates(), 1000 / OldProtocol.netUpdateSpeed);\r\n\t\t};\r\n\r\n\t\tconst rankChanged = rank => {\r\n\t\t\tthis.placeBucket.infinite = rank === RANK.ADMIN;\r\n\t\t\telements.chatInput.maxLength = OldProtocol.maxMessageLength[rank];\r\n\t\t};\r\n\t\tthis.leaveFunc = () => {\r\n\t\t\teventSys.removeListener(e.net.sec.rank, rankChanged);\r\n\t\t};\r\n\t\teventSys.once(e.net.world.join, this.joinFunc);\r\n\t\teventSys.on(e.net.sec.rank, rankChanged);\r\n\t}\r\n\r\n\tcloseHandler() {\r\n\t\tsuper.closeHandler();\r\n\t\tclearInterval(this.interval);\r\n\t\teventSys.emit(e.net.sec.rank, RANK.NONE);\r\n\t\teventSys.removeListener(e.net.world.join, this.joinFunc);\r\n\t\tthis.leaveFunc();\r\n\t}\r\n\r\n\tmessageHandler(message) {\r\n\t\tmessage = message.data;\r\n\t\tif (typeof message === \"string\") {\r\n\t\t\tif (message.indexOf(\"DEV\") == 0) {\r\n\t\t\t\teventSys.emit(e.net.devChat, message.slice(3));\r\n\t\t\t} else {\r\n\t\t\t\teventSys.emit(e.net.chat, message);\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\t\t\r\n\t\tvar dv = new DataView(message);\r\n\t\tvar oc = OldProtocol.opCode.server;\r\n\t\tswitch (dv.getUint8(0)) {\r\n\t\t\tcase oc.setId: // Get id\r\n\t\t\t\tlet id = dv.getUint32(1, true);\r\n\t\t\t\tthis.id = id;\r\n\t\t\t\teventSys.emit(e.net.world.join, this.worldName);\r\n\t\t\t\teventSys.emit(e.net.world.setId, id);\r\n\t\t\t\teventSys.emit(e.net.playerCount, this.playercount);\r\n\t\t\t\teventSys.emit(e.net.chat, \"[Server] Joined world: \\\"\" + this.worldName + \"\\\", your ID is: \" + id + \"!\");\r\n\t\t\t\tbreak;\r\n\r\n\t\t\tcase oc.worldUpdate: // Get all cursors, tile updates, disconnects\r\n\t\t\t\tvar shouldrender = 0;\r\n\t\t\t\t// Cursors\r\n\t\t\t\tvar updated = false;\r\n\t\t\t\tvar updates = {};\r\n\t\t\t\tfor (var i = dv.getUint8(1); i--;) {\r\n\t\t\t\t\tupdated = true;\r\n\t\t\t\t\tvar pid = dv.getUint32(2 + i * 16, true);\r\n\t\t\t\t\tif (pid === this.id) {\r\n\t\t\t\t\t\tcontinue;\r\n\t\t\t\t\t}\r\n\t  \t\t\t\tvar pmx = dv.getInt32(2 + i * 16 + 4, true);\r\n\t  \t\t\t\tvar pmy = dv.getInt32(2 + i * 16 + 8, true);\r\n\t  \t\t\t\tvar pr = dv.getUint8(2 + i * 16 + 12);\r\n\t  \t\t\t\tvar pg = dv.getUint8(2 + i * 16 + 13);\r\n\t  \t\t\t\tvar pb = dv.getUint8(2 + i * 16 + 14);\r\n\t  \t\t\t\tvar ptool = dv.getUint8(2 + i * 16 + 15);\r\n\t\t\t\t\tupdates[pid] = {\r\n\t\t\t\t\t\tx: pmx,\r\n\t\t\t\t\t\ty: pmy,\r\n\t\t\t\t\t\trgb: [pr, pg, pb],\r\n\t\t\t\t\t\ttool: OldProtocol.tools[ptool]\r\n\t\t\t\t\t};\r\n\t  \t\t\t\tif (!this.players[pid]) {\r\n\t\t\t\t\t\t++this.playercount;\r\n\t\t\t\t\t\teventSys.emit(e.net.playerCount, this.playercount);\r\n\t  \t\t\t\t\tthis.players[pid] = true;\r\n\t  \t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tif (updated) {\r\n\t\t\t\t\teventSys.emit(e.net.world.playersMoved, updates);\r\n\t\t\t\t}\r\n\t  \t\t\tvar off = 2 + dv.getUint8(1) * 16;\r\n\t\t\t\t// Tile updates\r\n\t\t\t\tupdated = false;\r\n\t\t\t\tupdates = [];\r\n\t  \t\t\tfor (var i = dv.getUint16(off, true), j = 0; j < i; j++) {\r\n\t\t\t\t\tupdated = true;\r\n\t  \t\t\t\tvar bpx = dv.getInt32(2 + off + j * 11, true);\r\n\t  \t\t\t\tvar bpy = dv.getInt32(2 + off + j * 11 + 4, true);\r\n\t  \t\t\t\tvar br = dv.getUint8(2 + off + j * 11 + 8);\r\n\t  \t\t\t\tvar bg = dv.getUint8(2 + off + j * 11 + 9);\r\n\t  \t\t\t\tvar bb = dv.getUint8(2 + off + j * 11 + 10);\r\n\t\t\t\t\tvar bbgr = bb << 16 | bg << 8 | br;\r\n\t\t\t\t\tupdates.push({\r\n\t\t\t\t\t\tx: bpx,\r\n\t\t\t\t\t\ty: bpy,\r\n\t\t\t\t\t\trgb: bbgr\r\n\t\t\t\t\t});\r\n\t\t\t\t}\r\n\t\t\t\tif (updated) {\r\n\t\t\t\t\teventSys.emit(e.net.world.tilesUpdated, updates);\r\n\t\t\t\t}\r\n\t  \t\t\toff += dv.getUint16(off, true) * 11 + 2;\r\n\t\t\t\t// Disconnects\r\n\t\t\t\tvar decreased = false;\r\n\t\t\t\tupdated = false;\r\n\t\t\t\tupdates = [];\r\n\t  \t\t\tfor (var k = dv.getUint8(off); k--;) {\r\n\t\t\t\t\tupdated = true;\r\n\t\t\t\t\tvar dpid = dv.getUint32(1 + off + k * 4, true);\r\n\t\t\t\t\tupdates.push(dpid);\r\n\t\t\t\t\tif (this.players[dpid] && this.playercount > 1) {\r\n\t\t\t\t\t\tdecreased = true;\r\n\t\t\t\t\t\t--this.playercount;\r\n\t\t\t\t\t\tdelete this.players[dpid];\r\n\t\t\t\t\t}\r\n\t  \t\t\t}\r\n\t\t\t\tif (updated) {\r\n\t\t\t\t\teventSys.emit(e.net.world.playersLeft, updates);\r\n\t\t\t\t\tif (decreased) {\r\n\t\t\t\t\t\teventSys.emit(e.net.playerCount, this.playercount);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\tcase oc.chunkLoad: // Get chunk\r\n\t\t\t\tvar chunkX = dv.getInt32(1, true);\r\n\t\t\t\tvar chunkY = dv.getInt32(5, true);\r\n\t\t\t\tvar locked = dv.getUint8(9);\r\n\t\t\t\tvar u8data = new Uint8Array(message, 10, message.byteLength - 10);\r\n\t\t\t\t//console.log(u8data);\r\n\t\t\t\tu8data = decompress(u8data);\r\n\t\t\t\tvar key = `${chunkX},${chunkY}`;\r\n\t\t\t\tvar u32data = new Uint32Array(OldProtocol.chunkSize * OldProtocol.chunkSize);\r\n\t\t\t\tfor (var i = 0, u = 0; i < u8data.length; i += 3) { /* Need to make a copy ;-; */\r\n\t\t\t\t\tvar color = u8data[i + 2] << 16\r\n\t\t\t\t\t\t| u8data[i + 1] << 8\r\n\t\t\t\t\t\t| u8data[i]\r\n\t\t\t\t\tu32data[u++] = 0xFF000000 | color;\r\n\t\t\t\t}\r\n\t\t\t\tif (!this.chunksLoading[key]) {\r\n\t\t\t\t\teventSys.emit(e.net.chunk.set, chunkX, chunkY, u32data);\r\n\t\t\t\t} else {\r\n\t\t\t\t\tdelete this.chunksLoading[key];\r\n\t\t\t\t\tthis.waitingForChunks--;\r\n\t\t\t\t\tvar chunk = new Chunk(chunkX, chunkY, u32data, locked);\r\n\t\t\t\t\teventSys.emit(e.net.chunk.load, chunk);\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\tcase oc.teleport: // Teleport\r\n\t\t\t\tlet x = dv.getInt32(1, true);\r\n\t\t\t\tlet y = dv.getInt32(5, true);\r\n\t\t\t\teventSys.emit(e.net.world.teleported, x, y);\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\tcase oc.setRank: // new rank\r\n\t\t\t\tnetworkRankVerification[0] = dv.getUint8(1);\r\n\t\t\t\teventSys.emit(e.net.sec.rank, dv.getUint8(1));\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\tcase oc.captcha: // Captcha\r\n\t\t\t\tswitch (dv.getUint8(1)) {\r\n\t\t\t\t\tcase captchaState.CA_WAITING:\r\n\t\t\t\t\t\tloadAndRequestCaptcha();\r\n\t\t\t\t\t\teventSys.once(e.misc.captchaToken, token => {\r\n\t\t\t\t\t\t\tlet message = OldProtocol.misc.tokenVerification + token;\r\n\t\t\t\t\t\t\tthis.ws.send(message);\r\n\t\t\t\t\t\t});\r\n\t\t\t\t\t\tbreak;\r\n\r\n\t\t\t\t\tcase captchaState.CA_OK:\r\n\t\t\t\t\t   this.worldName = this.joinWorld(this.worldName);\r\n\t\t\t\t\t   break;\r\n\t\t\t\t}\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\tcase oc.setPQuota:\r\n\t\t\t\tlet rate = dv.getUint16(1, true);\r\n\t\t\t\tlet per = dv.getUint16(3, true);\r\n\t\t\t\tthis.placeBucket = new Bucket(rate, per);\r\n\t\t\t\tbreak;\r\n\t\t\t\t\r\n\t\t\tcase oc.chunkProtected:\r\n\t\t\t\tlet cx = dv.getInt32(1, true);\r\n\t\t\t\tlet cy = dv.getInt32(5, true);\r\n\t\t\t\tlet newState = dv.getUint8(9);\r\n\t\t\t\teventSys.emit(e.net.chunk.lock, cx, cy, newState);\r\n\t\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\tjoinWorld(name) {\r\n\t\tvar nstr = stoi(name, OldProtocol.maxWorldNameLength);\r\n\t\teventSys.emit(e.net.world.joining, name);\r\n\t\tvar array = new ArrayBuffer(nstr[0].length + 2);\r\n\t\tvar dv = new DataView(array);\r\n\t\tfor (var i = nstr[0].length; i--;) {\r\n\t\t\tdv.setUint8(i, nstr[0][i]);\r\n\t\t}\r\n\t\tdv.setUint16(nstr[0].length, OldProtocol.misc.worldVerification, true);\r\n\t\tthis.ws.send(array);\r\n\t\treturn nstr[1];\r\n\t}\r\n\t\r\n\trequestChunk(x, y) {\r\n\t\tlet wb = OldProtocol.worldBorder;\r\n\t\tvar key = `${x},${y}`;\r\n\t\tif (x > wb || y > wb || x < ~wb || y < ~wb || this.chunksLoading[key]) {\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tthis.chunksLoading[key] = true;\r\n\t\tthis.waitingForChunks++;\r\n\t\tvar array = new ArrayBuffer(8);\r\n\t\tvar dv = new DataView(array);\r\n\t\tdv.setInt32(0, x, true);\r\n\t\tdv.setInt32(4, y, true);\r\n\t\tthis.ws.send(array);\r\n\t}\r\n\r\n\tallChunksLoaded() {\r\n\t\treturn this.waitingForChunks === 0;\r\n\t}\r\n\t\t\r\n\tupdatePixel(x, y, rgb) {\r\n\t\tvar distx = Math.trunc(x / OldProtocol.chunkSize) - Math.trunc(this.lastSentX / (OldProtocol.chunkSize * 16)); distx *= distx;\r\n\t\tvar disty = Math.trunc(y / OldProtocol.chunkSize) - Math.trunc(this.lastSentY / (OldProtocol.chunkSize * 16)); disty *= disty;\r\n\t\tvar dist = Math.sqrt(distx + disty);\r\n\t\tif (this.isConnected() && (dist < 3 || player.rank == RANK.ADMIN) && this.placeBucket.canSpend(1)) {\r\n\t\t\tvar array = new ArrayBuffer(11);\r\n\t\t\tvar dv = new DataView(array);\r\n\t\t\tdv.setInt32(0,  x, true);\r\n\t\t\tdv.setInt32(4,  y, true);\r\n\t\t\tdv.setUint8(8, rgb[0]);\r\n\t\t\tdv.setUint8(9, rgb[1]);\r\n\t\t\tdv.setUint8(10, rgb[2]);\r\n\t\t\tthis.ws.send(array);\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\t\t\r\n\tsendUpdates() {\r\n\t\tvar worldx = mouse.worldX;\r\n\t\tvar worldy = mouse.worldY;\r\n\t\tvar lastx = this.lastSentX;\r\n\t\tvar lasty = this.lastSentY;\r\n\t\tif (this.isConnected() && shouldUpdate() || (worldx != lastx || worldy != lasty)) {\r\n\t\t\tvar selrgb = player.selectedColor;\r\n\t\t\tthis.lastSentX = worldx;\r\n\t\t\tthis.lastSentY = worldy;\r\n\t\t\t// Send mouse position\r\n\t\t\tvar array = new ArrayBuffer(12);\r\n\t\t\tvar dv = new DataView(array);\r\n\t\t\tdv.setInt32(0, worldx, true);\r\n\t\t\tdv.setInt32(4, worldy, true);\r\n\t\t\tdv.setUint8(8, selrgb[0]);\r\n\t\t\tdv.setUint8(9, selrgb[1]);\r\n\t\t\tdv.setUint8(10, selrgb[2]);\r\n\t\t\tvar tool = player.tool;\r\n\t\t\tvar toolId = tool !== null ? +OldProtocol.tools.id[tool.id] : 0;\r\n\t\t\tdv.setUint8(11, toolId);\r\n\t\t\tthis.ws.send(array);\r\n\t\t}\r\n\t}\r\n\t\t\r\n\tsendMessage(str) {\r\n\t\tif (str.length && this.id !== null) {\r\n\t\t\tif (player.rank == RANK.ADMIN || this.chatBucket.canSpend(1)) {\r\n\t\t\t\tthis.ws.send(str + OldProtocol.misc.chatVerification);\r\n\t\t\t\treturn true;\r\n\t\t\t} else {\r\n\t\t\t\teventSys.emit(e.net.chat, \"Slow down! You're talking too fast!\");\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\tprotectChunk(x, y, newState) {\r\n\t\tvar array = new ArrayBuffer(10);\r\n\t\tvar dv = new DataView(array);\r\n\t\tdv.setInt32(0, x, true);\r\n\t\tdv.setInt32(4, y, true);\r\n\t\tdv.setUint8(8, newState);\r\n\t\tthis.ws.send(array);\r\n\t\teventSys.emit(e.net.chunk.lock, x, y, newState, true);\r\n\t}\r\n\r\n\tsetChunk(x, y, data) {\r\n\t\tvar buf = new Uint8Array(8 + OldProtocol.chunkSize * OldProtocol.chunkSize * 3);\r\n\t\tvar dv = new DataView(buf.buffer);\r\n\t\tdv.setInt32(0, x, true);\r\n\t\tdv.setInt32(4, y, true);\r\n\t\tfor (var i = 0, b = 8; i < data.length; i++, b += 3) {\r\n\t\t\tbuf[b] = data[i] & 0xFF;\r\n\t\t\tbuf[b + 1] = data[i] >> 8 & 0xFF;\r\n\t\t\tbuf[b + 2] = data[i] >> 16 & 0xFF;\r\n\t\t}\r\n\t\tthis.ws.send(buf.buffer);\r\n\t}\r\n\r\n\tclearChunk(x, y) {\r\n\t\tvar array = new ArrayBuffer(9);\r\n\t\tvar dv = new DataView(array);\r\n\t\tdv.setInt32(0, x, true);\r\n\t\tdv.setInt32(4, y, true);\r\n\t\tthis.ws.send(array);\r\n\t}\r\n}\r\n\r\nOldProtocol.class = OldProtocolImpl;\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/protocol/old.js","'use strict';\r\nimport { EVENTS as e } from './../conf.js';\r\nimport { eventSys } from './../global.js';\r\n\r\nexport class Protocol {\r\n    constructor(ws) {\r\n        this.ws = ws;\r\n    }\r\n\r\n    hookEvents(subClass) {\r\n        this.ws.addEventListener('message', subClass.messageHandler.bind(subClass));\r\n        this.ws.addEventListener('open', subClass.openHandler.bind(subClass));\r\n        this.ws.addEventListener('close', subClass.closeHandler.bind(subClass));\r\n    }\r\n\r\n    isConnected() {\r\n        return this.ws.readyState === WebSocket.OPEN;\r\n    }\r\n\r\n    openHandler() {\r\n        eventSys.emit(e.net.connected);\r\n    }\r\n\r\n    closeHandler() {\r\n        eventSys.emit(e.net.disconnected);\r\n    }\r\n\r\n    messageHandler(message) {\r\n\r\n    }\r\n\r\n    joinWorld(name) {\r\n\r\n    }\r\n\r\n    requestChunk(x, y) {\r\n\r\n    }\r\n\r\n    updatePixel(x, y, rgb) {\r\n\r\n    }\r\n\r\n    sendUpdates() {\r\n\r\n    }\r\n\r\n    sendMessage(str) {\r\n\r\n    }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./src/js/protocol/Protocol.js","'use strict';\r\nimport { EVENTS as e } from './conf.js';\r\nimport { eventSys } from './global.js';\r\nimport { mkHTML, loadScript, setCookie } from './util/misc.js';\r\nimport { windowSys, GUIWindow, UtilDialog } from './windowsys.js';\r\nimport { misc } from './main.js';\r\n\r\nconst SITEKEY = \"6LcgvScUAAAAAARUXtwrM8MP0A0N70z4DHNJh-KI\";\r\n\r\nfunction loadCaptcha(onload) {\r\n\tif (!window.grecaptcha) {\r\n\t\tif (window.callback) {\r\n\t\t\t/* Hacky solution for race condition */\r\n\t\t\twindow.callback = function() {\r\n\t\t\t\tonload();\r\n\t\t\t\tthis();\r\n\t\t\t}.bind(window.callback);\r\n\t\t} else {\r\n        \twindow.callback = function() {\r\n\t            delete window.callback;\r\n            \tonload();\r\n        \t};\r\n\t\t\tloadScript(\"https://www.google.com/recaptcha/api.js?onload=callback&render=explicit\");\r\n\t\t}\r\n\t} else {\r\n\t\tonload();\r\n\t}\r\n}\r\n\r\nfunction requestVerification() {\r\n\twindowSys.addWindow(new GUIWindow(\"Verification needed\", {\r\n\t\t\tcentered: true\r\n\t}, wdow => {\r\n\t\tvar id = grecaptcha.render(wdow.addObj(mkHTML(\"div\", {\r\n\t\t\tstyle: \"margin: -4px;\" /* NOTE: not setting cssText */\r\n\t\t})), {\r\n\t\t\ttheme: \"light\",\r\n\t\t\tsitekey: SITEKEY,\r\n\t\t\tcallback: token => {\r\n\t\t\t\teventSys.emit(e.misc.captchaToken, token);\r\n\t\t\t\twdow.close();\r\n\t\t\t}\r\n\t\t});\r\n\t\twdow.frame.style.cssText = \"\";\r\n\t\twdow.container.style.cssText = \"overflow: hidden; background-color: #F9F9F9\";\r\n\t}));\r\n}\r\n\r\nexport function loadAndRequestCaptcha() {\r\n\tif (misc.showEUCookieNag) {\r\n\t\twindowSys.addWindow(new UtilDialog('Cookie notice',\r\n`This box alerts you that we're going to use cookies!\r\nIf you don't accept their usage, disable cookies and reload the page.`, false, () => {\r\n\t\t\tsetCookie('nagAccepted', 'true');\r\n\t\t\tmisc.showEUCookieNag = false;\r\n\t\t\tloadCaptcha(requestVerification);\r\n\t\t}));\r\n\t} else {\r\n\t\tloadCaptcha(requestVerification);\r\n\t}\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/js/captcha.js","module.exports = __webpack_public_path__ + \"audio/launch.mp3\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/audio/launch.mp3\n// module id = 25\n// module chunks = 0","module.exports = __webpack_public_path__ + \"audio/place.mp3\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/audio/place.mp3\n// module id = 26\n// module chunks = 0","module.exports = __webpack_public_path__ + \"audio/click.mp3\";\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/audio/click.mp3\n// module id = 27\n// module chunks = 0","module.exports = __webpack_public_path__ + \"polyfill/canvas-toBlob.js\";\n\n\n// WEBPACK FOOTER //\n// ./src/js/polyfill/canvas-toBlob.js"],"sourceRoot":""}